<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î™®ÌÅ¥ ÏÑ±Ï†Å Ï°∞Ìöå ÏãúÏä§ÌÖú (AI Î∂ÑÏÑù Ìè¨Ìï®)</title>
    <!-- Google tag (gtag.js) --> 
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BCEK0772SC"></script> 
    <script> 
    window.dataLayer = window.dataLayer || []; 
    function gtag(){dataLayer.push(arguments);} 
    gtag('js', new Date()); 
    gtag('config', 'G-BCEK0772SC'); 
    </script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
/* üé® ÌîÑÎ¶¨ÎØ∏ÏóÑ ÎîîÏûêÏù∏ ÏãúÏä§ÌÖú - Apple, Samsung, Meta Ïä§ÌÉÄÏùº */
        <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            /* ÌîÑÎ¶¨ÎØ∏ÏóÑ ÏÉâÏÉÅ ÌåîÎ†àÌä∏ */
            --primary: #007AFF;
            --secondary: #5856D6;
            --success: #34C759;
            --warning: #FF9500;
            --danger: #FF3B30;
            --info: #5AC8FA;
            
            /* Îâ¥Î™®ÌîºÏ¶ò Í∑∏Î†àÏù¥ Ïä§ÏºÄÏùº */
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            
            /* Í∑∏Î¶ºÏûê ÏãúÏä§ÌÖú */
            --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            
            /* Ïï†ÎãàÎ©îÏù¥ÏÖò */
            --transition-base: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', 
                         'Noto Sans KR', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            color: var(--gray-900);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà */
        .container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(40px) saturate(180%);
            border-radius: 32px;
            box-shadow: var(--shadow-xl), 0 0 0 1px rgba(0, 0, 0, 0.05);
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: var(--transition-base);
        }
        
        .container:hover {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }
        
        /* Ìó§Îçî */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--gray-100);
            position: relative;
        }
        
        .header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }
        
        .header h1 {
            color: var(--gray-900);
            font-size: 2.5em;
            font-weight: 800;
            letter-spacing: -0.02em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            color: var(--gray-600);
            font-size: 1.1em;
            font-weight: 500;
            letter-spacing: -0.01em;
        }
        
        /* ÌÉ≠ ÏãúÏä§ÌÖú */
        .tab-container {
            display: flex;
            margin-bottom: 30px;
            padding: 6px;
            background: var(--gray-100);
            border-radius: 16px;
            gap: 8px;
        }
        
        .tab {
            flex: 1;
            padding: 15px 30px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 1.1em;
            font-weight: 600;
            color: var(--gray-600);
            border-radius: 12px;
            transition: var(--transition-base);
        }
        
        .tab:hover {
            color: var(--gray-900);
            background: rgba(255, 255, 255, 0.5);
        }
        
        .tab.active {
            color: var(--gray-900);
            background: white;
            box-shadow: var(--shadow-sm);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease-in-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* AI Î∂ÑÏÑù */
        .ai-analysis {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 24px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            transition: var(--transition-base);
        }
        
        .ai-analysis:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-4px);
        }
        
        .ai-analysis::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="30" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="70" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="80" r="2" fill="rgba(255,255,255,0.1)"/></svg>');
            pointer-events: none;
        }
        
        .ai-analysis-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        
        .ai-icon {
            width: 56px;
            height: 56px;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-sm);
            transition: var(--transition-base);
        }
        
        .ai-icon:hover {
            transform: scale(1.1) rotate(5deg);
        }
        
        .ai-analysis h3 {
            font-size: 1.5em;
            margin: 0;
            font-weight: 700;
            letter-spacing: -0.01em;
        }
        
        .ai-content {
            position: relative;
            z-index: 1;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .analysis-card {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: var(--transition-base);
        }
        
        .analysis-card:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-4px);
        }
        
        .analysis-card h4 {
            font-size: 1.2em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            letter-spacing: -0.01em;
        }
        
        .trend-up { color: #4ade80; }
        .trend-down { color: #f87171; }
        .trend-stable { color: #fbbf24; }
        
        .progress-bar-container {
            background: rgba(255, 255, 255, 0.25);
            border-radius: 10px;
            height: 8px;
            margin: 8px 0;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .grade-excellent { background: linear-gradient(90deg, #ef4444, #dc2626); }
        .grade-good { background: linear-gradient(90deg, #f97316, #ea580c); }
        .grade-average { background: linear-gradient(90deg, #eab308, #ca8a04); }
        .grade-needs-improvement { background: linear-gradient(90deg, #06b6d4, #0891b2); }
        .grade-poor { background: linear-gradient(90deg, #8b5cf6, #7c3aed); }
        
        .ai-loading {
            display: flex;
            align-items: center;
            gap: 10px;
            color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            justify-content: center;
        }
        
        .loading-dots {
            display: flex;
            gap: 4px;
        }
        
        .loading-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.7);
            animation: pulse 1.4s infinite ease-in-out;
        }
        
        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes pulse {
            0%, 80%, 100% { 
                transform: scale(0); 
                opacity: 0.5; 
            }
            40% { 
                transform: scale(1); 
                opacity: 1; 
            }
        }
        
        .ai-recommendations {
            background: rgba(255, 255, 255, 0.12);
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #10b981;
        }
        
        .ai-recommendations h4 {
            margin-bottom: 15px;
            color: #10b981;
            font-weight: 700;
        }
        
        .recommendation-item {
            background: rgba(255, 255, 255, 0.12);
            border-radius: 12px;
            padding: 12px;
            margin: 8px 0;
            border-left: 3px solid rgba(255, 255, 255, 0.5);
            transition: var(--transition-base);
        }
        
        .recommendation-item:hover {
            background: rgba(255, 255, 255, 0.18);
            transform: translateX(4px);
        }
        
        .recommendation-priority {
            font-size: 0.85em;
            opacity: 0.8;
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        /* Îì±Í∏â ÏÉÅÏäπ Ï†ÑÎûµ */
        .grade-strategy {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #4ade80;
            box-shadow: var(--shadow-md);
        }
        
        .grade-strategy h4 {
            margin-bottom: 15px;
            color: #4ade80;
            font-size: 1.3em;
            font-weight: 800;
        }
        
        .recent-tests-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 15px 0;
            background: rgba(255, 255, 255, 0.12);
            border-radius: 16px;
            padding: 15px;
        }
        
        .recent-test-item {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.12);
            border-radius: 12px;
            transition: var(--transition-base);
        }
        
        .recent-test-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .recent-test-name {
            font-size: 0.85em;
            opacity: 0.8;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .recent-test-grade {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .recent-test-score {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .target-analysis {
            background: rgba(255, 255, 255, 0.12);
            border-radius: 16px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .target-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .target-grade {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .target-possibility {
            font-size: 0.85em;
            padding: 6px 14px;
            border-radius: 14px;
            font-weight: bold;
        }
        
        .possibility-high { background: #10b981; color: white; }
        .possibility-medium { background: #f59e0b; color: white; }
        .possibility-low { background: #ef4444; color: white; }
        
        .subject-strategy-list {
            margin: 15px 0;
        }
        
        .subject-strategy-item {
            background: rgba(255, 255, 255, 0.12);
            border-radius: 12px;
            padding: 12px;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition-base);
        }
        
        .subject-strategy-item:hover {
            background: rgba(255, 255, 255, 0.18);
            transform: translateX(4px);
        }
        
        .subject-strategy-left {
            flex: 1;
        }
        
        .subject-strategy-right {
            text-align: right;
        }
        
        .subject-name {
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .subject-detail {
            font-size: 0.85em;
            opacity: 0.8;
        }
        
        .points-gain {
            font-size: 1.1em;
            font-weight: bold;
            color: #4ade80;
        }
        
        .total-strategy {
            background: rgba(255, 255, 255, 0.18);
            border-radius: 14px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .total-points {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        /* Í¥ÄÎ¶¨Ïûê ÏÑπÏÖò */
        .admin-check {
            background: linear-gradient(135deg, #FFF3CD 0%, #FFFBEB 100%);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid var(--warning);
            box-shadow: var(--shadow-sm);
        }
        
        .admin-check h3 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 700;
        }
        
        .admin-check p {
            color: #856404;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .admin-password {
            width: 100%;
            padding: 12px;
            border: 2px solid #ffc107;
            border-radius: 12px;
            font-size: 1em;
            margin: 10px 0;
            transition: var(--transition-base);
        }
        
        .admin-password:focus {
            outline: none;
            border-color: var(--warning);
            box-shadow: 0 0 0 4px rgba(255, 193, 7, 0.1);
        }
        
        .admin-btn {
            background: #ffc107;
            color: #856404;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            margin: 5px;
            transition: var(--transition-base);
            box-shadow: var(--shadow-sm);
        }
        
        .admin-btn:hover {
            background: #e0a800;
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .setup-section {
            background: linear-gradient(135deg, #E8F2FF 0%, #F5F8FF 100%);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid var(--primary);
            display: none;
            box-shadow: var(--shadow-sm);
        }
        
        .setup-section h3 {
            color: var(--gray-900);
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 700;
        }
        
        .setup-section p {
            color: var(--gray-700);
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .setup-input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--primary);
            border-radius: 12px;
            font-size: 1em;
            margin: 10px 0;
            transition: var(--transition-base);
        }
        
        .setup-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
        }
        
        .setup-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            margin: 5px;
            transition: var(--transition-base);
            box-shadow: var(--shadow-sm);
        }
        
        .setup-btn:hover {
            background: #0051D5;
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        /* ÏóÖÎ°úÎìú ÏòÅÏó≠ */
        .upload-area {
            border: 3px dashed var(--gray-300);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            transition: var(--transition-base);
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: var(--primary);
            background: linear-gradient(135deg, #E8F2FF 0%, #F5F8FF 100%);
            transform: translateY(-2px);
        }
        
        .upload-area.dragover {
            border-color: var(--primary);
            background: linear-gradient(135deg, #E8F2FF 0%, #F5F8FF 100%);
            box-shadow: var(--shadow-lg);
            transform: scale(1.02);
        }
        
        .upload-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 14px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            font-weight: 700;
            transition: var(--transition-base);
            box-shadow: var(--shadow-sm);
        }
        
        .upload-btn:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .upload-btn:disabled {
            background: var(--gray-300);
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .progress {
            margin: 20px 0;
            background: var(--gray-100);
            border-radius: 12px;
            overflow: hidden;
            display: none;
            box-shadow: var(--shadow-sm);
        }
        
        .progress-bar {
            height: 32px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            line-height: 32px;
            color: white;
            font-weight: bold;
        }
        
        .status {
            margin: 20px 0;
            padding: 18px 24px;
            border-radius: 14px;
            display: none;
            font-weight: 600;
            box-shadow: var(--shadow-sm);
        }
        
        .status.success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 1px solid #c3e6cb;
            border-left: 4px solid var(--success);
        }
        
        .status.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-left: 4px solid var(--danger);
        }
        
        .status.warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
            border: 1px solid #ffeaa7;
            border-left: 4px solid var(--warning);
        }
        
        .data-summary {
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            display: none;
            box-shadow: var(--shadow-md);
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .summary-item {
            background: white;
            padding: 24px;
            border-radius: 16px;
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: var(--transition-base);
            border: 1px solid var(--gray-100);
        }
        
        .summary-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-4px);
        }
        
        .summary-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
        }
        
        .summary-label {
            color: var(--gray-600);
            margin-top: 5px;
            font-weight: 600;
        }
        
        /* Í≤ÄÏÉâ ÏÑπÏÖò */
        .search-section {
            margin-bottom: 30px;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .search-input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid var(--gray-200);
            border-radius: 14px;
            font-size: 1.1em;
            transition: var(--transition-base);
            font-weight: 500;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
        }
        
        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 700;
            transition: var(--transition-base);
            box-shadow: var(--shadow-sm);
        }
        
        .search-btn:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .search-btn:disabled {
            background: var(--gray-300);
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .instructions {
            background: linear-gradient(135deg, #E8F2FF 0%, #F5F8FF 100%);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid var(--primary);
            box-shadow: var(--shadow-sm);
            transition: var(--transition-base);
        }
        
        .instructions:hover {
            box-shadow: var(--shadow-md);
            transform: translateX(4px);
        }
        
        .instructions h3 {
            color: var(--gray-900);
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 700;
        }
        
        .instructions p {
            color: var(--gray-700);
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        /* ÌïôÏÉù Ï†ïÎ≥¥ */
        .student-info {
            background: linear-gradient(135deg, #E8F2FF 0%, #F5F8FF 100%);
            border-radius: 24px;
            padding: 25px;
            margin: 25px 0;
            border-left: 6px solid var(--primary);
            box-shadow: var(--shadow-md);
            transition: var(--transition-base);
        }
        
        .student-info:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .student-info h2 {
            color: var(--gray-900);
            margin-bottom: 15px;
            font-size: 1.6em;
            font-weight: 800;
        }
        
        /* ÌÖåÏù¥Î∏î */
        .summary-table {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: var(--shadow-md);
            border-left: 6px solid var(--primary);
            overflow-x: auto;
            transition: var(--transition-base);
        }
        
        .summary-table:hover {
            box-shadow: var(--shadow-lg);
        }
        
        .summary-table h3 {
            color: var(--gray-900);
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 700;
        }
        
        .grade-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 0.9em;
        }
        
        .grade-table th {
            background: var(--gray-50);
            color: var(--gray-900);
            font-weight: bold;
            padding: 12px 8px;
            text-align: center;
            border-bottom: 2px solid var(--gray-200);
        }
        
        .grade-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid var(--gray-100);
            transition: var(--transition-base);
        }
        
        .grade-table tr:hover td {
            background: var(--gray-50);
        }
        
        .test-name {
            font-weight: bold;
            color: var(--primary);
            text-align: left !important;
            min-width: 80px;
        }
        
        .grade-cell {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .score-cell {
            font-weight: bold;
            color: var(--gray-900);
        }
        
        .absent-cell {
            color: var(--gray-400);
            font-style: italic;
        }
        
        .source-cell {
            font-size: 0.8em;
            color: var(--gray-600);
        }
        
        /* ÏÑ±Ï†Å Ïπ¥Îìú */
        .grade-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 25px;
        }
        
        .grade-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow-md);
            border-left: 6px solid var(--primary);
            transition: var(--transition-base);
        }
        
        .grade-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
        }
        
        .grade-card h3 {
            color: var(--gray-900);
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 700;
        }
        
        .grade-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--gray-50);
            border-radius: 16px;
        }
        
        .grade-summary-item {
            text-align: center;
        }
        
        .grade-summary-value {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .grade-summary-label {
            font-size: 0.9em;
            color: var(--gray-600);
        }
        
        .grade-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
        }
        
        .grade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--gray-50);
            border-radius: 12px;
            border-left: 3px solid var(--primary);
            transition: var(--transition-base);
        }
        
        .grade-item:hover {
            background: var(--gray-100);
            transform: translateX(4px);
        }
        
        .grade-label {
            color: var(--gray-700);
            font-weight: 500;
            font-size: 0.9em;
        }
        
        .grade-value {
            font-weight: bold;
            color: var(--gray-900);
        }
        
        .grade-1 { color: #e74c3c; }
        .grade-2 { color: #f39c12; }
        .grade-3 { color: #f1c40f; }
        .grade-4 { color: #2ecc71; }
        .grade-5 { color: #3498db; }
        .grade-6 { color: #9b59b6; }
        
        .no-results, .no-data {
            text-align: center;
            color: var(--gray-600);
            font-size: 1.2em;
            margin-top: 40px;
            padding: 60px;
            background: var(--gray-50);
            border-radius: 24px;
            box-shadow: var(--shadow-sm);
        }
        
        /* ÎåÄÏãúÎ≥¥Îìú */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow-md);
            border-left: 6px solid var(--primary);
            transition: var(--transition-base);
        }
        
        .dashboard-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
        }
        
        .dashboard-card h3 {
            color: var(--gray-900);
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--gray-100);
        }
        
        .stat-label {
            color: var(--gray-600);
            font-size: 0.95em;
        }
        
        .stat-value {
            font-weight: bold;
            color: var(--gray-900);
            font-size: 1.1em;
        }
        
        .stat-positive { color: var(--success); }
        .stat-negative { color: var(--danger); }
        .stat-neutral { color: var(--gray-500); }
        
        /* D-day Ïπ¥Ïö¥ÌÑ∞ */
        .dday-counter {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 24px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: var(--shadow-lg);
            transition: var(--transition-base);
        }
        
        .dday-counter:hover {
            box-shadow: var(--shadow-xl);
            transform: scale(1.02);
        }
        
        .dday-number {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.2);
            letter-spacing: -0.03em;
        }
        
        .dday-text {
            font-size: 1.2em;
            margin-bottom: 5px;
        }
        
        /* Î±ÉÏßÄ ÏãúÏä§ÌÖú */
        .badge-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
            margin: 15px 0;
        }
        
        .achievement-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px 10px;
            border-radius: 14px;
            font-size: 0.85em;
            font-weight: bold;
            box-shadow: var(--shadow-sm);
            text-align: center;
            min-height: 36px;
            color: white;
            cursor: pointer;
            transition: var(--transition-base);
        }
        
        .achievement-badge:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .achievement-badge.grade { background: linear-gradient(135deg, #ffd700, #ff8c00); }
        .achievement-badge.score { background: linear-gradient(135deg, #667eea, #764ba2); }
        .achievement-badge.trend { background: linear-gradient(135deg, #ff6b6b, #feca57); }
        .achievement-badge.improvement { background: linear-gradient(135deg, #10b981, #059669); }
        .achievement-badge.attendance { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .achievement-badge.special { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .achievement-badge.stability { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .achievement-badge.rank { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .achievement-badge.recovery { background: linear-gradient(135deg, #84cc16, #65a30d); }
        .achievement-badge.start { background: linear-gradient(135deg, #ec4899, #db2777); }
        .achievement-badge.milestone { background: linear-gradient(135deg, #f97316, #ea580c); }
        .achievement-badge.single-jump { background: linear-gradient(135deg, #16a085, #2ecc71); }
        .achievement-badge.total-growth { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .achievement-badge.subject-master { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
        
        .badge-new {
            animation: pulse-badge 2s infinite;
        }
        
        @keyframes pulse-badge {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: var(--shadow-lg); }
        }
        
        .badge-summary {
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            color: var(--primary);
            font-weight: bold;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
            padding: 20px;
            background: var(--gray-50);
            border-radius: 16px;
        }
        
        .progress-ring {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }
        
        .progress-ring svg {
            transform: rotate(-90deg);
        }
        
        .progress-ring-text {
            position: absolute;
            font-size: 1.2em;
            font-weight: bold;
            color: var(--gray-900);
        }
        
        /* Í∑∏ÎûúÎìú ÎßàÏä§ÌÑ∞ */
        @keyframes grand-master-glow {
            0% { 
                box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
                transform: scale(1);
            }
            100% { 
                box-shadow: 0 12px 35px rgba(255, 215, 0, 0.6);
                transform: scale(1.02);
            }
        }
        
        .grand-master-message {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: white;
            border-radius: 20px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            box-shadow: var(--shadow-lg);
            animation: grand-master-glow 2s infinite alternate;
        }
        
        /* Î±ÉÏßÄ Ìà¥ÌåÅ */
        .badge-tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 0.85em;
            max-width: 250px;
            z-index: 99999;
            box-shadow: var(--shadow-xl);
            pointer-events: none;
            opacity: 0;
            transform: translateY(10px);
            transition: var(--transition-base);
            line-height: 1.4;
        }
        
        .badge-tooltip.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .badge-tooltip::after {
            content: '';
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 6px solid rgba(0, 0, 0, 0.95);
        }
        
        .achievement-badge {
            position: relative;
        }
        
        .achievement-badge:active {
            transform: scale(0.95);
        }
        
        /* ÌïôÏäµ Í≥ÑÌöçÏÑú */
        .plan-target-setting {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        
        .target-input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .target-input-item {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 15px;
        }
        
        .target-input-item label {
            display: block;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .target-input-item input,
        .target-input-item select {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.95);
            font-size: 0.95em;
            transition: var(--transition-base);
        }
        
        .target-input-item input:focus,
        .target-input-item select:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
        }
        
        .generate-plan-btn {
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 14px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition-base);
            box-shadow: var(--shadow-md);
        }
        
        .generate-plan-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .advanced-study-plan {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 30px;
            margin-top: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .plan-document-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .plan-document-header h3 {
            font-size: 1.8em;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.95);
            font-weight: 800;
        }
        
        .student-info-banner {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 14px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .status-dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-card {
            background: rgba(255, 255, 255, 0.12);
            border-radius: 16px;
            padding: 20px;
            border-left: 4px solid;
            transition: var(--transition-base);
        }
        
        .status-card:hover {
            background: rgba(255, 255, 255, 0.18);
            transform: translateY(-2px);
        }
        
        .current-status-card {
            border-left-color: var(--danger);
        }
        
        .target-status-card {
            border-left-color: var(--success);
        }
        
        .status-card h4 {
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
        }
        
        .status-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
        }
        
        .metric-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.12);
            border-radius: 10px;
            padding: 12px 8px;
        }
        
        .metric-value {
            font-size: 1.3em;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .improvement-analysis {
            background: rgba(255, 255, 255, 0.12);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .weak-subject-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid;
            transition: var(--transition-base);
        }
        
        .weak-subject-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(4px);
        }
        
        .weak-subject-card.priority-high {
            border-left-color: rgba(220, 53, 69, 0.9);
        }
        
        .weak-subject-card.priority-medium {
            border-left-color: rgba(255, 193, 7, 0.9);
        }
        
        .weak-subject-card.priority-low {
            border-left-color: rgba(23, 162, 184, 0.9);
        }
        
        .subject-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .subject-name {
            font-size: 1.2em;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.95);
        }
        
        .priority-badge {
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            color: white;
        }
        
        .priority-high { 
            background: rgba(220, 53, 69, 0.9);
        }
        .priority-medium { 
            background: rgba(255, 193, 7, 0.95);
            color: #333;
        }
        .priority-low { 
            background: rgba(23, 162, 184, 0.9);
        }
        
        .subject-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .detail-metric {
            background: rgba(255, 255, 255, 0.12);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }
        
        .detail-value {
            font-size: 1.1em;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 3px;
        }
        
        .detail-label {
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .study-materials {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .material-links {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .material-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 14px;
            font-size: 0.9em;
            font-weight: 600;
            transition: var(--transition-base);
            box-shadow: var(--shadow-sm);
        }
        
        .material-link:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
            text-decoration: none;
            color: white;
        }
        
        .weekly-schedule-advanced {
            background: rgba(255, 255, 255, 0.12);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .schedule-week-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 12px;
            margin-top: 20px;
        }
        
        .schedule-day {
            background: rgba(255, 255, 255, 0.12);
            border-radius: 12px;
            padding: 15px 10px;
            text-align: center;
            min-height: 120px;
        }
        
        .day-name {
            font-weight: bold;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .study-session {
            background: rgba(255, 255, 255, 0.18);
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 6px;
            font-size: 0.8em;
            line-height: 1.2;
        }
        
        .session-subject {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .session-time {
            opacity: 0.8;
        }
        
        .motivation-banner {
            background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
            color: #333;
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: var(--shadow-lg);
        }
        
        .motivation-banner h4 {
            font-size: 1.4em;
            margin-bottom: 15px;
            color: #333;
            font-weight: 800;
        }
        
        .motivation-text {
            font-size: 1.1em;
            line-height: 1.6;
            font-weight: 500;
        }
        
        .plan-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .action-button {
            padding: 12px 25px;
            border: none;
            border-radius: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-base);
            font-size: 1em;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow-sm);
        }
        
        .pdf-download-btn {
            background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%);
            color: white;
        }
        
        .pdf-download-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        
        .edit-plan-btn {
            background: linear-gradient(135deg, var(--gray-600) 0%, #5a6268 100%);
            color: white;
        }
        
        .edit-plan-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        
        /* Î™®Î∞îÏùº Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            body {
                padding: 0;
            }
            
            .container {
                padding: 20px;
                border-radius: 0;
                margin: 0;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .tab-container {
                flex-direction: row;
                gap: 4px;
            }
            
            .tab {
                padding: 12px;
                font-size: 0.9em;
            }
            
            .search-box {
                flex-direction: column;
            }
            
            .search-input, .search-btn {
                font-size: 1rem;
            }
            
            .grade-cards {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .analysis-grid {
                grid-template-columns: 1fr;
            }
            
            .recent-tests-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .status-dashboard {
                grid-template-columns: 1fr;
            }
            
            .schedule-week-grid {
                grid-template-columns: 1fr;
            }
            
            .badge-container {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 6px;
            }
            
            .achievement-badge {
                padding: 6px 8px;
                font-size: 0.75em;
                min-height: 32px;
            }
            
            .plan-actions {
                flex-direction: column;
            }
            
            .badge-tooltip {
                bottom: 20px;
                left: 20px;
                right: 20px;
                max-width: none;
            }
        }
        
        /* Ïù∏ÏáÑ Ïä§ÌÉÄÏùº */
        @media print {
            .container {
                box-shadow: none;
            }
            
            .tab-container, .search-section, .plan-actions {
                display: none;
            }
            
            .advanced-study-plan, .ai-analysis {
                background: white;
                color: black;
            }
        }
        
        /* Ïä§ÌÅ¨Î°§Î∞î */
        ::-webkit-scrollbar {
            width: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
            border: 2px solid var(--gray-100);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #0051D5, #4745C2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Î™®ÌÅ¥ ÏÑ±Ï†Å Ï°∞Ìöå ÏãúÏä§ÌÖú</h1>
            <p>Ï†ïÎèôÎØºÍµ≠Ïñ¥ÎÖºÏà†ÌïôÏõê ‚Ä¢ Í≥†2 Î™®ÏùòÍ≥†ÏÇ¨ ÏÑ±Ï†Å Ï°∞Ìöå ‚Ä¢ Î∂ÑÏÑù Ìè¨Ìï®</p>
        </div>
        
        <div class="tab-container">
            <button class="tab active" onclick="switchTab('student')">üîç ÏÑ±Ï†Å Ï°∞Ìöå</button>
            <button class="tab" onclick="switchTab('admin')">‚öôÔ∏è Í¥ÄÎ¶¨Ïûê</button>
        </div>
        
        <!-- ÌïôÏÉù Ï°∞Ìöå ÌÉ≠ -->
        <div id="studentTab" class="tab-content active">
            <div class="instructions">
                <h3>üìã ÏÑ±Ï†Å Ï°∞Ìöå Î∞©Î≤ï</h3>
                <p>‚Ä¢ <strong>Ï∂úÍ≤∞Î≤àÌò∏Î°ú Í≤ÄÏÉâ:</strong> Î≥∏Ïù∏Ïùò 4ÏûêÎ¶¨ Ï∂úÍ≤∞Î≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî</p>
                <p>‚Ä¢ ÏòàÏãú: 3188, 1234, 2274 Îì±</p>
                <p>‚Ä¢ <strong>üß† Î∂ÑÏÑù:</strong> ÏÑ±Ï†Å Ï°∞Ìöå Ïãú ÏûêÎèôÏúºÎ°ú Í∞úÏù∏Î≥Ñ ÎßûÏ∂§ Î∂ÑÏÑùÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§</p>
                <div id="urlInfo" style="margin-top: 15px; padding: 10px; background: #e8f5e9; border-radius: 8px; border-left: 4px solid #4caf50; display: none;">
                    <strong>üí° Îçî Ïâ¨Ïö¥ Ï†ëÏÜç Î∞©Î≤ï:</strong><br>
                    Îã§Ïùå URLÏùÑ Î∂ÅÎßàÌÅ¨ÌïòÎ©¥ Ïñ¥Îñ§ Í∏∞Í∏∞ÏóêÏÑúÎì† Î∞îÎ°ú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§:<br>
                    <code id="shareableUrl" style="background: white; padding: 5px; border-radius: 4px; font-size: 0.9em;"></code>
                </div>
            </div>
            
            <div class="search-section">
                <div class="search-box">
                    <input type="text" id="searchInput" class="search-input" placeholder="Ï∂úÍ≤∞Î≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Ïòà: 3188)" maxlength="4">
                    <button onclick="searchStudent()" class="search-btn" id="searchBtn">üîç Ï°∞Ìöå</button>
                </div>
            </div>
            
            <div id="noData" class="no-data">
                <h3>üìã Îç∞Ïù¥ÌÑ∞ ÏÉÅÌÉú</h3>
                <p id="dataStatusMessage">Ïò®ÎùºÏù∏ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
            </div>
            
            <div id="results" style="display: none;">
                <div id="studentInfo"></div>
                
                <!-- Î∂ÑÏÑù ÏÑπÏÖò -->
                <div id="aiAnalysis" class="ai-analysis" style="display: none;">
                    <div class="ai-analysis-header">
                        <div class="ai-icon">üß†</div>
                        <div>
                            <h3>ÌïôÏäµ Î∂ÑÏÑù Î≥¥Í≥†ÏÑú</h3>
                            <p style="opacity: 0.9; margin: 0;">Í∞úÏù∏Î≥Ñ ÎßûÏ∂§ ÏÑ±Ï†Å Î∂ÑÏÑù Î∞è ÌïôÏäµ Ï†ÑÎûµ Ï†úÏïà</p>
                        </div>
                    </div>
                    
                    <div id="aiContent" class="ai-content">
                        <div class="ai-loading">
                            <span>üß† ÏÑ±Ï†ÅÏùÑ Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§</span>
                            <div class="loading-dots">
                                <div class="loading-dot"></div>
                                <div class="loading-dot"></div>
                                <div class="loading-dot"></div>
                            </div>
                        </div>
                    </div>
                </div>

            <!-- üÜï ÏÉàÎ°úÏö¥ Í∞ÑÏÜåÌôîÎêú ÌïôÏäµ Í≥ÑÌöçÏÑú ÏÑπÏÖò -->
            <div id="studyPlanSection" class="ai-analysis" style="display: none; margin-top: 20px;">
                <div class="ai-analysis-header">
                    <div class="ai-icon">üìã</div>
                    <div>
                        <h3>ÎßûÏ∂§Ìòï ÌïôÏäµ Í≥ÑÌöçÏÑú</h3>
                        <p style="opacity: 0.9; margin: 0;">AI Î∂ÑÏÑù Í∏∞Î∞ò Í∞úÏù∏Î≥Ñ ÏµúÏ†ÅÌôî ÌïôÏäµ Ï†ÑÎûµ</p>
                    </div>
                </div>
                
                <div id="studyPlanContent" class="ai-content">
                    <div id="autoGeneratedPlan" style="display: none;">
                        <!-- ÏûêÎèô ÏÉùÏÑ±Îêú Í≥ÑÌöçÏÑúÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                    </div>
                </div>
            </div>
                
                <div id="summaryTable"></div>
                <div id="gradeCards" class="grade-cards"></div>
            </div>
            
            <div id="noResults" class="no-results" style="display: none;">
                <h3>üîç Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§</h3>
                <p>ÏûÖÎ†•ÌïòÏã† Ï∂úÍ≤∞Î≤àÌò∏Î•º Îã§Ïãú ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.</p>
            </div>
        </div>
        
        <!-- Í¥ÄÎ¶¨Ïûê ÌÉ≠ -->
        <div id="adminTab" class="tab-content">
            <!-- Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ù ÏÑπÏÖò -->
            <div id="adminAuthSection" class="admin-check">
                <h3>üîê Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ù</h3>
                <p>Í¥ÄÎ¶¨Ïûê Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©ÌïòÎ†§Î©¥ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.</p>
                <input type="password" id="adminPassword" class="admin-password" placeholder="Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" onkeypress="if(event.key==='Enter') checkAdminPassword()">
                <br>
                <button onclick="checkAdminPassword()" class="admin-btn">üîë Ïù∏Ï¶ù</button>
                <button onclick="resetAdminAccess()" class="admin-btn" style="background: #dc3545; color: white;">üîÑ Ï¥àÍ∏∞Ìôî</button>
                
                
            </div>
            
            <!-- GitHub Ï†ÄÏû•ÏÜå ÏÑ§Ï†ï ÏÑπÏÖò -->
            <div id="githubSetup" class="setup-section">
                <h3>üîß GitHub Ï†ÄÏû•ÏÜå ÏÑ§Ï†ï</h3>
                <p><strong>Ï≤òÏùå ÏÇ¨Ïö© Ïãú Ìïú Î≤àÎßå ÏÑ§Ï†ïÌïòÎ©¥ Îê©ÎãàÎã§!</strong></p>
                <p>1. GitHubÏóêÏÑú ÏÉà Ï†ÄÏû•ÏÜåÎ•º ÎßåÎìúÏÑ∏Ïöî (Ïòà: grade2-data)</p>
                <p>2. Ï†ÄÏû•ÏÜåÎ•º PublicÏúºÎ°ú ÏÑ§Ï†ïÌïòÍ≥† GitHub PagesÎ•º ÌôúÏÑ±ÌôîÌïòÏÑ∏Ïöî</p>
                <p>3. ÏïÑÎûòÏóê Ï†ÄÏû•ÏÜå Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:</p>
                
                <input type="text" id="githubUsername" class="setup-input" placeholder="GitHub ÏÇ¨Ïö©ÏûêÎ™Ö (Ïòà: myusername)" autocomplete="off">
                <input type="text" id="githubRepo" class="setup-input" placeholder="Ï†ÄÏû•ÏÜå Ïù¥Î¶Ñ (Ïòà: grade2-data)" autocomplete="off">
                <input type="password" id="githubToken" class="setup-input" placeholder="GitHub Personal Access Token (ÏÑ†ÌÉùÏÇ¨Ìï≠)">
                
                <button onclick="saveGitHubConfig()" class="setup-btn">ÏÑ§Ï†ï Ï†ÄÏû•</button>
                <button onclick="testGitHubConnection()" class="setup-btn">Ïó∞Í≤∞ ÌÖåÏä§Ìä∏</button>
                
                <p style="margin-top: 15px; font-size: 0.9em;">
                    <strong>üìå GitHub Token Î∞úÍ∏â Î∞©Î≤ï:</strong><br>
                    GitHub ‚Üí Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Generate new token<br>
                    Í∂åÌïú: repo (Ï†ÑÏ≤¥ Ï†ÄÏû•ÏÜå Ï†ëÍ∑º Í∂åÌïú) ÏÑ†ÌÉù
                </p>
            </div>
            
            <!-- ÌååÏùº ÏóÖÎ°úÎìú ÏÑπÏÖò -->
            <div id="uploadSection" style="display: none;">
                <div class="instructions">
                    <h3>‚öôÔ∏è Í¥ÄÎ¶¨Ïûê ÏòÅÏó≠</h3>
                    <p>‚Ä¢ ÏóëÏÖÄ ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÏó¨ ÏÑ±Ï†Å Îç∞Ïù¥ÌÑ∞Î•º GitHubÏóê Ï†ÄÏû•Ìï©ÎãàÎã§</p>
                    <p>‚Ä¢ ÏóÖÎ°úÎìúÎêú Îç∞Ïù¥ÌÑ∞Îäî Î™®Îì† Í∏∞Í∏∞ÏóêÏÑú Ï†ëÍ∑º Í∞ÄÎä•Ìï©ÎãàÎã§</p>
                    <p>‚Ä¢ ÏßÄÏõê ÌååÏùº ÌòïÏãù: .xlsx, .xls</p>
                    <p>‚Ä¢ <strong>ÏàòÏ†ïÎê®:</strong> VLOOKUP Ï∞∏Ï°∞ Ïò§Î•ò ÏûêÎèô Î≥¥Ï†ï Î∞è Î∞±ÏóÖ ÎßåÏ†ê Ï∂îÏ∂ú</p>
                </div>
                
                <div class="upload-area" id="uploadArea">
                    <h3>üìÅ ÏóëÏÖÄ ÌååÏùº ÏóÖÎ°úÎìú</h3>
                    <p>ÌååÏùºÏùÑ ÎìúÎûòÍ∑∏Ïï§ÎìúÎ°≠ÌïòÍ±∞ÎÇò ÏïÑÎûò Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî</p>
                    <input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;">
                    <button class="upload-btn" onclick="document.getElementById('fileInput').click()">ÌååÏùº ÏÑ†ÌÉù</button>
                    <button class="upload-btn" onclick="processFileAndUpload()" id="processBtn" disabled>GitHubÏóê ÏóÖÎ°úÎìú</button>
                </div>
            </div>
            
            <div class="progress" id="progressContainer">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>
            
            <div class="status" id="statusMessage"></div>
            
            <div class="data-summary" id="dataSummary">
                <h3>üìä ÏóÖÎ°úÎìúÎêú Îç∞Ïù¥ÌÑ∞ ÌòÑÌô©</h3>
                <div class="summary-grid" id="summaryGrid"></div>
            </div>
        </div>
    </div>

    <script>

        // ÌïôÏóÖ Ïö¥ÏÑ∏ Îç∞Ïù¥ÌÑ∞ (ÌñâÏö¥Ïùò Í≥ºÎ™© Ïã§Ï†ú Í≥†Îì±ÌïôÍµê Í≥ºÎ™©ÏúºÎ°ú ÍµêÏ≤¥)
        var fortuneData = {
            excellent: {
                icon: "‚≠ê",
                title: "ÏµúÍ≥†Ïùò ÌïôÏäµÏùº!",
                stars: "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
                color: "from-yellow-400 to-orange-500",
                bgColor: "rgba(255, 215, 0, 0.1)",
                advice: [
                    "ÏÉàÎ°úÏö¥ Í∞úÎÖêÏùÑ Î∞∞Ïö∞Í∏∞Ïóê ÏµúÏ†ÅÏùò ÎÇ†ÏûÖÎãàÎã§",
                    "Ïñ¥Î†§Ïö¥ Î¨∏Ï†úÏóê ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî",
                    "Í∑∏Î£π Ïä§ÌÑ∞ÎîîÎÇò ÌÜ†Î°†Ïù¥ ÌäπÌûà Ìö®Í≥ºÏ†ÅÏùº Í≤ÉÏûÖÎãàÎã§",
                    "Ïò§Îäò Î∞∞Ïö¥ ÎÇ¥Ïö©ÏùÄ Ïò§Îûò Í∏∞ÏñµÎê† Í≤ÉÏûÖÎãàÎã§",
                    "ÌèâÏÜåÎ≥¥Îã§ 1.5Î∞∞ ÎßéÏùÄ Î∂ÑÎüâÏùÑ ÏÜåÌôîÌï† Ïàò ÏûàÏñ¥Ïöî",
                    "Ï∞ΩÏùòÏ†ÅÏù∏ Î¨∏Ï†ú Ìï¥Í≤∞ Î∞©Î≤ïÏùÑ ÏãúÎèÑÌï¥Î≥¥ÏÑ∏Ïöî",
                    "ÏÑ†ÏÉùÎãòÍªò Ïñ¥Î†§Ïö¥ ÏßàÎ¨∏ÏùÑ ÎçòÏ†∏Î≥¥ÏÑ∏Ïöî",
                    "ÏÉàÎ°úÏö¥ ÌïôÏäµ Ïï±Ïù¥ÎÇò ÎèÑÍµ¨Î•º ÌôúÏö©Ìï¥Î≥¥ÏÑ∏Ïöî"
                ],
                studyTips: [
                    "Ïò§ÎäòÏùÄ ÌèâÏÜåÎ≥¥Îã§ 30% Îçî ÏßëÏ§ëÌï† Ïàò ÏûàÎäî ÎÇ†ÏûÖÎãàÎã§!",
                    "Í∞ÄÏû• Ïñ¥Î†§Ïö¥ Í≥ºÎ™©Î∂ÄÌÑ∞ ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî!",
                    "ÏÉàÎ°úÏö¥ ÌïôÏäµÎ≤ïÏùÑ ÏãúÎèÑÌïòÍ∏∞ ÏµúÏ†ÅÏùò ÎÇ†Ïù¥ÏóêÏöî!",
                    "ÏπúÍµ¨Îì§Í≥º Ïä§ÌÑ∞Îîî Í∑∏Î£πÏùÑ ÎßåÎì§Ïñ¥Î≥¥ÏÑ∏Ïöî!"
                ]
            },
            verygood: {
                icon: "üåü",
                title: "Îß§Ïö∞ Ï¢ãÏùÄ ÌïôÏäµ Í∏∞Ïö¥!",
                stars: "‚≠ê‚≠ê‚≠ê‚≠ê",
                color: "from-orange-400 to-red-500",
                bgColor: "rgba(255, 140, 0, 0.1)",
                advice: [
                    "ÏßëÏ§ëÎ†•Ïù¥ Îõ∞Ïñ¥ÎÇú ÎÇ†ÏûÖÎãàÎã§",
                    "Ï§ëÏöîÌïú Í∞úÎÖê Ï†ïÎ¶¨Ïóê ÏµúÏ†ÅÏûÖÎãàÎã§",
                    "ÏïîÍ∏∞Î≥¥Îã§Îäî Ïù¥Ìï¥ Ï§ëÏã¨ÏúºÎ°ú Í≥µÎ∂ÄÌïòÏÑ∏Ïöî",
                    "ÏÑ†ÏÉùÎãòÍªò ÏßàÎ¨∏ÌïòÍ∏∞ Ï¢ãÏùÄ ÎÇ†Ïù¥ÏóêÏöî",
                    "Î≥µÏû°Ìïú Í≥µÏãùÏù¥ÎÇò Í∞úÎÖêÏùÑ ÎßàÏä§ÌÑ∞ÌïòÍ∏∞ Ï¢ãÏäµÎãàÎã§",
                    "ÎÖºÎ¶¨Ï†Å ÏÇ¨Í≥†Í∞Ä ÌïÑÏöîÌïú Í≥ºÎ™©Ïóê ÏßëÏ§ëÌïòÏÑ∏Ïöî",
                    "ÏòàÏäµÎ≥¥Îã§Îäî Ïã¨Ìôî ÌïôÏäµÏóê ÏãúÍ∞ÑÏùÑ Ìà¨ÏûêÌïòÏÑ∏Ïöî",
                    "Ïò§Îäò Ï†ïÎ¶¨Ìïú ÎÇ¥Ïö©ÏùÄ ÏãúÌóòÏóê ÎÇòÏò¨ ÌôïÎ•†Ïù¥ ÎÜíÏïÑÏöî"
                ],
                studyTips: [
                    "ÍπäÏù¥ ÏûàÎäî ÌïôÏäµÏóê ÏßëÏ§ëÌï¥Î≥¥ÏÑ∏Ïöî!",
                    "Ïñ¥Î†§Ïö¥ Î¨∏Ï†úÏßëÏùÑ ÎèÑÏ†ÑÌï¥Î≥¥Îäî ÎÇ†Ïù¥ÏóêÏöî!",
                    "Í∞úÎÖê Ïó∞Í≤∞ Í≥†Î¶¨Î•º Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî!",
                    "Ïò§Îäò Î∞∞Ïö¥ ÎÇ¥Ïö©ÏùÑ ÏπúÍµ¨ÏóêÍ≤å ÏÑ§Î™ÖÌï¥Î≥¥ÏÑ∏Ïöî!"
                ]
            },
            good: {
                icon: "üìà",
                title: "Ï¢ãÏùÄ ÌïôÏäµ ÌùêÎ¶Ñ!",
                stars: "‚≠ê‚≠ê‚≠ê‚≠ê",
                color: "from-green-400 to-blue-500",
                bgColor: "rgba(76, 175, 80, 0.1)",
                advice: [
                    "Íæ∏Ï§ÄÌïú Î≥µÏäµÏù¥ ÌÅ∞ Ìö®Í≥ºÎ•º Í∞ÄÏ†∏Ïò¨ Í≤ÉÏûÖÎãàÎã§",
                    "Í≥ÑÌöçÏùÑ ÏÑ∏Ïõå Ï≤¥Í≥ÑÏ†ÅÏúºÎ°ú Í≥µÎ∂ÄÌïòÏÑ∏Ïöî",
                    "ÎÖ∏Ìä∏ Ï†ïÎ¶¨Í∞Ä ÌäπÌûà Ïûò Îê† Í≤ÉÏûÖÎãàÎã§",
                    "ÏπúÍµ¨ÏôÄ Ìï®Íªò Í≥µÎ∂ÄÌïòÎ©¥ ÎçîÏö± Ìö®Í≥ºÏ†ÅÏûÖÎãàÎã§",
                    "ÏãúÍ∞Ñ Í¥ÄÎ¶¨Í∞Ä ÌèâÏÜåÎ≥¥Îã§ Ïûò Îê† Í≤ÉÏûÖÎãàÎã§",
                    "Îã®Í≥ÑÎ≥ÑÎ°ú Ï∞®Í∑ºÏ∞®Í∑º ÏßÑÌñâÌïòÎäî Í≤ÉÏù¥ Ï¢ãÏïÑÏöî",
                    "Ïò§ÎãµÎÖ∏Ìä∏ Ï†ïÎ¶¨ÌïòÍ∏∞Ïóê ÏµúÏ†ÅÏùò ÎÇ†ÏûÖÎãàÎã§",
                    "Ïó¨Îü¨ Í≥ºÎ™©ÏùÑ Í≥®Í≥†Î£® Í≥µÎ∂ÄÌïòÏÑ∏Ïöî"
                ],
                studyTips: [
                    "Ìè¨Î™®ÎèÑÎ°ú Í∏∞Î≤ï(25Î∂Ñ ÏßëÏ§ë + 5Î∂Ñ Ìú¥Ïãù)ÏùÑ ÌôúÏö©Ìï¥Î≥¥ÏÑ∏Ïöî!",
                    "Ïª¨Îü¨ÌéúÏúºÎ°ú Ï§ëÏöîÌïú Î∂ÄÎ∂ÑÏùÑ ÌëúÏãúÌï¥Î≥¥ÏÑ∏Ïöî!",
                    "Í≥ÑÌöçÌëúÎ•º ÎßåÎì§Ïñ¥ÏÑú Ï≤¥ÌÅ¨ÌïòÎ©∞ Í≥µÎ∂ÄÌï¥Î≥¥ÏÑ∏Ïöî!",
                    "Î∞∞Í≤ΩÏùåÏïÖÏùÑ Îì§ÏúºÎ©∞ Í≥µÎ∂ÄÌïòÎ©¥ Îçî Ìö®Í≥ºÏ†ÅÏùº Í±∞ÏòàÏöî!"
                ]
            },
            normal: {
                icon: "üìö",
                title: "ÌèâÎ≤îÌïú ÌïôÏäµÏùº",
                stars: "‚≠ê‚≠ê‚≠ê",
                color: "from-blue-400 to-purple-500",
                bgColor: "rgba(33, 150, 243, 0.1)",
                advice: [
                    "Í∏∞Î≥∏Í∏∞Î•º Îã§ÏßÄÎäî Îç∞ ÏßëÏ§ëÌïòÏÑ∏Ïöî",
                    "Î¨¥Î¶¨ÌïòÏßÄ ÎßêÍ≥† Íæ∏Ï§ÄÌûà Í≥µÎ∂ÄÌïòÎäî Í≤ÉÏù¥ Ï¢ãÏäµÎãàÎã§",
                    "Ìú¥ÏãùÍ≥º ÌïôÏäµÏùò Í∑†ÌòïÏùÑ ÎßûÏ∂îÏÑ∏Ïöî",
                    "Í∞ÄÎ≤ºÏö¥ Î≥µÏäµÏúºÎ°ú ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî",
                    "Í∏∞Ï¥à Î¨∏Ï†úÎ∂ÄÌÑ∞ Ï∞®Í∑ºÏ∞®Í∑º ÌíÄÏñ¥Î≥¥ÏÑ∏Ïöî",
                    "Î∂ÄÎã¥Ïä§ÎüΩÏßÄ ÏïäÏùÄ Î∂ÑÎüâÏúºÎ°ú Í≥ÑÌöçÏùÑ ÏÑ∏Ïö∞ÏÑ∏Ïöî",
                    "ÌèâÏÜå Ï¢ãÏïÑÌïòÎäî Í≥ºÎ™©Î∂ÄÌÑ∞ ÏãúÏûëÌïòÏÑ∏Ïöî",
                    "Ï∂©Î∂ÑÌïú ÏàòÎ©¥Í≥º Ìú¥ÏãùÏùÑ Ï∑®ÌïòÎ©∞ Í≥µÎ∂ÄÌïòÏÑ∏Ïöî"
                ],
                studyTips: [
                    "Ïò§ÎäòÏùÄ Í∞ÄÎ≤ºÏö¥ ÎèÖÏÑúÎÇò ÏöîÏïΩ Ï†ïÎ¶¨Í∞Ä Ï¢ãÍ≤†Ïñ¥Ïöî!",
                    "Í∏∞Î≥∏ Í∞úÎÖê ÏúÑÏ£ºÎ°ú Ï≤úÏ≤úÌûà Í≥µÎ∂ÄÌï¥Î≥¥ÏÑ∏Ïöî!",
                    "Ïä§Ìä∏Î†àÏπ≠ÏùÑ ÏûêÏ£º ÌïòÎ©∞ Í≥µÎ∂ÄÌïòÏÑ∏Ïöî!",
                    "Ï¢ãÏïÑÌïòÎäî Í∞ÑÏãùÏùÑ Ï§ÄÎπÑÌï¥ÏÑú Í≥µÎ∂ÄÌï¥Î≥¥ÏÑ∏Ïöî!"
                ]
            },
            caution: {
                icon: "‚ö°",
                title: "Ï£ºÏùòÍ∞Ä ÌïÑÏöîÌïú ÌïôÏäµÏùº",
                stars: "‚≠ê‚≠ê",
                color: "from-yellow-500 to-orange-600",
                bgColor: "rgba(255, 152, 0, 0.1)",
                advice: [
                    "ÏÇ∞ÎßåÌï¥ÏßÄÍ∏∞ Ïâ¨Ïö∞Îãà ÌôòÍ≤ΩÏùÑ Ï†ïÎ¶¨ÌïòÏÑ∏Ïöî",
                    "ÏßßÏùÄ ÏãúÍ∞ÑÏù¥ÎùºÎèÑ ÏßëÏ§ëÌï¥ÏÑú Í≥µÎ∂ÄÌïòÏÑ∏Ïöî",
                    "Ïä§ÎßàÌä∏Ìè∞ÏùÑ Î©ÄÎ¶¨ ÎëêÍ≥† Í≥µÎ∂ÄÌïòÏÑ∏Ïöî",
                    "Í≥ÑÌöçÏùÑ Îã®ÏàúÌïòÍ≤å ÏÑ∏Ïö∞Îäî Í≤ÉÏù¥ Ï¢ãÏäµÎãàÎã§",
                    "Ìïú Î≤àÏóê Ìïú Í≥ºÎ™©Îßå ÏßëÏ§ëÌïòÏÑ∏Ïöî",
                    "Ï°∞Ïö©Ìïú Ïû•ÏÜåÏóêÏÑú Í≥µÎ∂ÄÌïòÎäî Í≤ÉÏù¥ Ï¢ãÏïÑÏöî",
                    "Î≥µÏû°Ìïú ÎÇ¥Ïö©Î≥¥Îã§ Í∞ÑÎã®Ìïú Í≤ÉÎ∂ÄÌÑ∞ ÏãúÏûëÌïòÏÑ∏Ïöî",
                    "ÏπúÍµ¨Îì§Í≥ºÏùò Ïû°Îã¥ÏùÄ Ïû†Ïãú ÎØ∏Î§ÑÎëêÏÑ∏Ïöî"
                ],
                studyTips: [
                    "Ïò§ÎäòÏùÄ Ìïú Í≥ºÎ™©ÏóêÎßå ÏßëÏ§ëÌï¥Î≥¥ÏÑ∏Ïöî!",
                    "ÌÉÄÏù¥Î®∏Î•º ÏÑ§Ï†ïÌï¥ÏÑú ÏßßÍ≤å ÏßßÍ≤å Í≥µÎ∂ÄÌï¥Î≥¥ÏÑ∏Ïöî!",
                    "Ìï∏ÎìúÌè∞ÏùÑ Îã§Î•∏ Î∞©Ïóê ÎëêÍ≥† Í≥µÎ∂ÄÌïòÏÑ∏Ïöî!",
                    "Í∞ÑÎã®Ìïú Î¨∏Ï†úÎ∂ÄÌÑ∞ Ï∞®Í∑ºÏ∞®Í∑º ÌíÄÏñ¥Î≥¥ÏÑ∏Ïöî!"
                ]
            },
            challenging: {
                icon: "üß†",
                title: "ÏßëÏ§ëÎ†• ÌïÑÏöîÌïú ÎÇ†",
                stars: "‚≠ê‚≠ê",
                color: "from-purple-400 to-pink-500",
                bgColor: "rgba(156, 39, 176, 0.1)",
                advice: [
                    "Ïñ¥Î†§Ïö¥ ÎÇ¥Ïö©ÏùÄ ÌîºÌïòÍ≥† Ïâ¨Ïö¥ Í≤ÉÎ∂ÄÌÑ∞ ÏãúÏûëÌïòÏÑ∏Ïöî",
                    "ÏπúÍµ¨ÎÇò ÏÑ†ÏÉùÎãòÍ≥º Ìï®Íªò Í≥µÎ∂ÄÌïòÎ©¥ ÎèÑÏõÄÏù¥ Îê† Í≤ÉÏûÖÎãàÎã§",
                    "Ï∂©Î∂ÑÌïú Ìú¥ÏãùÏùÑ Ï∑®ÌïòÎ©∞ Í≥µÎ∂ÄÌïòÏÑ∏Ïöî",
                    "Î¨¥Î¶¨ÌïòÏßÄ ÎßêÍ≥† Í∏∞Î≥∏ Í∞úÎÖêÎßå Ï†êÍ≤ÄÌï¥Î≥¥ÏÑ∏Ïöî",
                    "ÌòºÏûê ÌïòÍ∏∞ Ïñ¥Î†§Ïö¥ ÎÇ¥Ïö©ÏùÄ ÎèÑÏõÄÏùÑ ÏöîÏ≤≠ÌïòÏÑ∏Ïöî",
                    "ÏôÑÎ≤ΩÏùÑ Ï∂îÍµ¨ÌïòÍ∏∞Î≥¥Îã§ Ïù¥Ìï¥Ïóê Ï§ëÏ†êÏùÑ ÎëêÏÑ∏Ïöî",
                    "Ïä§Ìä∏Î†àÏä§Î•º Î∞õÏßÄ ÎßêÍ≥† Ïó¨Ïú†Î°≠Í≤å Ï†ëÍ∑ºÌïòÏÑ∏Ïöî",
                    "ÌèâÏÜåÎ≥¥Îã§ Ìú¥Ïãù ÏãúÍ∞ÑÏùÑ ÎäòÎ†§Í∞ÄÎ©∞ Í≥µÎ∂ÄÌïòÏÑ∏Ïöî"
                ],
                studyTips: [
                    "Ïò§ÎäòÏùÄ Î≥µÏäµ ÏúÑÏ£ºÎ°ú Í∞ÄÎ≥çÍ≤å Í≥µÎ∂ÄÌïòÏÑ∏Ïöî!",
                    "ÏπúÍµ¨ÏôÄ Ìï®Íªò Í≥µÎ∂ÄÌïòÎ©¥ Îçî Ï¢ãÏùÑ Í±∞ÏòàÏöî!",
                    "Ïñ¥Î†§Ïö¥ Î¨∏Ï†úÎäî ÎÇ¥ÏùºÎ°ú ÎØ∏Î§ÑÎèÑ Í¥úÏ∞ÆÏïÑÏöî!",
                    "Ï∂©Î∂ÑÌïú Ìú¥ÏãùÏùÑ Ï∑®ÌïòÎ©∞ Ï≤úÏ≤úÌûà ÌïòÏÑ∏Ïöî!"
                ]
            },
            review: {
                icon: "üîÑ",
                title: "Î≥µÏäµÏùò ÎÇ†!",
                stars: "‚≠ê‚≠ê‚≠ê",
                color: "from-indigo-400 to-purple-600",
                bgColor: "rgba(103, 58, 183, 0.1)",
                advice: [
                    "ÏÉàÎ°úÏö¥ ÎÇ¥Ïö©Î≥¥Îã§ Í∏∞Ï°¥ ÎÇ¥Ïö© Ï†ïÎ¶¨Ïóê ÏßëÏ§ëÌïòÏÑ∏Ïöî",
                    "Ïò§ÎãµÎÖ∏Ìä∏Î•º Ï†êÍ≤ÄÌïòÍ∏∞ Ï¢ãÏùÄ ÎÇ†ÏûÖÎãàÎã§",
                    "Ìó∑Í∞àÎ¶¨Îäî Í∞úÎÖêÎì§ÏùÑ Îã§Ïãú Ï†ïÎ¶¨Ìï¥Î≥¥ÏÑ∏Ïöî",
                    "Ïù¥Ï†ÑÏóê Ïñ¥Î†§Ïõ†Îçò Î¨∏Ï†úÎì§ÏùÑ Îã§Ïãú ÌíÄÏñ¥Î≥¥ÏÑ∏Ïöî",
                    "ÏßÄÎÇúÏ£º Î∞∞Ïö¥ ÎÇ¥Ïö©ÏùÑ ÌõëÏñ¥Î≥¥ÏÑ∏Ïöî",
                    "ÏïîÍ∏∞ÌñàÎçò ÎÇ¥Ïö©Îì§ÏùÑ Îã§Ïãú Ï†êÍ≤ÄÌï¥Î≥¥ÏÑ∏Ïöî",
                    "Í∞úÎÖê Í∞ÑÏùò Ïó∞Í≤∞Í≥†Î¶¨Î•º Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî",
                    "ÏãúÌóò Î≤îÏúÑÎ•º Ï†ÑÏ≤¥Ï†ÅÏúºÎ°ú Ï†ïÎ¶¨Ìï¥Î≥¥ÏÑ∏Ïöî"
                ],
                studyTips: [
                    "ÏßÄÎÇúÏ£º Î∞∞Ïö¥ ÎÇ¥Ïö©ÏùÑ ÌõëÏñ¥Î≥¥Îäî ÏãúÍ∞ÑÏùÑ Í∞ÄÏ†∏Î≥¥ÏÑ∏Ïöî!",
                    "Ïò§ÎãµÎÖ∏Ìä∏Î•º Í∫ºÎÇ¥ÏÑú Îã§Ïãú ÌíÄÏñ¥Î≥¥ÏÑ∏Ïöî!",
                    "ÌòïÍ¥ëÌéúÏúºÎ°ú Ï§ëÏöîÌïú Î∂ÄÎ∂ÑÏùÑ Îã§Ïãú Ï≤¥ÌÅ¨Ìï¥Î≥¥ÏÑ∏Ïöî!",
                    "ÏπúÍµ¨ÏôÄ ÏÑúÎ°ú Î¨∏Ï†úÎ•º ÎÇ¥Î©∞ Î≥µÏäµÌï¥Î≥¥ÏÑ∏Ïöî!"
                ]
            },
            creative: {
                icon: "üé®",
                title: "Ï∞ΩÏùòÏ†Å ÌïôÏäµÏùº!",
                stars: "‚≠ê‚≠ê‚≠ê‚≠ê",
                color: "from-pink-400 to-red-500",
                bgColor: "rgba(233, 30, 99, 0.1)",
                advice: [
                    "ÎßàÏù∏ÎìúÎßµÏúºÎ°ú Í∞úÎÖêÏùÑ Ï†ïÎ¶¨Ìï¥Î≥¥ÏÑ∏Ïöî",
                    "Îã§ÏñëÌïú ÌïôÏäµ Î∞©Î≤ïÏùÑ ÏãúÎèÑÌï¥Î≥¥ÏÑ∏Ïöî",
                    "Í∑∏Î¶ºÏù¥ÎÇò ÎèÑÌëúÎ•º ÌôúÏö©Ìïú Ï†ïÎ¶¨Í∞Ä Ìö®Í≥ºÏ†ÅÏûÖÎãàÎã§",
                    "Ï∞ΩÏùòÏ†ÅÏù∏ Î¨∏Ï†ú Ìï¥Í≤∞ Î∞©Î≤ïÏùÑ Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî",
                    "Ïä§ÌÜ†Î¶¨ÌÖîÎßÅÏúºÎ°ú Í∞úÎÖêÏùÑ Í∏∞ÏñµÌï¥Î≥¥ÏÑ∏Ïöî",
                    "ÏÉâÍπîÍ≥º Í∏∞Ìò∏Î•º ÌôúÏö©Ìï¥ÏÑú ÎÖ∏Ìä∏Î•º Ï†ïÎ¶¨ÌïòÏÑ∏Ïöî",
                    "ÏïîÍ∏∞Î≥¥Îã§Îäî Ïù¥ÎØ∏ÏßÄÎ°ú Ïó∞ÏÉÅÌï¥ÏÑú Í∏∞ÏñµÌïòÏÑ∏Ïöî",
                    "ÏÉàÎ°úÏö¥ ÌïôÏäµ ÎèÑÍµ¨ÎÇò Ïï±ÏùÑ ÌôúÏö©Ìï¥Î≥¥ÏÑ∏Ïöî"
                ],
                studyTips: [
                    "Ïò§ÎäòÏùÄ ÏÉâÍπî ÌéúÏúºÎ°ú ÏòàÏÅòÍ≤å ÎÖ∏Ìä∏ Ï†ïÎ¶¨Î•º Ìï¥Î≥¥ÏÑ∏Ïöî!",
                    "ÎßàÏù∏ÎìúÎßµÏùÑ Í∑∏Î†§Í∞ÄÎ©∞ Í≥µÎ∂ÄÌï¥Î≥¥ÏÑ∏Ïöî!",
                    "Í∑∏Î¶ºÏù¥ÎÇò Îã§Ïù¥Ïñ¥Í∑∏Îû®ÏùÑ Í∑∏Î†§Î≥¥ÏÑ∏Ïöî!",
                    "ÎÖ∏ÎûòÎÇò Î¶¨Îì¨Ïóê ÎßûÏ∂∞ÏÑú ÏïîÍ∏∞Ìï¥Î≥¥ÏÑ∏Ïöî!"
                ]
            },
            motivated: {
                icon: "üî•",
                title: "ÎèôÍ∏∞Î∂ÄÏó¨ ÏµúÍ≥†Ï°∞!",
                stars: "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
                color: "from-red-500 to-pink-600",
                bgColor: "rgba(244, 67, 54, 0.1)",
                advice: [
                    "Î™©ÌëúÎ•º ÎÜíÍ≤å ÏÑ§Ï†ïÌïòÍ≥† ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî",
                    "ÌèâÏÜå Ïñ¥Î†§ÏõåÌñàÎçò Í≥ºÎ™©Ïóê ÏßëÏ§ëÌïòÏÑ∏Ïöî",
                    "Ïû•Í∏∞Ï†ÅÏù∏ ÌïôÏäµ Í≥ÑÌöçÏùÑ ÏÑ∏Ïö∞Í∏∞ Ï¢ãÏùÄ ÎÇ†ÏûÖÎãàÎã§",
                    "ÏûêÏã†Í∞êÏùÑ Í∞ÄÏßÄÍ≥† Í≥µÎ∂ÄÏóê ÏûÑÌïòÏÑ∏Ïöî",
                    "ÎèÑÏ†ÑÏ†ÅÏù∏ Î¨∏Ï†úÎì§ÏùÑ Ï†ÅÍ∑πÏ†ÅÏúºÎ°ú ÌíÄÏñ¥Î≥¥ÏÑ∏Ïöî",
                    "ÏÉàÎ°úÏö¥ ÌïôÏäµ Î™©ÌëúÎ•º ÏÑ§Ï†ïÌï¥Î≥¥ÏÑ∏Ïöî",
                    "Í≤ΩÏüÅ ÏùòÏãùÏùÑ ÌôúÏö©Ìï¥ÏÑú Í≥µÎ∂ÄÌï¥Î≥¥ÏÑ∏Ïöî",
                    "ÏÑ±Ï∑®Í∞êÏùÑ ÎäêÎÇÑ Ïàò ÏûàÎäî ÏûëÏùÄ Î™©ÌëúÎì§ÏùÑ ÎßåÎì§Ïñ¥Î≥¥ÏÑ∏Ïöî"
                ],
                studyTips: [
                    "Ïò§ÎäòÏùÄ ÍøàÍ≥º Î™©ÌëúÎ•º Îã§Ïãú ÌïúÎ≤à ÎêòÏÉàÍ≤®Î≥¥ÏÑ∏Ïöî!",
                    "Í∞ÄÏû• Ïñ¥Î†§Ïö¥ Î¨∏Ï†úÏßëÏùÑ ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî!",
                    "Í≥µÎ∂Ä ÏãúÍ∞ÑÏùÑ ÌèâÏÜåÎ≥¥Îã§ ÎäòÎ†§Î≥¥ÏÑ∏Ïöî!",
                    "ÏπúÍµ¨Îì§Í≥º Í≥µÎ∂Ä Í≤ΩÏüÅÏùÑ Ìï¥Î≥¥ÏÑ∏Ïöî!"
                ]
            },
            calm: {
                icon: "üßò",
                title: "Ï∞®Î∂ÑÌïú ÌïôÏäµÏùº",
                stars: "‚≠ê‚≠ê‚≠ê",
                color: "from-teal-400 to-blue-600",
                bgColor: "rgba(0, 150, 136, 0.1)",
                advice: [
                    "Ï∞®Î∂ÑÌïòÍ≤å Ìïú Îã®Í≥ÑÏî© Í≥µÎ∂ÄÌï¥ÎÇòÍ∞ÄÏÑ∏Ïöî",
                    "Î™ÖÏÉÅÏù¥ÎÇò ÍπäÏùÄ Ìò∏Ìù°ÏúºÎ°ú ÎßàÏùåÏùÑ Í∞ÄÎùºÏïâÌûàÏÑ∏Ïöî",
                    "Ï°∞Ïö©Ìïú ÌôòÍ≤ΩÏóêÏÑú ÏßëÏ§ëÎ†•ÏùÑ Î∞úÌúòÌï† Ïàò ÏûàÏäµÎãàÎã§",
                    "Ïä§Ìä∏Î†àÏä§ ÏóÜÏù¥ Ïó¨Ïú†Î°≠Í≤å Í≥µÎ∂ÄÌïòÏÑ∏Ïöî",
                    "ÎäêÍ∏ãÌïòÍ≤å ÏãúÍ∞ÑÏùÑ Í∞ÄÏßÄÍ≥† Ïù¥Ìï¥ÌïòÎ©∞ Í≥µÎ∂ÄÌïòÏÑ∏Ïöî",
                    "ÎßàÏùåÏùò ÌèâÏ†ïÏùÑ Ïú†ÏßÄÌïòÎ©∞ ÌïôÏäµÏóê ÏûÑÌïòÏÑ∏Ïöî",
                    "Í∏âÌïòÍ≤å ÏÑúÎëêÎ•¥ÏßÄ ÎßêÍ≥† Ï∞®Í∑ºÏ∞®Í∑º ÏßÑÌñâÌïòÏÑ∏Ïöî",
                    "ÎÇ¥Î©¥Ïùò ÏßëÏ§ëÎ†•ÏùÑ ÎÅåÏñ¥Ïò¨Î†§Î≥¥ÏÑ∏Ïöî"
                ],
                studyTips: [
                    "Ï°∞Ïö©Ìïú ÏùåÏïÖÏùÑ Îì§ÏúºÎ©∞ Í≥µÎ∂ÄÌï¥Î≥¥ÏÑ∏Ïöî!",
                    "ÍπäÏùÄ Ìò∏Ìù°ÏùÑ ÌïòÎ©∞ ÎßàÏùåÏùÑ Ï∞®Î∂ÑÌûà ÌïòÏÑ∏Ïöî!",
                    "Ï≤úÏ≤úÌûà ÏùΩÍ≥† Ïù¥Ìï¥ÌïòÎ©∞ Í≥µÎ∂ÄÌï¥Î≥¥ÏÑ∏Ïöî!",
                    "Î™ÖÏÉÅÏùÑ 5Î∂Ñ ÌïòÍ≥† Í≥µÎ∂ÄÎ•º ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî!"
                ]
            }
        };
        
        // Ï†ÑÏ≤¥ ÌñâÏö¥Ïùò Í≥ºÎ™© Î™©Î°ù
        var allLuckySubjects = [
            "Íµ≠Ïñ¥", "ÎèÖÏÑú(ÎπÑÎ¨∏Ìïô)", "Î¨∏Ìïô", "ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏", "Ïñ∏Ïñ¥ÏôÄ Îß§Ï≤¥", 
            "ÏàòÌïô1", "ÏàòÌïô2", "ÎØ∏Ï†ÅÎ∂Ñ", "ÌôïÎ•†Í≥º ÌÜµÍ≥Ñ", "Í∏∞Ìïò", 
            "ÏòÅÏñ¥", "ÏòÅÏñ¥Îì£Í∏∞", "ÌïúÍµ≠ÏÇ¨", "Í≥ºÌÉê", "ÏÇ¨ÌÉê", 
            "ÎèÖÏÑú(Ïù∏Î¨∏)", "ÎèÖÏÑú(Í≥ºÌïô)", "ÎèÖÏÑú(ÏÇ¨Ìöå)", 
            "ÌòÑÎåÄÏãú", "ÌòÑÎåÄÏÜåÏÑ§", "Í≥†Ï†ÑÏãú", "Í≥†Ï†ÑÏÜåÏÑ§",
            "Î™®Îì† Í≥ºÎ™© Î≥µÏäµ", "Î™®ÏùòÍ≥†ÏÇ¨", "ÏòÅÏñ¥Îã®Ïñ¥", "ÏïîÍ∏∞Í≥ºÎ™©"
        ];
        
        // ÌïôÏóÖ Ïö¥ÏÑ∏ Í≥ÑÏÇ∞ Ìï®Ïàò (ÌñâÏö¥Ïùò Í≥ºÎ™© 2Í∞ú, ÌñâÏö¥Ïùò Î≤àÌò∏ 1Í∞ú ÎûúÎç§ ÏÑ†ÌÉù)
        function calculateStudyFortune(name) {
            if (!name) return null;
            
            var sum = 0;
            for (var i = 0; i < name.length; i++) {
                sum += name.charCodeAt(i);
            }
            
            var today = new Date();
            var dateSum = today.getDate() + today.getMonth() + today.getFullYear();
            sum += dateSum;
            
            var fortuneTypes = Object.keys(fortuneData);
            var index = sum % fortuneTypes.length;
            var type = fortuneTypes[index];
            
            // ÎûúÎç§ÌïòÍ≤å Ï°∞Ïñ∏ 3Í∞ú, ÌåÅ 1Í∞ú, ÌñâÏö¥Ïùò Í≥ºÎ™© 2Í∞ú, ÌñâÏö¥Ïùò Î≤àÌò∏ 1Í∞ú ÏÑ†ÌÉù
            var selectedAdvice = fortuneData[type].advice.slice().sort(() => 0.5 - Math.random()).slice(0, 3);
            var selectedTip = fortuneData[type].studyTips[Math.floor(Math.random() * fortuneData[type].studyTips.length)];
            var selectedSubjects = allLuckySubjects.slice().sort(() => 0.5 - Math.random()).slice(0, 2);
            var luckyNumber = Math.floor(Math.random() * 5) + 1; // 1~5 Ï§ë ÎûúÎç§
            
            return {
                type: type,
                data: {
                    ...fortuneData[type],
                    selectedAdvice: selectedAdvice,
                    selectedTip: selectedTip,
                    selectedSubjects: selectedSubjects,
                    luckyNumber: luckyNumber
                }
            };
        }
        
        // Ïö¥ÏÑ∏ ÌëúÏãú Ìï®Ïàò (ÌñâÏö¥Ïùò Í≥ºÎ™© 2Í∞ú + ÌñâÏö¥Ïùò Î≤àÌò∏ Ï∂îÍ∞Ä)
        function displayStudyFortune(name) {
            var fortune = calculateStudyFortune(name);
            if (!fortune) return '';
            
            return `
                <div class="ai-analysis" style="background: linear-gradient(135deg, ${fortune.data.bgColor}, ${fortune.data.bgColor}); color: #333; margin: 20px 0;">
                    <div class="ai-analysis-header">
                        <div class="ai-icon" style="background: ${fortune.data.bgColor}; color: #333;">
                            ${fortune.data.icon}
                        </div>
                        <div>
                            <h3 style="color: #333; font-size: 1.2em;">${name}ÎãòÏùò ÌïôÏóÖ Ïö¥ÏÑ∏</h3>
                            <div style="font-size: 1.4em; font-weight: bold; margin-top: 6px;">
                                <span style="color: #333;">${fortune.data.title}</span>
                                <span style="color: #FFD700; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); margin-left: 8px;">${fortune.data.stars}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ai-content">
                        <div style="background: rgba(255, 255, 255, 0.3); border-radius: 10px; padding: 12px; margin: 10px 0;">
                            <h4 style="color: #444; margin-bottom: 10px;">üí° Ïò§ÎäòÏùò ÌïôÏäµ Ï°∞Ïñ∏</h4>
                            <ul style="margin: 0; padding-left: 20px; color: #555;">
                                ${fortune.data.selectedAdvice.map(advice => `<li style="margin-bottom: 5px;">${advice}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                            <div style="background: rgba(255, 255, 255, 0.3); border-radius: 12px; padding: 15px;">
                                <h4 style="color: #444; margin-bottom: 10px;">üìö ÌñâÏö¥Ïùò Í≥ºÎ™©</h4>
                                <div style="display: flex; flex-direction: column; gap: 8px;">
                                    ${fortune.data.selectedSubjects.map(subject => 
                                        `<span style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 6px 12px; border-radius: 15px; font-size: 0.9em; font-weight: bold; text-align: center;">${subject}</span>`
                                    ).join('')}
                                </div>
                            </div>
                            
                            <div style="background: rgba(255, 255, 255, 0.3); border-radius: 12px; padding: 15px;">
                                <h4 style="color: #444; margin-bottom: 10px;">üçÄ ÌñâÏö¥Ïùò Î≤àÌò∏</h4>
                                <div style="display: flex; justify-content: center; align-items: center; height: 60px;">
                                    <span style="
                                        background: linear-gradient(45deg, #ff6b6b, #feca57); 
                                        color: white; 
                                        font-size: 2em; 
                                        font-weight: bold; 
                                        width: 50px; 
                                        height: 50px; 
                                        border-radius: 50%; 
                                        display: flex; 
                                        align-items: center; 
                                        justify-content: center;
                                        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                                    ">${fortune.data.luckyNumber}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: rgba(255, 255, 255, 0.3); border-radius: 12px; padding: 15px; margin: 15px 0;">
                            <h4 style="color: #444; margin-bottom: 10px;">üéØ Ïò§ÎäòÏùò ÌïôÏäµ ÌåÅ</h4>
                            <p style="color: #444; font-weight: 500; margin: 0; font-style: italic;">
                                "${fortune.data.selectedTip}"
                            </p>
                        </div>
                        
                        <div style="font-size: 0.85em; color: #666; text-align: center; margin-top: 10px;">
                            üí° Ïö¥ÏÑ∏Îäî Ïû¨ÎØ∏Î°úÎßå Ï∞∏Í≥†ÌïòÏÑ∏Ïöî. ÏßÑÏßú Ï§ëÏöîÌïú Í±¥ Íæ∏Ï§ÄÌïú ÎÖ∏Î†•ÏûÖÎãàÎã§!
                            <br><br>
                            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                                <a href="https://www.instagram.com/swwweet.daekun/" target="_blank" style="
                                    display: inline-flex; 
                                    align-items: center; 
                                    gap: 8px; 
                                    background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D, #F56040, #F77737, #FCAF45, #FFDC80);
                                    color: white; 
                                    text-decoration: none; 
                                    padding: 22px 42px; 
                                    border-radius: 27px; 
                                    font-weight: bold; 
                                    font-size: 1.2em;
                                    transition: transform 0.2s;
                                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                    üì∏ Í¥ÄÎ¶¨Ïûê ÎåÄÍ±¥T Instagram
                                </a>
                                <a href="https://jdmedu.github.io/university-predictor/" target="_blank" style="
                                    display: inline-flex; 
                                    align-items: center; 
                                    gap: 8px; 
                                    background: linear-gradient(45deg, #4CAF50, #45a049, #66BB6A, #81C784);
                                    color: white; 
                                    text-decoration: none; 
                                   padding: 22px 42px; 
                                    border-radius: 27px; 
                                    font-weight: bold; 
                                    font-size: 1.2em;
                                    transition: transform 0.2s;
                                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                    üéì ÎåÄÏûÖ Ìï©Í≤© ÏòàÏ∏° ÏãúÏä§ÌÖú
                                </a>
                                
                            </div>
                    </div>
                </div>
            `;
        }
        
        var studentByNumber = {};
        var isDataLoaded = false;
        var githubConfig = {};
        var dataUrl = '';
        var isAdminAuthenticated = false;
        
        var maxScores = {}; // ÌïòÎìúÏΩîÎî©Îêú Í∞í Ï†úÍ±∞, ÏóëÏÖÄÏóêÏÑú Ï∂îÏ∂úÌïú Í∞íÎßå ÏÇ¨Ïö©

        // üÜï Ï†ïÎèôÎØºÍµ≠Ïñ¥ÎÖºÏà†ÌïôÏõê Ïã§Ï†ú Íµ¨Í∏ÄÎìúÎùºÏù¥Î∏å ÌïôÏäµ ÏûêÎ£å ÎßÅÌÅ¨ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§
var studyMaterialsDB = {
    "ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏": {
        "Í∏∞Î≥∏": [
            {
                name: "Ï¢ÖÌï© Î™®ÏùòÍ≥†ÏÇ¨ Í∏∞Ï¥à",
                url: "https://drive.google.com/file/d/1qOkQKIX1lWt37tNxePyTjINXB6MNcayG/view?usp=drive_link",
                description: "ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏ Ìè¨Ìï® Í∏∞Ï¥à Ï¢ÖÌï© Î¨∏Ï†úÏßë"
            }
        ],
        "Ïã¨Ìôî": [
            {
                name: "ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏ Ïã¨Ìôî",
                url: "https://drive.google.com/file/d/1ZbDEBiPnj-TDwSk79GlXWgnprAwti-na/view?usp=drive_link",
                description: "ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏ Í≥†ÎÇúÎèÑ Î¨∏Ï†ú ÏôÑÏ†Ñ Ï†ïÎ≥µ"
            },
            {
                name: "Ï¢ÖÌï© ÎπÑÍ∏∞Ï∂ú Î™®ÏùòÍ≥†ÏÇ¨ 1Ìöå",
                url: "https://drive.google.com/file/d/1IgMkqG6TGaqXnn6hGgN4nOeY3X0SuSlF/view?usp=sharing",
                description: "ÏµúÏã† ÎπÑÍ∏∞Ï∂ú Ï¢ÖÌï© Î™®ÏùòÍ≥†ÏÇ¨"
            }
        ],
        "ÏùºÏùºÌïôÏäµ": [
            {
                name: "Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ 1",
                url: "https://drive.google.com/file/d/1bcUdiiC-fMD-YbWZefIem3vZhJKNtGMg/view?usp=drive_link",
                description: "Îß§Ïùº Íæ∏Ï§ÄÌûà Ìë∏Îäî ÌïôÏäµÏßÄ"
            },
            {
                name: "Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ 2",
                url: "https://drive.google.com/file/d/10zxhT-TtlrpRuaZ3l0Hx0hvzZ6XR0Cs2/view?usp=drive_link",
                description: "Îß§Ïùº Íæ∏Ï§ÄÌûà Ìë∏Îäî ÌïôÏäµÏßÄ"
            }
        ]
    },
    "Î¨∏Î≤ï": {
        "Í∏∞Î≥∏": [
            {
                name: "Î¨∏Î≤ï Í∏∞Ï¥à",
                url: "https://drive.google.com/file/d/1asKNJifDXFQso-e5zP9DjH8HT5cxY0js/view?usp=drive_link",
                description: "Íµ≠Ïñ¥ Î¨∏Î≤ïÏùò Í∏∞Ï¥àÎ•º Îã§ÏßÄÎäî ÌïÑÏàò Î¨∏Ï†úÏßë"
            }
        ],
        "Ïã¨Ìôî": [
            {
                name: "Î¨∏Î≤ï Ïã¨Ìôî",
                url: "https://drive.google.com/file/d/1aMPZD1Q5OTIjrQHVx2toqzQrZfHbHEOp/view?usp=drive_link",
                description: "Í≥†ÎÇúÎèÑ Î¨∏Î≤ï Î¨∏Ï†ú ÏôÑÏ†Ñ Ï†ïÎ≥µ"
            },
            {
                name: "Î¨∏Î≤ï Ïã¨Ìôî2",
                url: "https://drive.google.com/file/d/1cxfkSUPePQnOWxj6zquvtO8ItZyYGxj7/view?usp=drive_link",
                description: "Ïã¨Ìôî Î¨∏Î≤ï Ï∂îÍ∞Ä Î¨∏Ï†úÏßë"
            }
        ]
    },
    "ÎèÖÏÑú(Ïù∏Î¨∏)": {
        "Í∏∞Î≥∏": [
            {
                name: "ÎèÖÏÑú Ïù∏Î¨∏ Ï≤†Ìïô Í∏∞Ï¥à",
                url: "https://drive.google.com/file/d/1Jh6h_XVFYMbsKkljwNA3WP7ZjUg8cZ11/view?usp=drive_link",
                description: "Ïù∏Î¨∏¬∑Ï≤†Ìïô ÏßÄÎ¨∏ Í∏∞Ï¥à Îã§ÏßÄÍ∏∞"
            },
            {
                name: "ÎèÖÏÑú Ï¢ÖÌï© Í∏∞Ï¥à",
                url: "https://drive.google.com/file/d/1sU0Kx9WCA-zofVKkbGF-PGwfR5JBSAsD/view?usp=drive_link",
                description: "ÎèÖÏÑú ÏòÅÏó≠ Ï†ÑÏ≤¥ Í∏∞Ï¥à Î¨∏Ï†úÏßë"
            }
        ],
        "Ïã¨Ìôî": [
            {
                name: "ÎèÖÏÑú Ïù∏Î¨∏ ÏÇ¨Ìöå Ïã¨Ìôî",
                url: "https://drive.google.com/file/d/1wXD1xGlMMtQn34_07Y_11jovcNvXH5gc/view?usp=drive_link",
                description: "Ïù∏Î¨∏¬∑ÏÇ¨Ìöå Î≥µÌï© ÏßÄÎ¨∏ Ïã¨Ìôî ÌïôÏäµ"
            },
            {
                name: "ÎèÖÏÑú Ïù∏Î¨∏ Î≤ï Ïã¨Ìôî2",
                url: "https://drive.google.com/file/d/17XOc0IM4Pk1ug6sutzFp2pBvtXaPm1ec/view?usp=drive_link",
                description: "Î≤ïÌïô Í¥ÄÎ†® Í≥†ÎÇúÎèÑ ÏßÄÎ¨∏ Î™®Ïùå"
            },
            {
                name: "ÎèÖÏÑú Ïù∏Î¨∏ Ï¢ÖÌï©",
                url: "https://drive.google.com/file/d/1K6SSBbdcjeqNOGXRhTtjBKOMljmaAal6/view?usp=drive_link",
                description: "Ïù∏Î¨∏ ÏòÅÏó≠ Ï¢ÖÌï© ÎßàÏä§ÌÑ∞"
            }
        ]
    },
    "ÎèÖÏÑú(ÏÇ¨Ìöå)": {
        "Í∏∞Î≥∏": [
            {
                name: "ÎèÖÏÑú ÏÇ¨Ìöå Í≤ΩÏ†ú Í∏∞Ï¥à",
                url: "https://drive.google.com/file/d/1VvA5ba5egy3-cq8ekWZrKuEpVsSWw-fl/view?usp=drive_link",
                description: "ÏÇ¨Ìöå¬∑Í≤ΩÏ†ú ÏßÄÎ¨∏ Í∏∞Ï¥à ÏôÑÏÑ±"
            }
        ],
        "Ïã¨Ìôî": [
            {
                name: "ÎèÖÏÑú ÏÇ¨Ìöå Í≤ΩÏ†ú Ïã¨Ìôî2",
                url: "https://drive.google.com/file/d/1F9Hogy9j6A92zwlBE8aJOU4wqb2Py7Cs/view?usp=drive_link",
                description: "ÏÇ¨Ìöå¬∑Í≤ΩÏ†ú Í≥†ÎÇúÎèÑ ÏßÄÎ¨∏ Ï†ïÎ≥µ"
            }
        ]
    },
    "ÎèÖÏÑú(Í≥ºÌïô)": {
        "Í∏∞Î≥∏": [
            {
                name: "ÎèÖÏÑú Í≥ºÌïô Í∏∞Ï¥à",
                url: "https://drive.google.com/file/d/1gcElUHAEJ6aa0aiV53HoBNd7DXc5GZah/view?usp=drive_link",
                description: "Í≥ºÌïô ÏßÄÎ¨∏ Í∏∞Ï¥à Ïã§Î†• Îã§ÏßÄÍ∏∞"
            }
        ],
        "Ïã¨Ìôî": [
            {
                name: "ÎèÖÏÑú Í≥ºÌïô Ïã¨Ìôî",
                url: "https://drive.google.com/file/d/1aMlCh4f4xCyR81oDdHweBzauGlNh5hCB/view?usp=drive_link",
                description: "Í≥ºÌïô ÏßÄÎ¨∏ Í≥†ÎÇúÎèÑ Î¨∏Ï†ú ÏôÑÏ†Ñ Ï†ïÎ≥µ"
            },
            {
                name: "ÎèÖÏÑú Í≥ºÌïô Ïã¨Ìôî2",
                url: "https://drive.google.com/file/d/1tTOhtdZhICu09hEJo_KvipKtMV8gkZWH/view?usp=drive_link",
                description: "Í≥ºÌïô ÏßÄÎ¨∏ Ï∂îÍ∞Ä Ïã¨Ìôî Î¨∏Ï†úÏßë"
            }
        ]
    },
    "Î¨∏Ìïô(ÌòÑÎåÄÏãú)": {
        "Í∏∞Î≥∏": [
            {
                name: "Î¨∏Ìïô Ïãú Ï¢ÖÌï© Í∏∞Ï¥à1",
                url: "https://drive.google.com/file/d/1JZCK5w2TediHz1JAv2LG-Dazkt_xgb8k/view?usp=drive_link",
                description: "ÌòÑÎåÄÏãú¬∑Í≥†Ï†ÑÏãúÍ∞Ä Í∏∞Ï¥à ÏôÑÏÑ±"
            },
            {
                name: "Î¨∏Ìïô Ïãú Ï¢ÖÌï© Í∏∞Ï¥à2",
                url: "https://drive.google.com/file/d/1SXMtvDQeitWKd4xqE5fMVxAtylUizwNe/view?usp=drive_link",
                description: "Ïãú Í∞àÎûòÎ≥Ñ Ïã¨Ìôî Í∏∞Ï¥à"
            },
            {
                name: "Î¨∏Ìïô Ï¢ÖÌï© Í∏∞Ï¥à",
                url: "https://drive.google.com/file/d/1XB5O4TVAxLmPrp4WMy0GxC0pBDgSDTnC/view?usp=drive_link",
                description: "Î¨∏Ìïô Ï†Ñ ÏòÅÏó≠ Í∏∞Ï¥à Î¨∏Ï†úÏßë"
            }
        ],
        "Ïã¨Ìôî": [
            {
                name: "Î¨∏Ìïô ÌòÑÎåÄÏãú Ïã¨Ìôî",
                url: "https://drive.google.com/file/d/1CMmDDBUPRBmr63GV_y0EvnNyTsozl5u9/view?usp=drive_link",
                description: "ÌòÑÎåÄÏãú Í≥†ÎÇúÎèÑ Î¨∏Ï†ú ÏôÑÏ†Ñ Ï†ïÎ≥µ"
            }
        ]
    },
    "Î¨∏Ìïô(ÌòÑÎåÄÏÜåÏÑ§)": {
        "Í∏∞Î≥∏": [
            {
                name: "Î¨∏Ìïô ÏÜåÏÑ§Ï¢ÖÌï© Í∏∞Ï¥à",
                url: "https://drive.google.com/file/d/1pCNTOOPmLpXcaXrRpkELE0dG4wvBpsfS/view?usp=drive_link",
                description: "ÌòÑÎåÄÏÜåÏÑ§¬∑Í≥†Ï†ÑÏÜåÏÑ§ Í∏∞Ï¥à ÏôÑÏÑ±"
            }
        ],
        "Ïã¨Ìôî": []
    },
    "Î¨∏Ìïô(Í≥†Ï†ÑÏãúÍ∞Ä)": {
        "Í∏∞Î≥∏": [
            {
                name: "Î¨∏Ìïô Í≥†Ï†ÑÏãúÍ∞Ä Í∏∞Ï¥à",
                url: "https://drive.google.com/file/d/1WDY_n8NIokdSx7xjivsMiOg01hNnJKvz/view?usp=drive_link",
                description: "Í≥†Ï†ÑÏãúÍ∞Ä Í∏∞Ï¥à ÏôÑÏ†Ñ Ï†ïÎ≥µ"
            },
            {
                name: "Î¨∏Ìïô Í≥†Ï†ÑÏãúÍ∞Ä Í∏∞Ï¥à2",
                url: "https://drive.google.com/file/d/1He6vP4_xVfat16bvFAFcG0MmD8bDYOf6/view?usp=drive_link",
                description: "Í≥†Ï†ÑÏãúÍ∞Ä Ï∂îÍ∞Ä Í∏∞Ï¥à Î¨∏Ï†úÏßë"
            }
        ],
        "Ïã¨Ìôî": [
            {
                name: "Î¨∏Ìïô Í≥†Ï†ÑÏãúÍ∞Ä Ïã¨Ìôî",
                url: "https://drive.google.com/file/d/1VkTFSQiRAIoyHbAmz4f7FhuXGSbSDCTI/view?usp=drive_link",
                description: "Í≥†Ï†ÑÏãúÍ∞Ä Í≥†ÎÇúÎèÑ Î¨∏Ï†ú ÏôÑÏ†Ñ Ï†ïÎ≥µ"
            }
        ]
    },
    "Î¨∏Ìïô(Í≥†Ï†ÑÏÜåÏÑ§)": {
        "Í∏∞Î≥∏": [
            {
                name: "Î¨∏Ìïô Í≥†Ï†ÑÏÜåÏÑ§ Í∏∞Ï¥à",
                url: "https://drive.google.com/file/d/17-dgV_wngT5QxOYBeusMHTAFKDNrPpcc/view?usp=drive_link",
                description: "Í≥†Ï†ÑÏÜåÏÑ§ Í∏∞Ï¥à ÏôÑÏ†Ñ Ï†ïÎ≥µ"
            },
            {
                name: "Î¨∏Ìïô Í≥†Ï†ÑÏÜåÏÑ§ Í∏∞Ï¥à2",
                url: "https://drive.google.com/file/d/1pI2GXelXVFIwUYrLxVwabw8Ww-mkRryF/view?usp=drive_link",
                description: "Í≥†Ï†ÑÏÜåÏÑ§ Ï∂îÍ∞Ä Í∏∞Ï¥à Î¨∏Ï†úÏßë"
            }
        ],
        "Ïã¨Ìôî": [
            {
                name: "Î¨∏Ìïô Í≥†Ï†ÑÏÜåÏÑ§ Ïã¨Ìôî",
                url: "https://drive.google.com/file/d/1qHvAH6fVK0LNzjG28TAiUw5XAv-crO1c/view?usp=drive_link",
                description: "Í≥†Ï†ÑÏÜåÏÑ§ Í≥†ÎÇúÎèÑ Î¨∏Ï†ú ÏôÑÏ†Ñ Ï†ïÎ≥µ"
            }
        ]
    },
    "Ï¢ÖÌï©Î™®ÏùòÍ≥†ÏÇ¨": {
        "Í∏∞Î≥∏": [
            {
                name: "Ï¢ÖÌï© Î™®ÏùòÍ≥†ÏÇ¨ Í∏∞Ï¥à",
                url: "https://drive.google.com/file/d/1qOkQKIX1lWt37tNxePyTjINXB6MNcayG/view?usp=drive_link",
                description: "Ï¢ÖÌï© Ïã§Î†• Ï†êÍ≤ÄÏö© Í∏∞Ï¥à Î™®ÏùòÍ≥†ÏÇ¨"
            }
        ],
        "Ïã¨Ìôî": [
            {
                name: "Ï¢ÖÌï© ÎπÑÍ∏∞Ï∂ú Î™®ÏùòÍ≥†ÏÇ¨ 1Ìöå",
                url: "https://drive.google.com/file/d/1IgMkqG6TGaqXnn6hGgN4nOeY3X0SuSlF/view?usp=sharing",
                description: "ÏµúÏã† ÎπÑÍ∏∞Ï∂ú Î¨∏Ï†ú Ï¢ÖÌï© Î™®ÏùòÍ≥†ÏÇ¨"
            },
            {
                name: "Ï¢ÖÌï© ÎπÑÍ∏∞Ï∂ú Î™®ÏùòÍ≥†ÏÇ¨ 2Ìöå",
                url: "https://drive.google.com/file/d/1MULcNrG5Sum6MSIS-_b7fOQENLi_6EZL/view?usp=drive_link",
                description: "ÏµúÏã† ÎπÑÍ∏∞Ï∂ú Î¨∏Ï†ú Ï¢ÖÌï© Î™®ÏùòÍ≥†ÏÇ¨"
            },
            {
                name: "Ï¢ÖÌï© ÎπÑÍ∏∞Ï∂ú Î™®ÏùòÍ≥†ÏÇ¨ 3Ìöå",
                url: "https://drive.google.com/file/d/1cVBxTc-Ib5Izjft3pVaynv6o8RR6GI6t/view?usp=drive_link",
                description: "ÏµúÏã† ÎπÑÍ∏∞Ï∂ú Î¨∏Ï†ú Ï¢ÖÌï© Î™®ÏùòÍ≥†ÏÇ¨"
            },
            {
                name: "Ï¢ÖÌï© ÎπÑÍ∏∞Ï∂ú Î™®ÏùòÍ≥†ÏÇ¨ 4Ìöå",
                url: "https://drive.google.com/file/d/1HkyUbvtuB2UoLqcpeJ4KG8z-WtMDqcs3/view?usp=drive_link",
                description: "ÏµúÏã† ÎπÑÍ∏∞Ï∂ú Î¨∏Ï†ú Ï¢ÖÌï© Î™®ÏùòÍ≥†ÏÇ¨"
            },
            {
                name: "Ï¢ÖÌï© ÎπÑÍ∏∞Ï∂ú Î™®ÏùòÍ≥†ÏÇ¨ 5Ìöå",
                url: "https://drive.google.com/file/d/1BodwpPNu0bLZqGrHMdl8KJqclIhXH5et/view?usp=drive_link",
                description: "ÏµúÏã† ÎπÑÍ∏∞Ï∂ú Î¨∏Ï†ú Ï¢ÖÌï© Î™®ÏùòÍ≥†ÏÇ¨"
            }
        ]
    },
    "Îß§ÏùºÌïôÏäµ": {
        "Í∏∞Î≥∏": [
            {
                name: "Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ 1",
                url: "https://drive.google.com/file/d/1bcUdiiC-fMD-YbWZefIem3vZhJKNtGMg/view?usp=drive_link",
                description: "Îß§Ïùº Íæ∏Ï§ÄÌûà ÌíÄ Ïàò ÏûàÎäî ÌïôÏäµÏßÄ"
            },
            {
                name: "Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ 2",
                url: "https://drive.google.com/file/d/10zxhT-TtlrpRuaZ3l0Hx0hvzZ6XR0Cs2/view?usp=drive_link",
                description: "Îß§Ïùº Íæ∏Ï§ÄÌûà ÌíÄ Ïàò ÏûàÎäî ÌïôÏäµÏßÄ"
            },
            {
                name: "Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ 3",
                url: "https://drive.google.com/file/d/1KiuExb_gwW1a-0PiEK0Kkt2eutmUYlmy/view?usp=drive_link",
                description: "Îß§Ïùº Íæ∏Ï§ÄÌûà ÌíÄ Ïàò ÏûàÎäî ÌïôÏäµÏßÄ"
            },
            {
                name: "Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ 4",
                url: "https://drive.google.com/file/d/15J21QHAnBeeXmf23JM08uN-IXpriAp_W/view?usp=drive_link",
                description: "Îß§Ïùº Íæ∏Ï§ÄÌûà ÌíÄ Ïàò ÏûàÎäî ÌïôÏäµÏßÄ"
            },
            {
                name: "Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ 5",
                url: "https://drive.google.com/file/d/1erTgXs51SZbM2EIOdve5SyBoAlMdPAWZ/view?usp=drive_link",
                description: "Îß§Ïùº Íæ∏Ï§ÄÌûà ÌíÄ Ïàò ÏûàÎäî ÌïôÏäµÏßÄ"
            }
        ],
        "Ïã¨Ìôî": [
            {
                name: "Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ 6",
                url: "https://drive.google.com/file/d/1dhjMMd3-7Nnbr515Z7RjtHFTSRTvBoJ5/view?usp=drive_link",
                description: "Ïã¨Ìôî Îã®Í≥Ñ Îß§Ïùº ÌïôÏäµÏßÄ"
            },
            {
                name: "Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ 7",
                url: "https://drive.google.com/file/d/1YueLR2rVHSaIfR_kq2YIChUE7FyRzCgh/view?usp=drive_link",
                description: "Ïã¨Ìôî Îã®Í≥Ñ Îß§Ïùº ÌïôÏäµÏßÄ"
            },
            {
                name: "Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ 8",
                url: "https://drive.google.com/file/d/1Sso3wQ0VUewT-59gzKm30iKLqQJL661t/view?usp=drive_link",
                description: "Ïã¨Ìôî Îã®Í≥Ñ Îß§Ïùº ÌïôÏäµÏßÄ"
            },
            {
                name: "Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ 9",
                url: "https://drive.google.com/file/d/1oyMOqkquGUd49oUbHKisjNsu1HVSjmLX/view?usp=drive_link",
                description: "Ïã¨Ìôî Îã®Í≥Ñ Îß§Ïùº ÌïôÏäµÏßÄ"
            },
            {
                name: "Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ 10",
                url: "https://drive.google.com/file/d/1l6a8nKlfdOLIgNKTuegA0KJkdEOis93L/view?usp=drive_link",
                description: "ÏµúÍ≥† ÎÇúÏù¥ÎèÑ Îß§Ïùº ÌïôÏäµÏßÄ"
            }
        ]
    }
};

// üÜï ÌòÑÏû¨ Ï£ºÏ∞® Í≥ÑÏÇ∞ (1ÎÖÑ 52Ï£º Í∏∞Ï§Ä)
function getCurrentWeekNumber() {
    const now = new Date();
    const start = new Date(now.getFullYear(), 0, 1);
    const diff = now - start;
    const oneWeek = 1000 * 60 * 60 * 24 * 7;
    const weekNumber = Math.ceil(diff / oneWeek);
    
    console.log('üìÖ Ïò¨Ìï¥ ' + now.getFullYear() + 'ÎÖÑ ' + weekNumber + 'Ï£ºÏ∞®');
    
    // 1-52Ï£º ÏàúÌôò (52Ï£ºÎ•º ÎÑòÏúºÎ©¥ Îã§Ïùå Ìï¥Î°ú ÎÑòÏñ¥Í∞ê)
    return ((weekNumber - 1) % 52) + 1;
}

// üÜï Îì±Í∏âÎ≥Ñ ÌïôÏäµ Í≥ÑÌöç ÏÑ§Ï†ï Ìï®Ïàò
function getStudyPlanConfig(averageGrade) {
    if (averageGrade <= 2) {
        return {
            studyDays: 3,           // Ï£º 3Ïùº
            dailySubjects: 2,       // ÌïòÎ£® 1-2Í≥ºÎ™©
            weekdayLimit: 60,       // ÌèâÏùº 60Î∂Ñ
            weekendLimit: 50,       // Ï£ºÎßê 50Î∂Ñ
            dailyWorkbook: ['Ïõî', 'Ïàò', 'Í∏à']  // Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ ÏöîÏùº
        };
    } else if (averageGrade <= 4) {
        return {
            studyDays: 5,           // Ï£º 5Ïùº
            dailySubjects: 3,       // ÌïòÎ£® 2-3Í≥ºÎ™©
            weekdayLimit: 100,      // ÌèâÏùº 100Î∂Ñ
            weekendLimit: 50,       // Ï£ºÎßê 50Î∂Ñ
            dailyWorkbook: ['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à']  // Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ ÏöîÏùº
        };
    } else {
        return {
            studyDays: 7,           // Ï£º 7Ïùº
            dailySubjects: 3,       // ÌïòÎ£® 3Í≥ºÎ™©
            weekdayLimit: 100,      // ÌèâÏùº 100Î∂Ñ
            weekendLimit: 50,       // Ï£ºÎßê 50Î∂Ñ
            dailyWorkbook: ['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†', 'Ïùº']  // Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ ÏöîÏùº
        };
    }
}

// üÜï Ï≤¥Í≥ÑÏ†ÅÏù∏ ÌïôÏäµ ÏûêÎ£å Ï∂îÏ≤ú
function getSystematicStudyMaterials(subjectName, currentScore, isMainStudy = true) {
    const materials = [];
    const currentWeek = getCurrentWeekNumber();
    
    console.log('üîç ÌïôÏäµÏûêÎ£å Í≤ÄÏÉâ:', subjectName, 'Ï†êÏàò:', currentScore);
    
    // Í≥ºÎ™©Î™Ö Îß§Ìïë (Ïã§Ï†ú Îç∞Ïù¥ÌÑ∞ÏôÄ ÌïôÏäµÏûêÎ£å DB Îß§Ïπ≠)
    const subjectMapping = {
        'ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏': 'ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏',
        'ÌôîÎ≤ïÍ≥ºÏûëÎ¨∏': 'ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏',
        'ÌôîÏûë': 'ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏',
        'Î¨∏Î≤ï': 'Î¨∏Î≤ï',
        'Ïñ∏Ïñ¥ÏôÄ Îß§Ï≤¥': 'Î¨∏Î≤ï',
        'Ïñ∏Ïñ¥ÏôÄÎß§Ï≤¥': 'Î¨∏Î≤ï',
        'Ïñ∏Îß§': 'Î¨∏Î≤ï',
        'ÎèÖÏÑú(Ïù∏Î¨∏)': 'ÎèÖÏÑú(Ïù∏Î¨∏)',
        'ÎèÖÏÑúÏù∏Î¨∏': 'ÎèÖÏÑú(Ïù∏Î¨∏)',
        'Ïù∏Î¨∏': 'ÎèÖÏÑú(Ïù∏Î¨∏)',
        'ÎèÖÏÑú(ÏÇ¨Ìöå)': 'ÎèÖÏÑú(ÏÇ¨Ìöå)',
        'ÎèÖÏÑúÏÇ¨Ìöå': 'ÎèÖÏÑú(ÏÇ¨Ìöå)',
        'ÏÇ¨Ìöå': 'ÎèÖÏÑú(ÏÇ¨Ìöå)',
        'ÎèÖÏÑú(Í≥ºÌïô)': 'ÎèÖÏÑú(Í≥ºÌïô)',
        'ÎèÖÏÑúÍ≥ºÌïô': 'ÎèÖÏÑú(Í≥ºÌïô)',
        'Í≥ºÌïô': 'ÎèÖÏÑú(Í≥ºÌïô)',
        'Î¨∏Ìïô(ÌòÑÎåÄÏãú)': 'Î¨∏Ìïô(ÌòÑÎåÄÏãú)',
        'Î¨∏ÌïôÌòÑÎåÄÏãú': 'Î¨∏Ìïô(ÌòÑÎåÄÏãú)',
        'ÌòÑÎåÄÏãú': 'Î¨∏Ìïô(ÌòÑÎåÄÏãú)',
        'ÌòÑÏãú': 'Î¨∏Ìïô(ÌòÑÎåÄÏãú)',
        'Î¨∏Ìïô(ÌòÑÎåÄÏÜåÏÑ§)': 'Î¨∏Ìïô(ÌòÑÎåÄÏÜåÏÑ§)',
        'Î¨∏ÌïôÌòÑÎåÄÏÜåÏÑ§': 'Î¨∏Ìïô(ÌòÑÎåÄÏÜåÏÑ§)',
        'ÌòÑÎåÄÏÜåÏÑ§': 'Î¨∏Ìïô(ÌòÑÎåÄÏÜåÏÑ§)',
        'ÌòÑÏÜå': 'Î¨∏Ìïô(ÌòÑÎåÄÏÜåÏÑ§)',
        'Î¨∏Ìïô(Í≥†Ï†ÑÏãúÍ∞Ä)': 'Î¨∏Ìïô(Í≥†Ï†ÑÏãúÍ∞Ä)',
        'Î¨∏ÌïôÍ≥†Ï†ÑÏãúÍ∞Ä': 'Î¨∏Ìïô(Í≥†Ï†ÑÏãúÍ∞Ä)',
        'Í≥†Ï†ÑÏãúÍ∞Ä': 'Î¨∏Ìïô(Í≥†Ï†ÑÏãúÍ∞Ä)',
        'Í≥†Ïãú': 'Î¨∏Ìïô(Í≥†Ï†ÑÏãúÍ∞Ä)',
        'Î¨∏Ìïô(Í≥†Ï†ÑÏÜåÏÑ§)': 'Î¨∏Ìïô(Í≥†Ï†ÑÏÜåÏÑ§)',
        'Î¨∏ÌïôÍ≥†Ï†ÑÏÜåÏÑ§': 'Î¨∏Ìïô(Í≥†Ï†ÑÏÜåÏÑ§)',
        'Í≥†Ï†ÑÏÜåÏÑ§': 'Î¨∏Ìïô(Í≥†Ï†ÑÏÜåÏÑ§)',
        'Í≥†ÏÜå': 'Î¨∏Ìïô(Í≥†Ï†ÑÏÜåÏÑ§)'
    };
    
    // Îß§ÌïëÎêú Í≥ºÎ™©Î™Ö Ï∞æÍ∏∞
    const mappedSubject = subjectMapping[subjectName] || subjectName;
    console.log('üìù Îß§ÌïëÎêú Í≥ºÎ™©Î™Ö:', subjectName, '‚Üí', mappedSubject);
    
 // Ï£º ÍµêÏû¨ (Í≥ºÎ™©Î≥Ñ Ïã¨Ìôî/Í∏∞Ï¥à) - Ï†êÏàò Íµ¨Í∞ÑÎ≥Ñ Ï∂îÏ≤ú
if (isMainStudy && studyMaterialsDB[mappedSubject]) {
    console.log('üìä Ï†êÏàò Íµ¨Í∞Ñ Î∂ÑÏÑù:', currentScore + 'Ï†ê');
    
    let levelsToInclude = [];
    
        if (currentScore < 60) {
            // 60% ÎØ∏Îßå: Í∏∞Î≥∏Îßå
            levelsToInclude = ["Í∏∞Î≥∏"];
            console.log('üìä ÏÑ†ÌÉùÎêú Î†àÎ≤®: Í∏∞Î≥∏Îßå (60% ÎØ∏Îßå)');
        } else if (currentScore <= 80) {
            // 60~80%: Í∏∞Î≥∏ + Ïã¨Ìôî
            levelsToInclude = ["Í∏∞Î≥∏", "Ïã¨Ìôî"];
            console.log('üìä ÏÑ†ÌÉùÎêú Î†àÎ≤®: Í∏∞Î≥∏ + Ïã¨Ìôî (60~80%)');
        } else {
            // 80% Ï¥àÍ≥º: Ïã¨ÌôîÎßå
            levelsToInclude = ["Ïã¨Ìôî"];
            console.log('üìä ÏÑ†ÌÉùÎêú Î†àÎ≤®: Ïã¨ÌôîÎßå (80% Ï¥àÍ≥º)');
        }
    
    // ÏÑ†ÌÉùÎêú Î†àÎ≤®Îì§Ïùò Î™®Îì† ÏûêÎ£å Ï∂îÍ∞Ä
    levelsToInclude.forEach(level => {
        if (studyMaterialsDB[mappedSubject][level] && studyMaterialsDB[mappedSubject][level].length > 0) {
            console.log('‚úÖ ' + level + ' ÏûêÎ£å Î∞úÍ≤¨ (Í∞úÏàò: ' + studyMaterialsDB[mappedSubject][level].length + ')');
            
            studyMaterialsDB[mappedSubject][level].forEach((material, index) => {
                console.log('  - Ï∂îÍ∞Ä:', material.name);
                materials.push({
                    ...material,
                    studyTime: 40,
                    type: "main"
                });
            });
        } else {
            console.log('‚ùå ' + level + ' ÏûêÎ£å ÏóÜÏùå:', mappedSubject, level);
        }
    });
    
    // ÎßåÏïΩ ÏÑ†ÌÉùÎêú Î†àÎ≤®Ïóê ÏûêÎ£åÍ∞Ä ÌïòÎÇòÎèÑ ÏóÜÎã§Î©¥ Îã§Î•∏ Î†àÎ≤® ÌôïÏù∏
    const hasAnyMaterial = materials.some(m => m.type === "main");
    if (!hasAnyMaterial) {
        console.log('üîÑ ÏÑ†ÌÉùÎêú Î†àÎ≤®Ïóê ÏûêÎ£å ÏóÜÏùå, Îã§Î•∏ Î†àÎ≤® ÌôïÏù∏');
        const allLevels = ["Í∏∞Ï¥à", "Ïã¨Ìôî"];
        
        for (const fallbackLevel of allLevels) {
            if (!levelsToInclude.includes(fallbackLevel) && 
                studyMaterialsDB[mappedSubject][fallbackLevel] && 
                studyMaterialsDB[mappedSubject][fallbackLevel].length > 0) {
                
                console.log('üîÑ ÎåÄÏ≤¥ Î†àÎ≤® ÏûêÎ£å ÏÇ¨Ïö©:', fallbackLevel);
                studyMaterialsDB[mappedSubject][fallbackLevel].forEach((material, index) => {
                    console.log('  - ÎåÄÏ≤¥ Ï∂îÍ∞Ä:', material.name);
                    materials.push({
                        ...material,
                        studyTime: 40,
                        type: "main"
                    });
                });
                break;
            }
        }
    }
} else {
    console.log('‚ùå Ìï¥Îãπ Í≥ºÎ™© Ï†ÑÏ≤¥ ÏûêÎ£å ÏóÜÏùå:', mappedSubject);
}
    
    // Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ (52Ï£º ÏàúÌôò, 1-10 Î∞òÎ≥µ)
    if (studyMaterialsDB["Îß§ÏùºÌïôÏäµ"]) {
        const allWeeklyMaterials = [
            ...studyMaterialsDB["Îß§ÏùºÌïôÏäµ"]["Í∏∞Î≥∏"],
            ...studyMaterialsDB["Îß§ÏùºÌïôÏäµ"]["Ïã¨Ìôî"]
        ];
        
        if (allWeeklyMaterials.length > 0) {
            // ÌòÑÏû¨ Ï£ºÏ∞®Ïóê Îî∞Îùº 1-10 ÏàúÌôò (52Ï£º Í∏∞Ï§Ä)
            const weeklyIndex = (currentWeek - 1) % 10; // 1-10 ÏàúÌôò
            console.log('üìÖ ÌòÑÏû¨ Ï£ºÏ∞®:', currentWeek + 'Ï£ºÏ∞®, ÏÑ†ÌÉùÎêú Ï£ºÍ∞ÑÏßÄ Î≤àÌò∏:', (weeklyIndex + 1));
            console.log('üìÖ ÏÑ†ÌÉùÎêú Ï£ºÍ∞ÑÏßÄ:', allWeeklyMaterials[weeklyIndex].name);
            
            materials.push({
                ...allWeeklyMaterials[weeklyIndex],
                studyTime: 20,
                type: "daily"
            });
        }
    }
    
    // Í≥ºÎ™©Î≥Ñ ÏûêÎ£åÍ∞Ä ÏóÜÏúºÎ©¥ Ï¢ÖÌï© ÏûêÎ£åÏùò Î™®Îì† ÏûêÎ£å Ï∂îÏ≤ú
    const hasMainMaterial = materials.some(m => m.type === "main");
    if (!hasMainMaterial && studyMaterialsDB["Ï¢ÖÌï©Î™®ÏùòÍ≥†ÏÇ¨"]) {
        console.log('üîÑ Ï¢ÖÌï© ÏûêÎ£åÎ°ú ÎåÄÏ≤¥');
        const level = currentScore < 60 ? "Í∏∞Ï¥à" : "Ïã¨Ìôî";
        const generalMaterials = studyMaterialsDB["Ï¢ÖÌï©Î™®ÏùòÍ≥†ÏÇ¨"][level];
        
        if (generalMaterials && generalMaterials.length > 0) {
            // Ï¢ÖÌï© ÏûêÎ£åÏùò Î™®Îì† ÏûêÎ£å Ï∂îÍ∞Ä
            generalMaterials.forEach((material, index) => {
                console.log('  - Ï¢ÖÌï©ÏûêÎ£å Ï∂îÍ∞Ä:', material.name);
                materials.push({
                    ...material,
                    studyTime: 30,
                    type: "general"
                });
            });
        }
    }
    
    console.log('üìö ÏµúÏ¢Ö Ï∂îÏ≤ú ÏûêÎ£å Ïàò:', materials.length);
    materials.forEach(m => console.log('  -', m.name, '(' + m.type + ')'));
    
    return materials;
}

// üÜï ÏûêÎèô ÏÉùÏÑ±Îêú ÌïôÏäµ Í≥ÑÌöçÏÑú ÌëúÏãú Ìï®Ïàò
function displayAutoGeneratedPlan(planData) {
    const planContainer = document.getElementById('autoGeneratedPlan');
    const { student, weakSubjects, weeklyPlan, config, averageGrade } = planData;
    
    if (weakSubjects.length === 0) {
        displayExcellentStudentPlan(student);
        return;
    }
    
    const currentWeek = getCurrentWeekNumber();
    
    planContainer.innerHTML = `
        <div class="advanced-study-plan">
            <div class="plan-document-header">
                <h3>üìã ${student.name}Îãò ÎßûÏ∂§ ÌïôÏäµ Í≥ÑÌöçÏÑú</h3>
                <div class="student-info-banner">
                    <strong>${student.name} ÌïôÏÉù</strong> - Í∞úÏù∏Î≥Ñ ÏïΩÏ†ê Î∂ÑÏÑù Í∏∞Î∞ò ÏµúÏ†ÅÌôî Í≥ÑÌöç
                </div>
            </div>
            
            <div class="improvement-analysis">
                <h4 style="margin-bottom: 15px; color: rgba(255,255,255,0.95);">
                    ‚ö†Ô∏è Ïö∞ÏÑ† Í∞úÏÑ† Í≥ºÎ™© (ÏÉÅÏúÑ 3Í∞ú)
                </h4>
                
                ${weakSubjects.map((subject, index) => {
                    console.log('ÎîîÎ≤ÑÍπÖ:', subject.name, subject.current);
                    const materials = getSystematicStudyMaterials(subject.name, subject.current, true);
                    const studyTask = getDetailedStudyTask(subject.name, subject.current);
                    return `
                        <div class="weak-subject-card priority-${subject.priority}">
                            <div class="subject-header">
                                <div class="subject-name">${subject.name}</div>
                              <div class="priority-badge priority-${subject.priority}">
                                ${subject.priority === 'high' ? 'üî¥ ÏµúÏö∞ÏÑ†' : subject.priority === 'medium' ? 'üü° Ï§ëÏöî' : 'üîµ Î≥¥ÌÜµ'}
                            </div>
                            </div>
                            
                            <div class="subject-details">
                            <div class="detail-metric">
                                <div class="detail-value">${subject.current}%</div>
                                <div class="detail-label">ÌòÑÏû¨ ÏÑ±Ï∑®ÎèÑ</div>
                            </div>
                        </div>
                        
                        <div style="background: rgba(255, 255, 255, 0.05); border-radius: 8px; padding: 15px; margin: 15px 0;">
                            <h5 style="margin-bottom: 10px; color: rgba(255,255,255,0.95);">üìã Ï∑®ÏïΩÏòÅÏó≠ Í∞úÎÖê ÌÅ¥Î¶¨Îãâ</h5>
                            <p style="color: rgba(255,255,255,0.85); line-height: 1.5; font-size: 0.9em;">${studyTask}</p>
                        </div>
                            <div class="study-materials">
                                <h5 style="margin-bottom: 10px;">üìö Ï∂îÏ≤ú ÌïôÏäµ ÏûêÎ£å Îã§Ïö¥Î°úÎìú ÎßÅÌÅ¨</h5>
                                <div class="material-links">
                                    ${materials.map(material => `
                                        <a href="${material.url}" target="_blank" class="material-link">
                                            ‚¨áÔ∏è ${material.name}
                                        </a>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
            
            ${createWeeklyScheduleHTML(weeklyPlan)}
            
            <div class="motivation-banner">
                <h4>${student.name}ÎãòÏùÑ ÏúÑÌïú Í≤©Î†§ Î©îÏãúÏßÄ</h4>
                <div class="motivation-text">
                    ÌòÑÏû¨ ${averageGrade.toFixed(1)}Îì±Í∏âÏóêÏÑú ${Math.max(1, Math.floor(averageGrade) - 1)}Îì±Í∏âÏúºÎ°ú Ìñ•ÏÉÅÌïòÍ∏∞ ÏúÑÌïú
                    Ï≤¥Í≥ÑÏ†ÅÏù∏ Í≥ÑÌöçÏùÑ ÏàòÎ¶ΩÌñàÏäµÎãàÎã§. Íæ∏Ï§ÄÌûà Ïã§Ï≤úÌïòÎ©¥ Î∞òÎìúÏãú Î™©ÌëúÎ•º Îã¨ÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§! 
                    Ï†ïÎèôÎØºÍµ≠Ïñ¥ÎÖºÏà†ÌïôÏõêÏù¥ Ïó¨Îü¨Î∂ÑÏùò ÏÑ±Í≥µÏùÑ ÏùëÏõêÌï©ÎãàÎã§! üí™
                </div>
            </div>
        </div>
    `;
}
        
// üÜï ÏûêÎèô ÏÉùÏÑ±Îêú ÌïôÏäµ Í≥ÑÌöçÏÑú ÏÉùÏÑ± (AI Î∂ÑÏÑù ÏßÅÌõÑ Ìò∏Ï∂ú)
function generateAutoStudyPlan(student) {
    console.log('ÏûêÎèô ÌïôÏäµ Í≥ÑÌöçÏÑú ÏÉùÏÑ± ÏãúÏûë:', student.name);
    
    // üîß Í≥ÑÌöçÏÑú ÏÑπÏÖò Î®ºÏ†Ä ÌëúÏãú
    document.getElementById('studyPlanSection').style.display = 'block';
    
    // AI Î∂ÑÏÑù Í≤∞Í≥º Í∞ÄÏ†∏Ïò§Í∏∞
    const analysisResult = performAIAnalysis(student);
    const aiWeaknesses = analysisResult.weaknesses || [];
    
    if (aiWeaknesses.length === 0) {
        displayExcellentStudentPlan(student);
        return;
    }
    
    // ÏµúÍ∑º 4Ìöå ÌèâÍ∑† Îì±Í∏â Í≥ÑÏÇ∞
    const grades = student.grades;
    const gradeKeys = Object.keys(grades);
    const recent4Grades = gradeKeys.slice(-4).map(key => parseInt(grades[key].grade));
    const averageGrade = recent4Grades.reduce((a, b) => a + b, 0) / recent4Grades.length;
    
    // ÏïΩÌïú Í≥ºÎ™© Î≥ÄÌôò (ÏÉÅÏúÑ 3Í∞úÎßå)
    const weakSubjects = aiWeaknesses.slice(0, 3).map(weakness => ({
        name: weakness.subject,
        current: weakness.average,
        improvement: 85 - weakness.average,
        priority: weakness.urgency,
        description: weakness.description
    }));

// üÜï ÌòÑÏã§Ï†ÅÏù∏ Ï£ºÍ∞Ñ Í≥ÑÌöç ÏÉùÏÑ±
function generateRealisticWeeklyPlan(weakSubjects, averageGrade) {
    const config = getStudyPlanConfig(averageGrade);
    const days = ['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†', 'Ïùº'];
    const plan = {};
    
    // Ï¥àÍ∏∞Ìôî
    days.forEach(day => {
        plan[day] = [];
    });
    
    // Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ Î®ºÏ†Ä Î∞∞Ïπò
    const currentWeek = getCurrentWeekNumber();
    const dailyWorkbook = studyMaterialsDB["Îß§ÏùºÌïôÏäµ"] ? 
        [...studyMaterialsDB["Îß§ÏùºÌïôÏäµ"]["Í∏∞Î≥∏"], ...studyMaterialsDB["Îß§ÏùºÌïôÏäµ"]["Ïã¨Ìôî"]] : [];
    
    if (dailyWorkbook.length > 0) {
        const weeklyIndex = (currentWeek - 1) % dailyWorkbook.length;
        const selectedWorkbook = dailyWorkbook[weeklyIndex];
        
        config.dailyWorkbook.forEach(day => {
            plan[day].push({
                subject: "Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ",
                material: selectedWorkbook.name,
                time: 20,
                priority: "daily",
                url: selectedWorkbook.url,
                description: selectedWorkbook.description
            });
        });
    }
    
    // ÏïΩÌïú Í≥ºÎ™© Î∞∞Ïπò
    let dayIndex = 0;
    const studyDays = days.slice(0, config.studyDays);
    
    weakSubjects.forEach((subject, subjectIndex) => {
        const materials = getSystematicStudyMaterials(subject.name, subject.current, true);
        
        materials.forEach(material => {
            if (material.type === "main") {
                // ÌïòÎ£® ÏãúÍ∞Ñ Ï†úÌïú ÌôïÏù∏
                const targetDay = studyDays[dayIndex % studyDays.length];
                const isWeekend = targetDay === 'ÌÜ†' || targetDay === 'Ïùº';
                const timeLimit = isWeekend ? config.weekendLimit : config.weekdayLimit;
                const currentTime = plan[targetDay].reduce((sum, item) => sum + item.time, 0);
                
                if (currentTime + material.studyTime <= timeLimit) {
                    plan[targetDay].push({
                        subject: subject.name,
                        material: material.name,
                        time: material.studyTime,
                        priority: subject.priority,
                        url: material.url,
                        description: material.description
                    });
                    
                    dayIndex++;
                }
            }
        });
    });
    
    return plan;
}
    
    // ÌòÑÏã§Ï†ÅÏù∏ Ï£ºÍ∞Ñ Í≥ÑÌöç ÏÉùÏÑ±
    const weeklyPlan = generateRealisticWeeklyPlan(weakSubjects, averageGrade);
    const config = getStudyPlanConfig(averageGrade);
    
    // Í≥ÑÌöçÏÑú ÌëúÏãú
    displayAutoGeneratedPlan({
        student: student,
        weakSubjects: weakSubjects,
        weeklyPlan: weeklyPlan,
        config: config,
        averageGrade: averageGrade
    });
    
    // Í≥ÑÌöçÏÑú ÏÑπÏÖò ÌëúÏãú
    document.getElementById('autoGeneratedPlan').style.display = 'block';
}

// üÜï Ïö∞Ïàò ÌïôÏÉùÏö© Í≥ÑÌöçÏÑú
function displayExcellentStudentPlan(student) {
    const planContainer = document.getElementById('autoGeneratedPlan');
    const currentWeek = getCurrentWeekNumber();
    
    planContainer.innerHTML = `
        <div class="advanced-study-plan">
            <div class="plan-document-header">
                <h3>üåü Ïö∞Ïàò ÌïôÏÉù ÎßûÏ∂§ Í≥ÑÌöçÏÑú</h3>
                <div class="student-info-banner">
                    <strong>${student.name} ÌïôÏÉù</strong> - Î™®Îì† ÏòÅÏó≠ÏóêÏÑú Îõ∞Ïñ¥ÎÇú ÏÑ±Ï∑®ÎèÑ!
                </div>
            </div>
            
            <div style="text-align: center; padding: 30px; background: rgba(40,167,69,0.1); border-radius: 12px;">
                <h4 style="color: #28a745; margin-bottom: 15px;">üéâ Ï∂ïÌïòÌï©ÎãàÎã§!</h4>
                <p style="line-height: 1.6; margin-bottom: 20px;">
                    ÌòÑÏû¨ Î™®Îì† Í≥ºÎ™©ÏóêÏÑú Ïö∞ÏàòÌïú ÏÑ±Ï∑®ÎèÑÎ•º Î≥¥Ïù¥Í≥† ÏûàÏäµÎãàÎã§.<br>
                    ÌòÑÏû¨ ÏàòÏ§ÄÏùÑ Ïú†ÏßÄÌïòÎ©∞ Ïã§Ï†Ñ Í∞êÍ∞ÅÏùÑ Í∏∞Î•¥Îäî Í≤ÉÏùÑ Ï∂îÏ≤úÌï©ÎãàÎã§.
                </p>
                
                <div class="study-materials">
                    <h5 style="margin-bottom: 15px;">üìö Ï∂îÏ≤ú ÌïôÏäµ ÏûêÎ£å</h5>
                    <div class="material-links">
                        ${studyMaterialsDB["Ï¢ÖÌï©Î™®ÏùòÍ≥†ÏÇ¨"]["Ïã¨Ìôî"].map(material => `
                            <a href="${material.url}" target="_blank" class="material-link">
                                ‚¨áÔ∏è ${material.name}
                            </a>
                        `).join('')}
                        <a href="${studyMaterialsDB["Îß§ÏùºÌïôÏäµ"]["Ïã¨Ìôî"][((currentWeek - 1) % studyMaterialsDB["Îß§ÏùºÌïôÏäµ"]["Ïã¨Ìôî"].length)].url}" 
                           target="_blank" class="material-link">
                            ‚¨áÔ∏è Ïù¥Î≤à Ï£º Îß§Ïùº Ìë∏Îäî Ï£ºÍ∞ÑÏßÄ ${currentWeek}
                        </a>
                    </div>
                </div>
            </div>
        </div>
    `;
}
        
        
        
// Íµ¨Í∏ÄÎìúÎùºÏù¥Î∏å ÎßÅÌÅ¨Î•º Îã§Ïö¥Î°úÎìú ÎßÅÌÅ¨Î°ú Î≥ÄÌôòÌïòÎäî Ìï®Ïàò
function convertGoogleDriveLink(shareLink) {
    // "https://drive.google.com/file/d/FILE_ID/view?usp=sharing" 
    // ‚Üí "https://drive.google.com/uc?export=download&id=FILE_ID"
    var fileId = shareLink.match(/\/d\/([a-zA-Z0-9-_]+)/);
    if (fileId) {
        return "https://drive.google.com/uc?export=download&id=" + fileId[1];
    }
    return shareLink; // Î≥ÄÌôò Ïã§Ìå® Ïãú ÏõêÎ≥∏ Î∞òÌôò
}
  

      // üÜï ÌòÑÏû¨ ÌïôÏÉù Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ Ìï®Ïàò
function getCurrentStudentData() {
    // ÌòÑÏû¨ Í≤ÄÏÉâÎêú ÌïôÏÉùÏùò Ï∂úÍ≤∞Î≤àÌò∏Î°ú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
    const searchInput = document.getElementById('searchInput').value.trim();
    if (!searchInput || !studentByNumber[searchInput]) {
        return null;
    }
    
    const student = studentByNumber[searchInput];
    const grades = student.grades;
    const gradeKeys = Object.keys(grades);
    
    if (gradeKeys.length === 0) return null;
    
    // ÏµúÏã† ÏÑ±Ï†Å Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú
    const latestTest = gradeKeys[gradeKeys.length - 1];
    const latestGrade = grades[latestTest];
    
    return {
        name: student.name,
        attendanceNumber: student.attendanceNumber,
        currentGrade: parseInt(latestGrade.grade),
        currentScore: parseInt(latestGrade.score),
        subjects: latestGrade.ratios || {},
        allGrades: grades,
        latestTest: latestTest
    };
}



// üÜï Í≥ºÎ™©Î≥Ñ ÌïôÏäµ ÏûêÎ£å Ï∂îÏ≤ú Ìï®Ïàò
function getStudyMaterials(subjectName, currentScore) {
    const materials = [];
    
    // Í∏∞Î≥∏ ÏûêÎ£å (50% ÎØ∏ÎßåÏù¥Î©¥ Í∏∞Î≥∏Î∂ÄÌÑ∞)
    if (currentScore < 60 && studyMaterialsDB[subjectName] && studyMaterialsDB[subjectName]["Í∏∞Î≥∏"]) {
        materials.push(...studyMaterialsDB[subjectName]["Í∏∞Î≥∏"]);
    }
    
    // Ïã¨Ìôî ÏûêÎ£å (60% Ïù¥ÏÉÅÏù¥Í±∞ÎÇò Í∏∞Î≥∏Ïù¥ ÏóÜÏúºÎ©¥)
    if ((currentScore >= 50 || !studyMaterialsDB[subjectName]["Í∏∞Î≥∏"]) && 
        studyMaterialsDB[subjectName] && studyMaterialsDB[subjectName]["Ïã¨Ìôî"]) {
        materials.push(...studyMaterialsDB[subjectName]["Ïã¨Ìôî"]);
    }
    
    // Îß§Ïùº ÌïôÏäµ ÏûêÎ£å Ï∂îÍ∞Ä
    if (studyMaterialsDB["Îß§ÏùºÌïôÏäµ"]) {
        const dailyMaterials = currentScore < 50 ? 
            studyMaterialsDB["Îß§ÏùºÌïôÏäµ"]["Í∏∞Î≥∏"].slice(0, 2) : 
            studyMaterialsDB["Îß§ÏùºÌïôÏäµ"]["Ïã¨Ìôî"].slice(0, 2);
        materials.push(...dailyMaterials);
    }
    
    return materials;
}


        // üÜï ÏÉÅÏÑ∏ ÌïôÏäµ Í≥ºÏ†ú ÏÉùÏÑ± Ìï®Ïàò
function getDetailedStudyTask(subject, currentScore) {
    const tasks = {
        'ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏': {
            basic: 'ÌôîÎ≤ïÏùò Í∏∞Î≥∏ ÏõêÎ¶¨ ÌïôÏäµ(ÏÉÅÌô©, Î™©Ï†Å, Ï≤≠Ïûê ÌååÏïÖ) ‚Üí ÏûëÎ¨∏ Í≥ºÏ†ï(Í≥ÑÌöç‚ÜíÏûëÏÑ±‚ÜíÏàòÏ†ï) Ïù¥Ìï¥ ‚Üí Í∏∞Î≥∏ Î¨∏Ï†ú Ìå®ÌÑ¥ ÏùµÌûàÍ∏∞ ‚Üí ÌôîÏûë Ï†ÑÏ≤¥ 8-10Î∂Ñ ÏãúÍ∞Ñ Î∞∞Î∂Ñ Ïó∞Ïäµ',
            advanced: 'Î≥µÌï© ÌôîÎ≤ï ÏÉÅÌô©Ïùò Îã§Í∞ÅÏ†Å ÏöîÏÜå Î∂ÑÏÑù ‚Üí ÌôîÏûê ÏùòÎèÑÏôÄ Ï≤≠Ïûê Î∞òÏùëÏùò Ïã¨Ï∏µ Î∂ÑÏÑù ‚Üí ÏûëÎ¨∏ Ïú†ÌòïÎ≥Ñ ÏÑ∏Î∂Ä Ï†ÑÎûµ ÏàòÎ¶Ω ‚Üí Í≥†Ï≥êÏì∞Í∏∞ Ìï®Ï†ï Ìå®ÌÑ¥ Î∂ÑÏÑù ‚Üí Ïã§Ï†Ñ ÏãúÍ∞Ñ Îã®Ï∂ï Í∏∞Î≤ï Ïó∞Ïäµ'
        },
        'Î¨∏Î≤ï': {
            basic: '9ÌíàÏÇ¨ Ï≤¥Í≥ÑÏ†Å Ï†ïÎ¶¨ ‚Üí Ïö©Ïñ∏Ïùò ÌôúÏö©(Ïñ¥Í∞Ñ+Ïñ¥ÎØ∏) ÏõêÎ¶¨ Ïù¥Ìï¥ ‚Üí Î∂àÍ∑úÏπô ÌôúÏö© Ìå®ÌÑ¥ ÏïîÍ∏∞ ‚Üí Î¨∏Ïû• ÏÑ±Î∂ÑÍ≥º Íµ¨Ï°∞ Î∂ÑÏÑù ‚Üí Í∏∞Î≥∏ Î¨∏Î≤ï Î¨∏Ï†ú Î∞òÎ≥µ Ïó∞Ïäµ',
            advanced: 'ÎÜíÏûÑÎ≤ï Ï≤¥Í≥Ñ(Ï£ºÏ≤¥¬∑ÏÉÅÎåÄ¬∑Í∞ùÏ≤¥) ÏôÑÏ†Ñ Ï†ïÎ≥µ ‚Üí ÏãúÏ†úÏôÄ ÏÉÅ Í∞úÎÖê Ï†ïÎ¶¨ ‚Üí ÌîºÎèô¬∑ÏÇ¨Îèô ÌëúÌòÑ Íµ¨Î∂Ñ ‚Üí ÏùåÏÑ± Î≥ÄÌôî(ÏùåÏö¥ Î≥ÄÎèô) Í∑úÏπô ‚Üí Ìï®Ï†ï Î¨∏Ï†ú Ïú†Ìòï Î∂ÑÏÑù Î∞è ÎåÄÎπÑ'
        },
        'ÎèÖÏÑú(Ïù∏Î¨∏)': {
            basic: 'Ï≤†Ìïô Í∏∞Î≥∏ Ïö©Ïñ¥(Ï°¥Ïû¨Î°†, Ïù∏ÏãùÎ°†, Ïú§Î¶¨Ìïô) Ï†ïÎ¶¨ ‚Üí ÎØ∏Ìïô¬∑ÏòàÏà†Î°† Í∏∞Ï¥à Í∞úÎÖê ÌïôÏäµ ‚Üí ÏßÄÎ¨∏ Íµ¨Ï°∞ ÌååÏïÖ(Î¨∏Ï†úÏ†úÍ∏∞‚ÜíÎÖºÏ¶ù‚ÜíÍ≤∞Î°†) ‚Üí ÌïµÏã¨ ÎÇ¥Ïö©Í≥º ÏÑ∏Î∂Ä ÎÇ¥Ïö© Íµ¨Î∂Ñ Ïó∞Ïäµ',
            advanced: 'Î≥µÏû°Ìïú ÎÖºÎ¶¨ Íµ¨Ï°∞ÏôÄ Ï∂îÎ°† Í≥ºÏ†ï Î∂ÑÏÑù ‚Üí Ìï®Ï∂ïÏ†Å ÏùòÎØ∏ÏôÄ ÌñâÍ∞Ñ ÏùΩÍ∏∞ ‚Üí ÎèôÏÑúÏñë Ï≤†Ìïô ÏÇ¨ÏÉÅ ÎπÑÍµê Î∂ÑÏÑù ‚Üí Îπ†Î•∏ ÎèÖÌï¥ ÌõàÎ†®(Î∂ÑÎãπ 800Ïûê Ïù¥ÏÉÅ) ‚Üí ÏãúÍ∞Ñ Îã®Ï∂ï Ïä§ÌÇ§Î∞ç Í∏∞Î≤ï'
        },
        'ÎèÖÏÑú(ÏÇ¨Ìöå)': {
            basic: 'Í≤ΩÏ†úÌïô Í∏∞Î≥∏ Í∞úÎÖê(ÏàòÏöîÍ≥µÍ∏â, ÏãúÏû•Í≤ΩÏ†ú) Ï†ïÎ¶¨ ‚Üí Ï†ïÏπòÌïô¬∑ÏÇ¨ÌöåÌïô¬∑Î≤ïÌïô Í∏∞Ï¥à Ïö©Ïñ¥ ÌïôÏäµ ‚Üí ÏõêÏù∏-Í≤∞Í≥º Í¥ÄÍ≥Ñ Î∂ÑÏÑù ‚Üí Î¨∏Ï†úÏ†ê-Ìï¥Í≤∞Î∞©Ïïà Íµ¨Ï°∞ Ïù¥Ìï¥ ‚Üí ÌÜµÍ≥Ñ ÏûêÎ£å Ìï¥ÏÑù Î∞©Î≤ï',
            advanced: 'Îã§Ï∏µÏ†Å ÏÇ¨Ìöå ÌòÑÏÉÅÏùò ÏÉÅÌò∏ÏûëÏö© Î∂ÑÏÑù ‚Üí Ï†ïÏ±ÖÏùò Ìö®Í≥ºÏôÄ Î∂ÄÏûëÏö© Î∂ÑÏÑù ‚Üí Ï†úÎèÑÏ†Å Î≥ÄÌôîÏùò Î∞∞Í≤ΩÍ≥º Í≤∞Í≥º ÌååÏïÖ ‚Üí Î≥µÌï© ÏÇ¨Ìöå Î¨∏Ï†úÏùò Ï¢ÖÌï©Ï†Å Ïù¥Ìï¥ ‚Üí Í≥†ÎÇúÎèÑ ÏßÄÎ¨∏ Ï†ïÎ≥µ'
        },
        'ÎèÖÏÑú(Í≥ºÌïô)': {
            basic: 'Î¨ºÎ¶¨¬∑ÌôîÌïô¬∑ÏÉùÎ¨º¬∑ÏßÄÍµ¨Í≥ºÌïô Í∏∞Î≥∏ Ïö©Ïñ¥ Ï†ïÎ¶¨ ‚Üí Ïã§Ìóò ÏÑ§Í≥ÑÏôÄ Í≥ºÏ†ï Ïù¥Ìï¥ ‚Üí Í∞ÄÏÑ§ ÏÑ§Ï†ïÍ≥º Í≤ÄÏ¶ù Î∞©Î≤ï ‚Üí Í¥ÄÏ∞∞ Í≤∞Í≥º Î∂ÑÏÑùÍ≥º Ìï¥ÏÑù ‚Üí Í≥ºÏ†ï ÏàúÏÑúÎèÑ Í∑∏Î¶¨Í∏∞ Ïó∞Ïäµ',
            advanced: 'Î≥µÏû°Ìïú Í≥ºÌïô ÏõêÎ¶¨ÏôÄ Î≤ïÏπô Ïù¥Ìï¥ ‚Üí ÏµúÏã† Í≥ºÌïô Í∏∞Ïà† ÎèôÌñ• ÌååÏïÖ ‚Üí Í≥ºÌïôÏÇ¨Ï†Å Î∞úÍ≤¨Í≥º Ìå®Îü¨Îã§ÏûÑ Î≥ÄÌôî ‚Üí Í≥†ÎÇúÎèÑ Ïã§Ìóò¬∑Í∏∞Ïà† ÏßÄÎ¨∏ Î∂ÑÏÑù ‚Üí Ïù∏Í≥ºÍ¥ÄÍ≥Ñ ÏôÑÎ≤Ω ÌååÏïÖ'
        },
        'Î¨∏Ìïô(ÌòÑÎåÄÏãú)': {
            basic: 'ÌôîÏûêÏôÄ ÏÉÅÌô© ÏÑ§Ï†ï Î∂ÑÏÑù ‚Üí Ï£ºÏöî ÏãúÏñ¥Ïùò Ìï®Ï∂ïÏ†Å ÏùòÎØ∏ ÌååÏïÖ ‚Üí ÌôîÏûêÏùò Ï†ïÏÑúÏôÄ Ïñ¥Ï°∞ Î∂ÑÏÑù ‚Üí ÎπÑÏú†Î≤ï(ÏùÄÏú†, ÌôòÏú†, ÏùòÏù∏Î≤ï) Ïù¥Ìï¥ ‚Üí ÎåÄÏ°∞Î≤ï¬∑Ï†êÏ∏µÎ≤ï¬∑ÏòÅÌÉÑÎ≤ï ÌïôÏäµ',
            advanced: 'Îã§Ï∏µÏ†Å ÌôîÏûê ÏùòÏãùÍ≥º Í¥ÄÏ†ê Î≥ÄÌôî Ï∂îÏ†Å ‚Üí ÏãúÍ∞Ñ¬∑Í≥µÍ∞Ñ ÏùòÏãù Ïã¨Ï∏µ Î∂ÑÏÑù ‚Üí ÏÉÅÏßïÍ≥º ÏùÄÏú†Ïùò Ïã¨Ï∏µ ÏùòÎØ∏ ÌååÏïÖ ‚Üí Î¨∏ÌïôÏÇ¨Ï†Å ÌùêÎ¶ÑÍ≥º ÏÇ¨Ï°∞ Ïù¥Ìï¥ ‚Üí ÏûëÍ∞Ä ÌäπÏú†Ïùò Î¨∏Ï≤¥ÏôÄ Í∞úÏÑ± Î∂ÑÏÑù'
        },
        'Î¨∏Ìïô(ÌòÑÎåÄÏÜåÏÑ§)': {
            basic: 'Ïù∏Î¨º Í¥ÄÍ≥ÑÎèÑ ÏûëÏÑ± Î∞è ÏÑ±Í≤© Î∂ÑÏÑù ‚Üí ÏÇ¨Í±¥Ïùò Î∞úÎã®-Ï†ÑÍ∞ú-ÏúÑÍ∏∞-Ï†àÏ†ï-Í≤∞Îßê Ï†ïÎ¶¨ ‚Üí Í∞àÎì± Íµ¨Ï°∞(Ïù∏Î¨ºÍ∞Ñ¬∑ÎÇ¥Ï†Å¬∑ÏÇ¨ÌöåÏ†Å) ÌååÏïÖ ‚Üí ÏãúÍ≥µÍ∞ÑÏ†Å Î∞∞Í≤ΩÏùò ÏùòÎØ∏ ‚Üí Ï£ºÏ†ú ÏùòÏãù ÌååÏïÖ',
            advanced: 'ÏãúÏ†êÍ≥º ÏÑúÏà†ÏûêÏùò Ïó≠Ìï† Î∂ÑÏÑù ‚Üí ÏÑúÏà† ÏàúÏÑú(ÏàúÌñâ¬∑Ïó≠Ìñâ¬∑ÍµêÏ∞®) ÌååÏïÖ ‚Üí ÏùòÏãùÏùò ÌùêÎ¶Ñ¬∑ÎÇ¥Ï†Å ÎèÖÎ∞± Î∂ÑÏÑù ‚Üí Î¨∏ÌïôÏÇ¨Ï†Å ÏùòÏùòÏôÄ ÏÇ¨Ï°∞ Ïù¥Ìï¥ ‚Üí ÏûëÍ∞ÄÏùòÏãùÍ≥º ÏûëÌíà ÏÑ∏Í≥Ñ ÌÉêÍµ¨'
        },
        'Î¨∏Ìïô(Í≥†Ï†ÑÏãúÍ∞Ä)': {
            basic: 'Í∞àÎûòÏôÄ ÌòïÏãù(Ìñ•Í∞Ä¬∑Í≥†Î†§Í∞ÄÏöî¬∑ÏãúÏ°∞¬∑Í∞ÄÏÇ¨) Íµ¨Î∂Ñ ‚Üí Ïö¥Ïú®Í≥º Ïú®Í≤©(3¬∑4Ï°∞, 4¬∑4Ï°∞) ÌååÏïÖ ‚Üí Í≥†Ïñ¥Ïùò ÌòÑÎåÄÏñ¥ ÌíÄÏù¥ ÏïîÍ∏∞ ‚Üí ÌôîÏûêÏùò Ï†ïÏÑúÏôÄ ÏÉÅÌô© ‚Üí Ï£ºÏöî ÏÜåÏû¨Ïùò Í¥ÄÏäµÏ†Å ÏùòÎØ∏',
            advanced: 'ÏãúÏÉÅ Ï†ÑÍ∞ú Í≥ºÏ†ï(ÏÑ†Í≤ΩÌõÑÏ†ï¬∑Í∏∞ÏäπÏ†ÑÍ≤∞) Î∂ÑÏÑù ‚Üí ÏãúÎåÄÎ≥Ñ Î¨∏Ìïô ÌäπÏÑ± Ïù¥Ìï¥ ‚Üí ÏûëÍ∞ÄÏôÄ ÏûëÌíàÏùò Î¨∏ÌïôÏÇ¨Ï†Å ÏùòÏùò ‚Üí Í∞àÎûòÎ≥Ñ ÌäπÏßïÍ≥º Î≥ÄÏ≤úÏÇ¨ ‚Üí ÎãπÎåÄ ÏÇ¨ÌöåÏÉÅÍ≥º Ïó∞Í¥Ä ÏßÄÏñ¥ Í∞êÏÉÅ'
        },
        'Î¨∏Ìïô(Í≥†Ï†ÑÏÜåÏÑ§)': {
            basic: 'Îì±Ïû•Ïù∏Î¨ºÏùò ÏÑ±Í≤©Í≥º Ïó≠Ìï† ÌååÏïÖ ‚Üí ÏÇ¨Í±¥ Ï†ÑÍ∞úÏôÄ Íµ¨ÏÑ± Ï†ïÎ¶¨ ‚Üí Í∞àÎì± Íµ¨Ï°∞ÏôÄ Ìï¥Í≤∞ Í≥ºÏ†ï ‚Üí Í∂åÏÑ†ÏßïÏïÖ Íµ¨Ï°∞ Ïù¥Ìï¥ ‚Üí Ïã†Î∂ÑÏ†ú ÎπÑÌåê ÏùòÏãùÍ≥º ÌòÑÏã§ ÎπÑÌåê ÌååÏïÖ',
            advanced: 'Ï†ÑÏßÄÏ†Å ÏÑúÏà†Í≥º Í∞úÏûÖÏ†Å ÏÑúÏà† Î∂ÑÏÑù ‚Üí ÌåêÏÜåÎ¶¨Í≥Ñ ÏÜåÏÑ§Ïùò ÌäπÏßï ‚Üí Í∞ÄÎ¨∏ÏÜåÏÑ§Í≥º ÏòÅÏõÖÏÜåÏÑ§ Íµ¨Ï°∞ ÎπÑÍµê ‚Üí Î¨∏ÌïôÏÇ¨Ï†Å Í∞ÄÏπòÏôÄ ÏùòÏùò ‚Üí ÌòÑÎåÄ Î¨∏ÌïôÍ≥ºÏùò Ïó∞Í¥ÄÏÑ± Î∞è ÎØºÏ°± Î¨∏ÌïôÏúºÎ°úÏÑúÏùò Í∞ÄÏπò'
        }
    };
    
    const subjectTasks = tasks[subject];
    if (!subjectTasks) return 'Í∏∞Î≥∏ Í∞úÎÖê ÌïôÏäµ Î∞è Î¨∏Ï†ú ÌíÄÏù¥ Ïó∞ÏäµÏùÑ ÌÜµÌïú Ïã§Î†• Ìñ•ÏÉÅ';
    
    return currentScore < 60 ? subjectTasks.basic : subjectTasks.advanced;
}
    

// üÜï ÎèôÍ∏∞Î∂ÄÏó¨ Î©îÏãúÏßÄ ÏÉùÏÑ± Ìï®Ïàò
function generateMotivationMessage(student, targets) {
    const gradeImprovement = student.currentGrade - targets.targetGrade;
    const messages = [];
    
    messages.push(`${student.name} ÌïôÏÉù! ÌòÑÏû¨ ${student.currentGrade}Îì±Í∏âÏóêÏÑú ${targets.targetGrade}Îì±Í∏âÏúºÎ°úÏùò ÎèÑÏïΩÏùÑ ÏúÑÌïú Ï≤¥Í≥ÑÏ†ÅÏù∏ Í≥ÑÌöçÏùÑ ÏàòÎ¶ΩÌñàÏäµÎãàÎã§.`);
    
    if (gradeImprovement >= 2) {
        messages.push(`${gradeImprovement}Îì±Í∏â ÏÉÅÏäπÏùÄ Ï∂©Î∂ÑÌûà Îã¨ÏÑ± Í∞ÄÎä•Ìïú Î™©ÌëúÏûÖÎãàÎã§. Íæ∏Ï§ÄÌïú ÎÖ∏Î†•ÏúºÎ°ú Î∞òÎìúÏãú ÏÑ±Ï∑®Ìï† Ïàò ÏûàÏäµÎãàÎã§!`);
    } else {
        messages.push(`ÌòÑÏû¨ Ïã§Î†•ÏùÑ Î∞îÌÉïÏúºÎ°ú Ìïú Îã®Í≥Ñ Îçî Î∞úÏ†ÑÌï† Ïàò ÏûàÎäî ÏôÑÎ≤ΩÌïú ÏãúÏ†êÏûÖÎãàÎã§!`);
    }
    
    messages.push(`${targets.targetUniversity} ${targets.targetMajor} ÏßÑÌïôÏù¥ÎùºÎäî ÍøàÏóê Ìïú Î∞ú Îçî Í∞ÄÍπåÏõåÏßÄÎèÑÎ°ù Ï†ïÎèôÎØºÍµ≠Ïñ¥ÎÖºÏà†ÌïôÏõêÏù¥ Ìï®ÍªòÌïòÍ≤†ÏäµÎãàÎã§.`);
    
    messages.push(`Îß§Ïùº Ï°∞Í∏àÏî©Ïù¥ÎùºÎèÑ Íæ∏Ï§ÄÌûà Ïã§Ï≤úÌïòÎ©¥, ${targets.targetPeriod}Í∞úÏõî ÌõÑ ÎÜÄÎùºÏö¥ Î≥ÄÌôîÎ•º Í≤ΩÌóòÌïòÍ≤å Îê† Í≤ÉÏûÖÎãàÎã§! ÌôîÏù¥ÌåÖ! üí™`);
    
    return messages.join(' ');
}

// üÜï Îì±Í∏âÎ≥Ñ Î™©Ìëú Ï†êÏàò Î∞òÌôò Ìï®Ïàò
function getTargetScoreFromGrade(grade) {
    const scoreMap = {
        '1': 92,
        '2': 82,
        '3': 72,
        '4': 62,
        '5': 52
    };
    return scoreMap[grade] || 80;
}  


// üÜï Ï£ºÍ∞Ñ Ïä§ÏºÄÏ§Ñ HTML ÏÉùÏÑ± Ìï®Ïàò
function createWeeklyScheduleHTML(weeklyPlan) {
    const days = ['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†', 'Ïùº'];
    
    let html = `
        <div class="weekly-schedule-advanced">
            <h4 style="margin-bottom: 15px; color: rgba(255,255,255,0.95);">
                üìÖ Ï£ºÍ∞Ñ ÎßûÏ∂§ ÌïôÏäµ Ïä§ÏºÄÏ§Ñ
            </h4>
            <div style="margin-bottom: 20px; opacity: 0.9; line-height: 1.5;">
    Í≥ºÎ™©Î≥Ñ Ïö∞ÏÑ†ÏàúÏúÑÏôÄ Í∞úÏù∏ ÏïΩÏ†êÏùÑ Í≥†Î†§ÌïòÏó¨ ÏµúÏ†ÅÌôîÎêú Ï£ºÍ∞Ñ Í≥ÑÌöçÏûÖÎãàÎã§.
    Îß§Ïùº Ï†ïÌï¥ÏßÑ ÏãúÍ∞ÑÏóê Íæ∏Ï§ÄÌûà Ïã§Ï≤úÌïòÎäî Í≤ÉÏù¥ ÌïµÏã¨ÏûÖÎãàÎã§! ÌïôÏäµ ÏûêÎ£åÎäî ÏúÑ Ï∂îÏ≤úÌïôÏäµÏûêÎ£å Îã§Ïö¥Î°úÎìú ÎßÅÌÅ¨Î•º Ïù¥Ïö©ÌïòÏÑ∏Ïöî.
</div>
            
            <div class="schedule-week-grid">
    `;
    
    days.forEach(day => {
        html += `
            <div class="schedule-day">
                <div class="day-name">${day}ÏöîÏùº</div>
        `;
        
        if (weeklyPlan[day] && weeklyPlan[day].length > 0) {
            let totalTime = 0;
            weeklyPlan[day].forEach(session => {
                const priorityColor = {
                    'high': 'rgba(220, 53, 69, 0.3)',
                    'medium': 'rgba(255, 193, 7, 0.3)',
                    'low': 'rgba(23, 162, 184, 0.3)'
                };
                
                html += `
                    <div class="study-session" style="background: ${priorityColor[session.priority] || priorityColor.medium};">
                        <div class="session-subject">${session.subject}</div>
                        <div class="session-time">${session.time}Î∂Ñ</div>
                    </div>
                `;
                totalTime += session.time;
            });
            
            html += `<div style="margin-top: 8px; font-size: 0.75em; opacity: 0.8; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 5px;">Ï¥ù ${totalTime}Î∂Ñ</div>`;
        } else {
            html += `<div class="study-session">ÏûêÏú† ÌïôÏäµ</div>`;
        }
        
        html += `</div>`;
    });
    
   html += `
        </div>
        <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px; text-align: center;">
            <strong>üí° ÌïôÏäµ Ìö®Í≥º Í∑πÎåÄÌôî ÌåÅ</strong><br>
            üî¥ ÏµúÏö∞ÏÑ† Í≥ºÎ™©ÏùÄ ÏßëÏ§ëÎ†•Ïù¥ Ï¢ãÏùÄ Ï†ÄÎÖÅ ÏãúÍ∞ÑÏóê | üü° Ï§ëÏöî Í≥ºÎ™©ÏùÄ Ïª®ÎîîÏÖòÏù¥ Ï¢ãÏùÄ Ï£ºÎßêÏóê | ÌïôÏäµ ÏûêÎ£åÎäî ÏúÑ Ï∂îÏ≤úÌïôÏäµÏûêÎ£å Îã§Ïö¥Î°úÎìú ÎßÅÌÅ¨Î•º Ïù¥Ïö©ÌïòÏÑ∏Ïöî.
        </div>
    </div>
`;
    
    return html;
}

// üÜù Î≥¥Ï°∞ Ìï®ÏàòÎì§
function getGradePercentile(grade) {
    const percentiles = {
        1: '4%',
        2: '11%',
        3: '23%',
        4: '40%',
        5: '60%',
        6: '77%',
        7: '89%',
        8: '96%',
        9: '100%'
    };
    return percentiles[grade] || 'Ïïå Ïàò ÏóÜÏùå';
}

function getStudyFrequency(priority) {
    const frequencies = {
        'high': 'Ï£º 5Ìöå',
        'medium': 'Ï£º 4Ìöå',
        'low': 'Ï£º 3Ìöå'
    };
    return frequencies[priority] || 'Ï£º 3Ìöå';
}

function getStudyTime(priority) {
    const times = {
        'high': 40,
        'medium': 30,
        'low': 25
    };
    return times[priority] || 30;
}


       
        // Î∂ÑÏÑù Ìï®Ïàò
        function generateAIAnalysis(student) {
            console.log('Î∂ÑÏÑù ÏãúÏûë:', student.name);
            
            // Î∂ÑÏÑù ÏÑπÏÖò ÌëúÏãú
            var aiAnalysisDiv = document.getElementById('aiAnalysis');
            var aiContentDiv = document.getElementById('aiContent');
            
            aiAnalysisDiv.style.display = 'block';
            
            // Î°úÎî© ÏÉÅÌÉú ÌëúÏãú
            aiContentDiv.innerHTML = `
                <div class="ai-loading">
                    <span>üß† ÏÑ±Ï†ÅÏùÑ Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§</span>
                    <div class="loading-dots">
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                    </div>
                </div>
            `;
            
           // Ïã§Ï†ú Î∂ÑÏÑù Ïã§Ìñâ (ÏãúÎÆ¨Î†àÏù¥ÏÖò)
setTimeout(function() {
    var analysis = performAIAnalysis(student);
    displayAIAnalysis(analysis);
    
    // AI Î∂ÑÏÑù ÏôÑÎ£å ÌõÑ ÌïôÏäµ Í≥ÑÌöçÏÑú ÏûêÎèô ÏÉùÏÑ±
    setTimeout(function() {
        generateAutoStudyPlan(student);
    }, 1000);
}, 2000); // 2Ï¥à ÌõÑ Î∂ÑÏÑù Í≤∞Í≥º ÌëúÏãú
        }
        
        function performAIAnalysis(student) {
            var grades = student.grades;
            var gradeKeys = Object.keys(grades);
            
            if (gradeKeys.length === 0) {
                return {
                    summary: "Î∂ÑÏÑùÌï† ÏÑ±Ï†Å Îç∞Ïù¥ÌÑ∞Í∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§.",
                    strengths: [],
                    weaknesses: [],
                    trends: [],
                    recommendations: [],
                    gradeStrategy: null
                };
            }
            
            // Îì±Í∏â Î∞è Ï†êÏàò Î∂ÑÏÑù
            var gradeValues = [];
            var scoreValues = [];
            var subjectScores = {};
            var subjectRatios = {};
            var testDetails = {}; // ÏãúÌóòÎ≥Ñ ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Ï†ÄÏû•
            
            gradeKeys.forEach(function(testName) {
                var gradeData = grades[testName];
                if (gradeData.grade) gradeValues.push(parseInt(gradeData.grade));
                if (gradeData.score) scoreValues.push(parseInt(gradeData.score));
                
                // ÏãúÌóòÎ≥Ñ ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Ï†ÄÏû• (ÏµúÍ≥† ÏÑ±Ï†Å Ï∞æÍ∏∞Ïö©)
                testDetails[testName] = {
                    grade: parseInt(gradeData.grade),
                    score: parseInt(gradeData.score),
                    source: gradeData.source || ''
                };
                
                // Í≥ºÎ™©Î≥Ñ Ï†êÏàò Î∞è ÎπÑÏú® ÏàòÏßë
                if (gradeData.details) {
                    Object.keys(gradeData.details).forEach(function(subject) {
                        if (!subjectScores[subject]) subjectScores[subject] = [];
                        if (!subjectRatios[subject]) subjectRatios[subject] = [];
                        
                        subjectScores[subject].push(gradeData.details[subject]);
                        if (gradeData.ratios && gradeData.ratios[subject]) {
                            subjectRatios[subject].push(gradeData.ratios[subject]);
                        }
                    });
                }
            });
            
            // ÌÜµÍ≥Ñ Í≥ÑÏÇ∞
            var avgGrade = gradeValues.length > 0 ? Math.round(gradeValues.reduce((a, b) => a + b) / gradeValues.length * 10) / 10 : 0;
            var avgScore = scoreValues.length > 0 ? Math.round(scoreValues.reduce((a, b) => a + b) / scoreValues.length) : 0;
            var bestGrade = gradeValues.length > 0 ? Math.min(...gradeValues) : 0;
            var bestScore = scoreValues.length > 0 ? Math.max(...scoreValues) : 0;
            var latestGrade = gradeValues.length > 0 ? gradeValues[gradeValues.length - 1] : 0;
            
            // ÏµúÍ≥† ÏÑ±Ï†Å ÏãúÌóò Ï∞æÍ∏∞
            var bestTest = '';
            var bestTestSource = '';
            Object.keys(testDetails).forEach(function(testName) {
                var testInfo = testDetails[testName];
                if (testInfo.score === bestScore) {
                    bestTest = testName;
                    bestTestSource = testInfo.source;
                }
            });
            
            // Í≥ºÎ™©Î≥Ñ ÌèâÍ∑† Í≥ÑÏÇ∞
            var subjectAverages = {};
            Object.keys(subjectRatios).forEach(function(subject) {
                var ratios = subjectRatios[subject];
                if (ratios.length > 0) {
                    subjectAverages[subject] = Math.round(ratios.reduce((a, b) => a + b) / ratios.length * 10) / 10;
                }
            });
            
            // Í∞ïÏ†ê Í≥ºÎ™© Ï∞æÍ∏∞ (ÌèâÍ∑† 70% Ïù¥ÏÉÅ)
            var strengths = [];
            Object.keys(subjectAverages).forEach(function(subject) {
                if (subjectAverages[subject] >= 70) {
                    strengths.push({
                        subject: subject,
                        average: subjectAverages[subject]
                    });
                }
            });
            strengths.sort((a, b) => b.average - a.average);
            
            // Í∞úÏÑ† ÌïÑÏöî Í≥ºÎ™© Î∂ÑÏÑù (Í∏∞Ï°¥ + Îã§Ï∏µ Î∂ÑÏÑù)
            var weaknesses = analyzeWeaknesses(subjectRatios, subjectAverages);
            
            // ÏÑ±Ï†Å Ï∂îÏù¥ Î∂ÑÏÑù (ÌïòÏù¥Î∏åÎ¶¨Îìú Ï†ëÍ∑ºÎ≤ï)
            var trends = [];
            Object.keys(subjectRatios).forEach(function(subject) {
                var ratios = subjectRatios[subject];
                if (ratios.length >= 3) {
                    var hybridResult = calculateHybridTrend(ratios);
                    
                    if (hybridResult && Math.abs(hybridResult.shortTermTrend) > 5) {
                        trends.push({
                            subject: subject,
                            shortTermTrend: hybridResult.shortTermTrend,
                            stability: hybridResult.stability,
                            pattern: hybridResult.pattern,
                            type: hybridResult.shortTermTrend > 0 ? 'up' : 'down',
                            intensity: getIntensityDescription(hybridResult.shortTermTrend)
                        });
                    }
                }
            });
            
            // Ï∂îÏ≤úÏÇ¨Ìï≠ ÏÉùÏÑ±
            var recommendations = [];
            
            if (weaknesses.length > 0) {
                recommendations.push({
                    priority: "ÎÜíÏùå",
                    action: weaknesses[0].subject + " ÏßëÏ§ë ÌïôÏäµ",
                    reason: weaknesses[0].description
                });
            }
            
            if (bestGrade <= 2 && latestGrade > bestGrade) {
                recommendations.push({
                    priority: "Ï§ëÍ∞Ñ",
                    action: "ÏµúÍ≥† ÏÑ±Ï†Å ÌöåÎ≥µÏùÑ ÏúÑÌïú Ï†ÑÎûµ ÏàòÎ¶Ω",
                    reason: "ÏµúÍ≥† " + bestGrade + "Îì±Í∏âÏóêÏÑú ÌòÑÏû¨ " + latestGrade + "Îì±Í∏âÏúºÎ°ú ÌïòÎùΩ"
                });
            }
            
            if (trends.filter(t => t.type === 'up').length > 0) {
                var upTrend = trends.filter(t => t.type === 'up').sort((a, b) => b.shortTermTrend - a.shortTermTrend)[0];
                recommendations.push({
                    priority: "ÎÇÆÏùå",
                    action: upTrend.subject + " ÏÉÅÏäπÏÑ∏ Ïú†ÏßÄ",
                    reason: upTrend.intensity + " Ìñ•ÏÉÅ Ï∂îÏÑ∏"
                });
            }
            
            // Íµ¨Ï≤¥Ï†Å Îì±Í∏â ÏÉÅÏäπ Ï†ÑÎûµ ÏÉùÏÑ±
            var gradeStrategy = generateGradeStrategy(student, gradeKeys, subjectRatios, subjectAverages);
            
            return {
                summary: {
                    name: student.name,
                    attendanceNumber: student.attendanceNumber,
                    testCount: gradeKeys.length,
                    totalTests: window.discoveredTestSheets ? window.discoveredTestSheets.length : 12,
                    avgGrade: avgGrade,
                    avgScore: avgScore,
                    bestGrade: bestGrade,
                    bestScore: bestScore,
                    bestTest: bestTest,
                    bestTestSource: bestTestSource,
                    latestGrade: latestGrade
                },
                strengths: strengths.slice(0, 3),
                weaknesses: weaknesses.slice(0, 3),
                trends: trends,
                recommendations: recommendations,
                gradeStrategy: gradeStrategy
            };
        }
        
 function generateGradeStrategy(student, gradeKeys, subjectRatios, subjectAverages) {
    if (gradeKeys.length < 2) return null;
    
    // ÏµúÍ∑º 4Ìöå ÏãúÌóò Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú
    var recentTests = gradeKeys.slice(-4);
    var recentData = [];
    
    recentTests.forEach(function(testName) {
        var gradeData = student.grades[testName];
        if (gradeData) {
            recentData.push({
                name: testName,
                grade: parseInt(gradeData.grade),
                score: parseInt(gradeData.score)
            });
        }
    });
    
    if (recentData.length < 2) return null;
    
    // ÏµúÍ∑º 4Ìöå ÌèâÍ∑† Í≥ÑÏÇ∞
    var recentAvgGrade = Math.round(recentData.reduce((sum, test) => sum + test.grade, 0) / recentData.length * 10) / 10;
    var recentAvgScore = Math.round(recentData.reduce((sum, test) => sum + test.score, 0) / recentData.length);
    
    // averageGrade Î≥ÄÏàò Ï∂îÍ∞Ä
    var averageGrade = recentAvgGrade;
    
    // Î™©Ìëú Îì±Í∏â ÏÑ§Ï†ï (ÌòÑÏû¨ ÌèâÍ∑†Î≥¥Îã§ Ìïú Îì±Í∏â ÏúÑ)
        var targetGrade;
        if (averageGrade <= 1.5) {
            targetGrade = 1; // Ïù¥ÎØ∏ ÏµúÏÉÅÏúÑÍ∂å
       } else if (averageGrade <= 2.5) {
    targetGrade = Math.max(1, Math.ceil(averageGrade) - 1);
} else if (averageGrade <= 4.0) {
    targetGrade = Math.max(1, Math.ceil(averageGrade) - 1);
} else {
    targetGrade = Math.max(1, Math.ceil(averageGrade) - 2); // 5Îì±Í∏â Ïù¥ÌïòÎäî 2Îì±Í∏â Ìñ•ÏÉÅ
}
            var targetScore = getTargetScore(targetGrade);
            var neededPoints = targetScore - recentAvgScore;
            
            // Îã¨ÏÑ± Í∞ÄÎä•ÏÑ± ÌèâÍ∞Ä
            var possibility = 'medium';
            if (neededPoints <= 5) possibility = 'high';
            else if (neededPoints > 15) possibility = 'low';
            
            // Í≥ºÎ™©Î≥Ñ Ï†êÏàò ÌôïÎ≥¥ Ï†ÑÎûµ
            var subjectStrategies = [];
            var totalPossibleGain = 0;
            
            Object.keys(subjectAverages).forEach(function(subject) {
                var avg = subjectAverages[subject];
                var recent4Ratios = subjectRatios[subject] ? subjectRatios[subject].slice(-4) : [];
                
                if (recent4Ratios.length === 0) return;
                
                var recent4Avg = recent4Ratios.reduce((a, b) => a + b) / recent4Ratios.length;
                var maxRatio = Math.max(...recent4Ratios);
                var potential = Math.max(0, maxRatio - recent4Avg);
                
                var strategy = '';
                var strategyColor = '';
                var possibleGain = 0;
                
                if (recent4Avg < 60) {
                    strategy = 'Í∏∞Î≥∏Í∏∞ Î≥¥Í∞ï ÌïÑÏöî';
                    strategyColor = '#ef4444'; // Îπ®Í∞ÑÏÉâ
                    possibleGain = Math.min(4, potential * 0.2); // 20% ÏÑ±Ï∑®ÎèÑ Ìñ•ÏÉÅ = ÏïΩ 4Ï†ê
                } else if (recent4Avg < 80) {
                    strategy = 'ÏïàÏ†ïÌôî ÌïÑÏöî';
                    strategyColor = '#f59e0b'; // Ï£ºÌô©ÏÉâ
                    possibleGain = Math.min(3, potential * 0.15);
                } else if (recent4Avg < 95) {
                    strategy = 'Ïã§Ïàò Î∞©ÏßÄ ÏßëÏ§ë';
                    strategyColor = '#10b981'; // ÎÖπÏÉâ
                    possibleGain = Math.min(2, potential * 0.1);
                } else {
                    strategy = 'ÌòÑÏû¨ ÏàòÏ§Ä Ïú†ÏßÄ';
                    strategyColor = '#6366f1'; // Î≥¥ÎùºÏÉâ
                    possibleGain = 1;
                }
                
                if (possibleGain > 0.5) {
                    subjectStrategies.push({
                        subject: subject,
                        currentAvg: Math.round(recent4Avg),
                        strategy: strategy,
                        strategyColor: strategyColor,
                        possibleGain: Math.round(possibleGain * 10) / 10
                    });
                    totalPossibleGain += possibleGain;
                }
            });
            
            // Í∞ÄÎä•ÏÑ± Ïû¨ÌèâÍ∞Ä
            if (totalPossibleGain >= neededPoints * 1.2) possibility = 'high';
            else if (totalPossibleGain < neededPoints * 0.8) possibility = 'low';
            
            subjectStrategies.sort((a, b) => b.possibleGain - a.possibleGain);

            // ÏÉÅÏúÑ 4Í≥ºÎ™©Îßå ÏÑ†ÌÉù
            var top4Strategies = subjectStrategies.slice(0, 4);
            
            // ÏÉÅÏúÑ 4Í≥ºÎ™©Ïùò Ï†êÏàòÎßå Ìï©ÏÇ∞
            var top4TotalGain = 0;
            top4Strategies.forEach(function(strategy) {
                top4TotalGain += strategy.possibleGain;
            });
            
            console.log('ÏÉÅÏúÑ 4Í≥ºÎ™© Ï†êÏàò ÌôïÎ≥¥ Ìï©Í≥Ñ:', top4TotalGain);
            
            return {
                recentTests: recentData,
                recentAvgGrade: recentAvgGrade,
                recentAvgScore: recentAvgScore,
                targetGrade: targetGrade,
                targetScore: targetScore,
                neededPoints: neededPoints,
                possibility: possibility,
                subjectStrategies: top4Strategies,
                totalPossibleGain: Math.round(top4TotalGain * 10) / 10
            };
        }
        
        // Îì±Í∏âÎ≥Ñ Î™©Ìëú Ï†êÏàò Î∞òÌôò
        function getTargetScore(grade) {
            var scoreMap = {
                1: 90,
                2: 80,
                3: 70,
                4: 60,
                5: 50,
                6: 40
            };
            return scoreMap[grade] || 90;
        }
        
       // Îã§Ï∏µ Î∂ÑÏÑù Î∞©ÏãùÏúºÎ°ú Í∞úÏÑ† ÌïÑÏöî Í≥ºÎ™© Ï∞æÍ∏∞
function analyzeWeaknesses(subjectRatios, subjectAverages) {
    var weaknesses = [];
    var studentAvg = Object.values(subjectAverages).reduce((a, b) => a + b, 0) / Object.values(subjectAverages).length;
    
    // üÜï Í≥ºÎ™©Î≥Ñ ÏµúÍ∑º 4Ìöå ÌèâÍ∑† Í≥ÑÏÇ∞
    var recentAverages = {};
    Object.keys(subjectRatios).forEach(function(subject) {
        var ratios = subjectRatios[subject];
        if (ratios.length > 0) {
            var recentRatios = ratios.slice(-4);
            recentAverages[subject] = recentRatios.reduce((a, b) => a + b) / recentRatios.length;
        }
    });
    
    // üÜï ÌïôÏÉùÏùò ÏµúÍ∑º 4Ìöå Í≥ºÎ™©Î≥Ñ ÌèâÍ∑†Îì§Ïùò ÌèâÍ∑† Í≥ÑÏÇ∞
    var studentRecentAvg = Object.values(recentAverages).reduce((a, b) => a + b, 0) / Object.values(recentAverages).length;
    
    Object.keys(subjectRatios).forEach(function(subject) {
        var ratios = subjectRatios[subject];
        if (ratios.length === 0) return;
        
        var recentRatios = ratios.slice(-4);
        var recentAvg = recentAverages[subject];
        
        // üîß ÏÉàÎ°úÏö¥ Í∞úÏÑ† Í∏∞Ï§Ä
        var criteria = {
            // 1. Ï†àÎåÄÏ†Å Í∏∞Ï§Ä (ÏôÑÌôî)
            absoluteLow: recentAvg < 70,                          // Í∏∞Î≥∏ 70% ÎØ∏Îßå
            
            // 2. üÜï ÏÉÅÎåÄÏ†Å Í∏∞Ï§Ä (Í∞úÏù∏ ÎÇ¥ ÎπÑÍµê) - ÌïµÏã¨!
            relativeToSelf: recentAvg < studentRecentAvg - 10,    // Í∞úÏù∏ ÌèâÍ∑†Î≥¥Îã§ 10% Ïù¥ÏÉÅ ÎÇÆÏùå
            relativeToSelfStrict: recentAvg < studentRecentAvg * 0.85,  // Í∞úÏù∏ ÌèâÍ∑†Ïùò 85% ÎØ∏Îßå
            
            // 3. üÜï Îã§Î•∏ Í≥ºÎ™©Í≥ºÏùò Í≤©Ï∞®
            bigGap: checkSubjectGap(recentAvg, recentAverages),   // Îã§Î•∏ Í≥ºÎ™©Îì§Í≥º ÌÅ∞ Í≤©Ï∞®
            
            // 4. ÌïòÎùΩ Ï∂îÏÑ∏ (Í∏∞Ï°¥ Ïú†ÏßÄ, ÏôÑÌôî)
            declining: calculateSimpleTrend(ratios) < -8,         // 8% Ïù¥ÏÉÅ ÌïòÎùΩ Ï∂îÏÑ∏
            
            // 5. üÜï ÏùºÍ¥ÄÏÑ± Î∂ÄÏ°± (ÏïàÏ†ïÏÑ± ÎåÄÏã†)
            inconsistent: Math.max(...recentRatios) - Math.min(...recentRatios) > 25  // Ìé∏Ï∞® 25% Ïù¥ÏÉÅ
        };
        
        var criteriaCount = Object.values(criteria).filter(Boolean).length;
        
        // üîß Í∞úÏÑ† ÌïÑÏöî ÌåêÏ†ï: 1Í∞ú Ïù¥ÏÉÅ Ï°∞Í±¥ Ï∂©Ï°±
        if (criteriaCount >= 1) {
            var description = generateWeaknessDescription(criteria, recentAvg, studentRecentAvg);
            
            weaknesses.push({
                subject: subject,
                average: Math.round(recentAvg * 10) / 10,
                criteriaCount: criteriaCount,
                description: description,
                // üîß Ïö∞ÏÑ†ÏàúÏúÑ Ïû¨Ï°∞Ï†ï
                urgency: criteria.relativeToSelf || criteria.bigGap ? 'high' : 
                        criteria.absoluteLow || criteriaCount >= 3 ? 'medium' : 'low'
            });
        }
    });
    
    // üîß Ï†ïÎ†¨: ÏÉÅÎåÄÏ†Å ÏïΩÏ†ê ‚Üí Ï†àÎåÄÏ†Å ÏïΩÏ†ê ‚Üí Í∏∞Ï§Ä Ï∂©Ï°± Í∞úÏàò Ïàú
    weaknesses.sort((a, b) => {
        // ÏÉÅÎåÄÏ†Å ÏïΩÏ†ê(Í∞úÏù∏ ÎÇ¥ ÎπÑÍµê) Ïö∞ÏÑ†
        var aRelative = a.description.includes('Í∞úÏù∏ ÌèâÍ∑†Î≥¥Îã§') || a.description.includes('Îã§Î•∏ Í≥ºÎ™© ÎåÄÎπÑ');
        var bRelative = b.description.includes('Í∞úÏù∏ ÌèâÍ∑†Î≥¥Îã§') || b.description.includes('Îã§Î•∏ Í≥ºÎ™© ÎåÄÎπÑ');
        
        if (aRelative !== bRelative) {
            return bRelative - aRelative;
        }
        
        return b.criteriaCount - a.criteriaCount;
    });
    
    return weaknesses;
}

// üÜï Îã§Î•∏ Í≥ºÎ™©Í≥ºÏùò Í≤©Ï∞® Ï≤¥ÌÅ¨ Ìï®Ïàò
function checkSubjectGap(subjectAvg, allAverages) {
    var otherAverages = Object.values(allAverages).filter(avg => avg !== subjectAvg);
    if (otherAverages.length === 0) return false;
    
    var otherAvg = otherAverages.reduce((a, b) => a + b) / otherAverages.length;
    
    // Îã§Î•∏ Í≥ºÎ™© ÌèâÍ∑†Î≥¥Îã§ 15% Ïù¥ÏÉÅ ÎÇÆÏúºÎ©¥ Í≤©Ï∞® ÏûàÏùå
    return subjectAvg < otherAvg - 15;
}

// üÜï ÏïΩÏ†ê ÏÑ§Î™Ö ÏÉùÏÑ± Ìï®Ïàò
function generateWeaknessDescription(criteria, recentAvg, studentRecentAvg) {
    var reasons = [];
    
    if (criteria.relativeToSelf) {
        var gap = Math.round((studentRecentAvg - recentAvg) * 10) / 10;
        reasons.push("Í∞úÏù∏ ÌèâÍ∑†Î≥¥Îã§ " + gap + "% ÎÇÆÏùå");
    }
    
    if (criteria.bigGap) {
        reasons.push("Îã§Î•∏ Í≥ºÎ™© ÎåÄÎπÑ ÌÅ∞ Í≤©Ï∞®");
    }
    
    if (criteria.absoluteLow) {
        reasons.push("Ï†àÎåÄÏ†Å Í∞úÏÑ† ÌïÑÏöî");
    }
    
    if (criteria.declining) {
        reasons.push("ÌïòÎùΩ Ï∂îÏÑ∏");
    }
    
    if (criteria.inconsistent) {
        reasons.push("ÏÑ±Ï∑®ÎèÑ Ìé∏Ï∞® ÌÅº");
    }
    
    if (criteria.relativeToSelfStrict && !criteria.relativeToSelf) {
        reasons.push("Í∞úÏù∏ ÌèâÍ∑† ÎåÄÎπÑ Ï†ÄÏ°∞");
    }
    
    return reasons.join(', ') + " (ÏµúÍ∑º 4Ìöå: " + Math.round(recentAvg * 10) / 10 + "%)";
}
        
        // ÌïòÏù¥Î∏åÎ¶¨Îìú Ï∂îÏÑ∏ Î∂ÑÏÑù
        function calculateHybridTrend(ratios) {
            if (ratios.length < 4) return null;
            
            // 1. ÏµúÍ∑º 4Ìöå vs Ïù¥Ï†Ñ Îç∞Ïù¥ÌÑ∞ ÎπÑÍµê
            var recent4 = ratios.slice(-4);
            var earlier = ratios.slice(0, -4);
            
            var recentAvg = recent4.reduce((a, b) => a + b) / recent4.length;
            var earlierAvg = earlier.length > 0 ? 
                earlier.reduce((a, b) => a + b) / earlier.length : recentAvg;
            
            var shortTermTrend = Math.round((recentAvg - earlierAvg) * 10) / 10;
            
            // 2. ÏµúÍ≥†Ï†ê ÎåÄÎπÑ ÌòÑÏû¨ ÏúÑÏπò
            var maxScore = Math.max(...ratios);
            var currentScore = ratios[ratios.length - 1];
            var peakMaintenance = Math.round((currentScore / maxScore) * 100);
            
            // 3. ÏïàÏ†ïÏÑ± Í≥ÑÏÇ∞
            var avg = ratios.reduce((a, b) => a + b) / ratios.length;
            var variance = ratios.reduce((sum, val) => sum + Math.pow(val - avg, 2), 0) / ratios.length;
            var stability = Math.max(0, Math.round((100 - Math.sqrt(variance)) * 10) / 10);
            
            // 4. Ìå®ÌÑ¥ Ïù∏Ïãù
            var pattern = determinePattern(ratios);
            
            return {
                shortTermTrend: shortTermTrend,
                peakMaintenance: peakMaintenance,
                stability: stability,
                pattern: pattern
            };
        }
        
        // Í∞ÑÎã®Ìïú Ï∂îÏÑ∏ Í≥ÑÏÇ∞ (Îã§Ï∏µ Î∂ÑÏÑùÏö©)
        function calculateSimpleTrend(ratios) {
            if (ratios.length < 3) return 0;
            var recent = ratios.slice(-3);
            var earlier = ratios.slice(0, -3);
            if (earlier.length === 0) return 0;
            
            var recentAvg = recent.reduce((a, b) => a + b) / recent.length;
            var earlierAvg = earlier.reduce((a, b) => a + b) / earlier.length;
            return recentAvg - earlierAvg;
        }
        
        // ÏïàÏ†ïÏÑ± Í≥ÑÏÇ∞
        function calculateStability(ratios) {
            var avg = ratios.reduce((a, b) => a + b) / ratios.length;
            var variance = ratios.reduce((sum, val) => sum + Math.pow(val - avg, 2), 0) / ratios.length;
            return Math.max(0, 100 - Math.sqrt(variance));
        }
        
        // Ìå®ÌÑ¥ Í≤∞Ï†ï
        function determinePattern(ratios) {
            var improvements = 0;
            var declines = 0;
            
            for (var i = 1; i < ratios.length; i++) {
                var change = ratios[i] - ratios[i-1];
                if (change > 3) improvements++;
                else if (change < -3) declines++;
            }
            
            if (improvements > declines) return 'improving';
            else if (declines > improvements) return 'declining';
            else return 'stable';
        }
        
        // Í∞ïÎèÑ ÌëúÌòÑ Ìï®Ïàò
        function getIntensityDescription(trendValue) {
            var abs = Math.abs(trendValue);
            if (abs >= 20) return trendValue > 0 ? 'ÎöúÎ†∑Ìïú Í∏âÏÉÅÏäπ' : 'ÎöúÎ†∑Ìïú Í∏âÎùΩ';
            else if (abs >= 15) return trendValue > 0 ? 'Í∏âÏÉÅÏäπ' : 'Í∏âÎùΩ';
            else if (abs >= 10) return trendValue > 0 ? 'ÏÉÅÏäπ' : 'ÌïòÎùΩ';
            else return trendValue > 0 ? 'ÏôÑÎßåÌïú ÏÉÅÏäπ' : 'ÏôÑÎßåÌïú ÌïòÎùΩ';
        }
        
        function displayAIAnalysis(analysis) {
            var aiContentDiv = document.getElementById('aiContent');
            var summary = analysis.summary;
            
            var html = `
                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h4>üìä ÌòÑÏû¨ ÏÑ±Ï†Å ÌòÑÌô©</h4>
                        <p><strong>ÏùëÏãú ÌòÑÌô©:</strong> ${summary.testCount}/${summary.totalTests}Ìöå Î™®ÏùòÍ≥†ÏÇ¨</p>
                        <p><strong>ÏµúÍ≥† ÏÑ±Ï†Å:</strong> ${summary.bestGrade}Îì±Í∏â ${summary.bestScore}Ï†ê (${summary.bestTest}${summary.bestTestSource ? ' ' + summary.bestTestSource : ''})</p>
                        <p><strong>ÌèâÍ∑† Îì±Í∏â:</strong> ${summary.avgGrade}Îì±Í∏â</p>
                        <p><strong>ÌèâÍ∑† Ï†êÏàò:</strong> ${summary.avgScore}Ï†ê</p>
                        <p><strong>ÌòÑÏû¨ Îì±Í∏â:</strong> <span class="grade-${summary.latestGrade}">${summary.latestGrade}Îì±Í∏â</span></p>
                    </div>
                    
                    <div class="analysis-card">
                        <h4>üéØ Í∞ïÏ†ê Í≥ºÎ™© Î∂ÑÏÑù</h4>
                        ${analysis.strengths.length > 0 ? 
                            analysis.strengths.map((s, i) => `
                                <div style="margin: 8px 0;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>${i + 1}. ${s.subject}</span>
                                        <span style="font-weight: bold; color: #10b981;">${s.average}%</span>
                                    </div>
                                    <div class="progress-bar-container">
                                        <div class="progress-bar-fill grade-excellent" style="width: ${s.average}%"></div>
                                    </div>
                                </div>
                            `).join('') : 
                            '<p style="color: rgba(255,255,255,0.8);">Í∞ïÏ†ê Í≥ºÎ™©ÏùÑ Î∂ÑÏÑùÌïòÎ†§Î©¥ Îçî ÎßéÏùÄ Îç∞Ïù¥ÌÑ∞Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.</p>'
                        }
                    </div>
                </div>
                
                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h4>‚ö†Ô∏è Í∞úÏÑ† ÌïÑÏöî Í≥ºÎ™©</h4>
                        ${analysis.weaknesses.length > 0 ? 
                            analysis.weaknesses.map((w, i) => `
                                <div style="margin: 8px 0;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>${i + 1}. ${w.subject}</span>
                                        <span style="font-weight: bold; color: #f87171; font-size: 0.9em;">${w.average}%</span>
                                    </div>
                                    <div style="font-size: 0.8em; color: rgba(255,255,255,0.8); margin-top: 4px;">
                                        ${w.description}
                                    </div>
                                    <div class="progress-bar-container">
                                        <div class="progress-bar-fill grade-poor" style="width: ${w.average}%"></div>
                                    </div>
                                </div>
                            `).join('') : 
                            '<p style="color: rgba(255,255,255,0.8);">Î™®Îì† Í≥ºÎ™©Ïù¥ ÏñëÌò∏Ìïú ÏÉÅÌÉúÏûÖÎãàÎã§.</p>'
                        }
                    </div>
                    
                    <div class="analysis-card">
                        <h4>üìà ÏÑ±Ï†Å Ï∂îÏù¥ Î∂ÑÏÑù</h4>
                        ${analysis.trends.length > 0 ? 
                            analysis.trends.map(t => `
                                <div style="margin: 8px 0; display: flex; align-items: center; gap: 8px;">
                                    <span class="trend-${t.type}">${t.type === 'up' ? 'üìà' : 'üìâ'}</span>
                                    <span style="flex: 1;">${t.subject}</span>
                                    <div style="display: flex; flex-direction: column; align-items: end;">
                                        <span style="font-weight: bold; color: ${t.type === 'up' ? '#10b981' : '#f87171'};">
                                            ${t.intensity}
                                        </span>
                                        <span style="font-size: 0.75em; opacity: 0.8;">
                                            (${t.shortTermTrend > 0 ? '+' : ''}${t.shortTermTrend}%)
                                        </span>
                                    </div>
                                </div>
                            `).join('') : 
                            '<p style="color: rgba(255,255,255,0.8);">Ï∂îÏù¥ Î∂ÑÏÑùÏùÑ ÏúÑÌï¥ Îçî ÎßéÏùÄ ÏãúÌóò Îç∞Ïù¥ÌÑ∞Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.</p>'
                        }
                    </div>
                </div>
            `;
            
            // Íµ¨Ï≤¥Ï†Å Îì±Í∏â ÏÉÅÏäπ Ï†ÑÎûµ ÏÑπÏÖò Ï∂îÍ∞Ä
            if (analysis.gradeStrategy) {
                var strategy = analysis.gradeStrategy;
                var possibilityClass = 'possibility-' + strategy.possibility;
                var possibilityText = strategy.possibility === 'high' ? 'Îß§Ïö∞ ÎÜíÏùå' : 
                                    strategy.possibility === 'medium' ? 'Î≥¥ÌÜµ' : 'ÎÇÆÏùå';
                
                html += `
                    <div class="grade-strategy">
                        <h4>üéØ Íµ¨Ï≤¥Ï†Å Îì±Í∏â ÏÉÅÏäπ Ï†ÑÎûµ</h4>
                        
                        <div style="margin-bottom: 20px;">
                            <h5 style="margin-bottom: 10px; color: rgba(255,255,255,0.9);">üìä ÏµúÍ∑º 4Ìöå ÏãúÌóò ÌòÑÌô©</h5>
                            <div class="recent-tests-grid">
                                ${strategy.recentTests.map(test => `
                                    <div class="recent-test-item">
                                        <div class="recent-test-name">${test.name}</div>
                                        <div class="recent-test-grade grade-${test.grade}">${test.grade}Îì±Í∏â</div>
                                        <div class="recent-test-score">${test.score}Ï†ê</div>
                                    </div>
                                `).join('')}
                            </div>
                            <div style="text-align: center; margin-top: 10px; font-size: 0.9em; opacity: 0.9;">
                                ÌèâÍ∑†: ${strategy.recentAvgGrade}Îì±Í∏â ${strategy.recentAvgScore}Ï†ê
                            </div>
                        </div>
                        
                        <div class="target-analysis">
                            <div class="target-header">
                                <div>
                                    <div class="target-grade">${strategy.targetGrade}Îì±Í∏â Îã¨ÏÑ± Ï†ÑÎûµ</div>
                                    <div style="font-size: 1.0em; opacity: 0.9; margin-top: 5px;">
                                        Î™©Ìëú Ï†êÏàò: <strong>${strategy.targetScore}Ï†ê Ïù¥ÏÉÅ</strong> 
                                        <span style="font-size: 1.2em; font-weight: bold; color: #10b981; padding: 2px 8px; border-radius: 12px; margin-left: 8px;">
                                            ÌòÑÏû¨ ÌèâÍ∑† ÎåÄÎπÑ ${strategy.neededPoints > 0 ? '+' : ''}${strategy.neededPoints}Ï†ê
                                        </span>
                                    </div>
                                </div>
                                <div class="target-possibility ${possibilityClass}">
                                    ${strategy.possibility === 'high' ? 'üíö' : strategy.possibility === 'medium' ? 'üíõ' : 'üî∂'} Îã¨ÏÑ± Í∞ÄÎä•ÏÑ±: ${possibilityText}
                                </div>
                            </div>
                        </div>
                        
                        ${strategy.subjectStrategies.length > 0 ? `
                            <div>
                                <h5 style="margin: 15px 0 10px 0; color: rgba(255,255,255,0.9);">üìà Í≥ºÎ™©Î≥Ñ Ï†êÏàò ÌôïÎ≥¥ Ï†ÑÎûµ</h5>
                                <div class="subject-strategy-list">
                                    ${strategy.subjectStrategies.map((subj, i) => `
                                        <div class="subject-strategy-item">
                                            <div class="subject-strategy-left">
                                                <div class="subject-name">${i + 1}. ${subj.subject}</div>
                                                <div class="subject-detail">
                                                    ÏÑ±Ï∑®ÎèÑ ${subj.currentAvg}% 
                                                    <span style="color: ${subj.strategyColor}; font-weight: bold; padding: 2px 6px; border-radius: 8px; margin-left: 5px;">
                                                        ${subj.strategy}
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="subject-strategy-right">
                                                <div class="points-gain">+${subj.possibleGain}Ï†ê ÌôïÎ≥¥ Í∞ÄÎä•</div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                
                                <div class="total-strategy">
                                    <div class="total-points">
                                        <span>üí° Ï¥ù ÌôïÎ≥¥ Í∞ÄÎä• Ï†êÏàò: +${strategy.totalPossibleGain}Ï†ê</span>
                                        <span style="color: ${strategy.totalPossibleGain >= strategy.neededPoints ? '#10b981' : '#f59e0b'};">
                                            ${strategy.totalPossibleGain >= strategy.neededPoints ? 
                                                'Î™©Ìëú Îã¨ÏÑ±ÏùÑ ÏúÑÌïú ' + strategy.neededPoints + 'Ï†ê ÌôïÎ≥¥ Ï∂©Î∂ÑÌûà Í∞ÄÎä•!' : 
                                                'Î™©Ìëú Îã¨ÏÑ±ÏùÑ ÏúÑÌï¥ Ï∂îÍ∞Ä ÎÖ∏Î†• ÌïÑÏöî'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            if (analysis.recommendations.length > 0) {
                html += `
                    <div class="ai-recommendations">
                        <h4>üí° Ï†ïÎèôÎØºÍµ≠Ïñ¥ÎÖºÏà†ÌïôÏõê ÎßûÏ∂§ ÌïôÏäµ Ï†ÑÎûµ</h4>
                        ${analysis.recommendations.map(r => `
                            <div class="recommendation-item">
                                <div class="recommendation-priority">Ïö∞ÏÑ†ÏàúÏúÑ: ${r.priority}</div>
                                <div style="font-weight: bold;">${r.action}</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">${r.reason}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            aiContentDiv.innerHTML = html;
        }

        // Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ù ÌôïÏù∏
        function checkAdminPassword() {
            var password = document.getElementById('adminPassword').value.trim();
            
            if (password === '1212') {
                isAdminAuthenticated = true;
                localStorage.setItem('grade2-adminAuth', 'true');
                
                document.getElementById('adminAuthSection').style.display = 'none';
                document.getElementById('githubSetup').style.display = 'block';
                
                showStatus('‚úÖ Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!', 'success');
                
                // Í∏∞Ï°¥ ÏÑ§Ï†ïÏù¥ ÏûàÎã§Î©¥ Î°úÎìú
                loadExistingConfig();
            } else {
                showStatus('‚ùå ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.', 'error');
                document.getElementById('adminPassword').value = '';
            }
        }
        
        // Í¥ÄÎ¶¨Ïûê Ï†ëÍ∑º Ï¥àÍ∏∞Ìôî
        function resetAdminAccess() {
            isAdminAuthenticated = false;
            localStorage.removeItem('grade2-adminAuth');
            localStorage.removeItem('grade2-githubConfig');
            localStorage.removeItem('grade2-dataUrl');
            
            document.getElementById('adminAuthSection').style.display = 'block';
            document.getElementById('githubSetup').style.display = 'none';
            document.getElementById('uploadSection').style.display = 'none';
            
            document.getElementById('adminPassword').value = '';
            showStatus('üîÑ Í¥ÄÎ¶¨Ïûê Ï†ëÍ∑ºÏù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.', 'warning');
        }
        
        // Í∏∞Ï°¥ ÏÑ§Ï†ï Î°úÎìú
        function loadExistingConfig() {
            var savedConfig = localStorage.getItem('grade2-githubConfig');
            var savedDataUrl = localStorage.getItem('grade2-dataUrl');
            
            if (savedConfig && savedDataUrl) {
                try {
                    githubConfig = JSON.parse(savedConfig);
                    dataUrl = savedDataUrl;
                    
                    // ÏûÖÎ†• ÌïÑÎìúÏóê Í∏∞Ï°¥ Í∞í Ï±ÑÏö∞Í∏∞
                    document.getElementById('githubUsername').value = githubConfig.username || '';
                    document.getElementById('githubRepo').value = githubConfig.repo || '';
                    if (githubConfig.token) {
                        document.getElementById('githubToken').value = githubConfig.token;
                    }
                    
                    // UI Ï†ÑÌôò
                    document.getElementById('githubSetup').style.display = 'none';
                    document.getElementById('uploadSection').style.display = 'block';
                    
                    // Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏãúÎèÑ
                    loadDataFromGitHub();
                } catch (error) {
                    console.error('ÏÑ§Ï†ï Î°úÎìú Ïã§Ìå®:', error);
                }
            }
        }

        function switchTab(tabName) {
            var tabs = document.querySelectorAll('.tab');
            var contents = document.querySelectorAll('.tab-content');
            
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            for (var i = 0; i < contents.length; i++) {
                contents[i].classList.remove('active');
            }
            
            if (tabName === 'student') {
                document.querySelector('.tab').classList.add('active');
                document.getElementById('studentTab').classList.add('active');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('adminTab').classList.add('active');
                
                // Í¥ÄÎ¶¨Ïûê ÌÉ≠ Ï†ëÍ∑º Ïãú Ïù∏Ï¶ù ÏÉÅÌÉú ÌôïÏù∏
                checkAdminAuthStatus();
            }
        }
        
        // Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ù ÏÉÅÌÉú ÌôïÏù∏
        function checkAdminAuthStatus() {
            var savedAuth = localStorage.getItem('grade2-adminAuth');
            
            if (savedAuth === 'true') {
                isAdminAuthenticated = true;
                document.getElementById('adminAuthSection').style.display = 'none';
                document.getElementById('githubSetup').style.display = 'block';
                loadExistingConfig();
            } else {
                isAdminAuthenticated = false;
                document.getElementById('adminAuthSection').style.display = 'block';
                document.getElementById('githubSetup').style.display = 'none';
                document.getElementById('uploadSection').style.display = 'none';
            }
        }

        // GitHub ÏÑ§Ï†ï Ï†ÄÏû•
        function saveGitHubConfig() {
            if (!isAdminAuthenticated) {
                showStatus('‚ùå Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.', 'error');
                return;
            }
            
            var username = document.getElementById('githubUsername').value.trim();
            var repo = document.getElementById('githubRepo').value.trim();
            var token = document.getElementById('githubToken').value.trim();
            
            if (!username || !repo) {
                showStatus('GitHub ÏÇ¨Ïö©ÏûêÎ™ÖÍ≥º Ï†ÄÏû•ÏÜå Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }
            
            githubConfig = {
                username: username,
                repo: repo,
                token: token
            };
            
            dataUrl = 'https://raw.githubusercontent.com/' + username + '/' + repo + '/main/grade2-data.json';
            
            localStorage.setItem('grade2-githubConfig', JSON.stringify(githubConfig));
            localStorage.setItem('grade2-dataUrl', dataUrl);
            
            showStatus('GitHub ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!', 'success');
            
            document.getElementById('githubSetup').style.display = 'none';
            document.getElementById('uploadSection').style.display = 'block';
            
            loadDataFromGitHub();
        }
        
        // GitHub Ïó∞Í≤∞ ÌÖåÏä§Ìä∏
        function testGitHubConnection() {
            if (!isAdminAuthenticated) {
                showStatus('‚ùå Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.', 'error');
                return;
            }
            
            var username = document.getElementById('githubUsername').value.trim();
            var repo = document.getElementById('githubRepo').value.trim();
            
            if (!username || !repo) {
                showStatus('ÏÇ¨Ïö©ÏûêÎ™ÖÍ≥º Ï†ÄÏû•ÏÜå Ïù¥Î¶ÑÏùÑ Î®ºÏ†Ä ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }
            
            var testUrl = 'https://api.github.com/repos/' + username + '/' + repo;
            
            showStatus('Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ Ï§ë...', 'warning');
            
            fetch(testUrl)
                .then(function(response) {
                    if (response.ok) {
                        showStatus('‚úÖ Ï†ÄÏû•ÏÜå Ïó∞Í≤∞ ÏÑ±Í≥µ! ÏÑ§Ï†ïÏùÑ Ï†ÄÏû•Ìï¥Ï£ºÏÑ∏Ïöî.', 'success');
                    } else if (response.status === 404) {
                        showStatus('‚ùå Ï†ÄÏû•ÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. ÏÇ¨Ïö©ÏûêÎ™ÖÍ≥º Ï†ÄÏû•ÏÜå Ïù¥Î¶ÑÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                    } else {
                        showStatus('‚ùå Ïó∞Í≤∞ Ïã§Ìå®. Ï†ÄÏû•ÏÜåÍ∞Ä PublicÏù∏ÏßÄ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                    }
                })
                .catch(function(error) {
                    showStatus('‚ùå ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
                });
        }
        
        // GitHubÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        function loadDataFromGitHub() {
            if (!dataUrl) {
                console.log('Îç∞Ïù¥ÌÑ∞ URLÏù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏùå');
                return false;
            }
            
            updateDataStatus('Ïò®ÎùºÏù∏ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...');
            console.log('Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏãúÎèÑ:', dataUrl);
            
            var requestUrl = dataUrl + '?t=' + Date.now() + '&cache=' + Math.random();
            
            fetch(requestUrl)
                .then(function(response) {
                    console.log('ÏùëÎãµ ÏÉÅÌÉú:', response.status);
                    if (!response.ok) {
                        if (response.status === 404) {
                            throw new Error('Îç∞Ïù¥ÌÑ∞ ÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. Í¥ÄÎ¶¨ÏûêÍ∞Ä ÏïÑÏßÅ Îç∞Ïù¥ÌÑ∞Î•º ÏóÖÎ°úÎìúÌïòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                        } else {
                            throw new Error('ÏÑúÎ≤Ñ Ïò§Î•ò (' + response.status + ')');
                        }
                    }
                    return response.text();
                })
                .then(function(text) {
                    console.log('Î∞õÏùÄ Îç∞Ïù¥ÌÑ∞ ÌÅ¨Í∏∞:', text.length);
                    
                    var data;
                    try {
                        data = JSON.parse(text);
                    } catch (parseError) {
                        console.error('JSON ÌååÏã± Ïò§Î•ò:', parseError);
                        throw new Error('Îç∞Ïù¥ÌÑ∞ ÌòïÏãùÏù¥ Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
                    }
                    
                    console.log('ÌååÏã±Îêú Îç∞Ïù¥ÌÑ∞:', data);
                    
                    if (!data || typeof data !== 'object') {
                        throw new Error('Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
                    }
                    
                    studentByNumber = data.students || {};
                    maxScores = Object.assign({}, maxScores, data.maxScores || {});
                    window.discoveredTestSheets = data.testSheets || [];
                    window.attendanceToNameMap = data.attendanceMap || {};
                    
                    var studentCount = Object.keys(studentByNumber).length;
                    console.log('Î°úÎìúÎêú ÌïôÏÉù Ïàò:', studentCount);
                    
                    isDataLoaded = studentCount > 0;
                    
                    if (isDataLoaded) {
                        updateDataStatus('‚úÖ ÏÑ±Ï†Å Îç∞Ïù¥ÌÑ∞Í∞Ä Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§!', true, data.lastUpdated);
                        console.log('Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏÑ±Í≥µ!');
                    } else {
                        updateDataStatus('ÏóÖÎ°úÎìúÎêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÎπÑÏñ¥ÏûàÏäµÎãàÎã§. Í¥ÄÎ¶¨ÏûêÏóêÍ≤å Î¨∏ÏùòÌïòÏÑ∏Ïöî.');
                        console.log('Îç∞Ïù¥ÌÑ∞Îäî ÏûàÏßÄÎßå ÌïôÏÉù Ï†ïÎ≥¥Í∞Ä ÏóÜÏùå');
                    }
                    
                    updateStudentTab();
                    return true;
                })
                .catch(function(error) {
                    console.error('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
                    updateDataStatus('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®: ' + error.message);
                    isDataLoaded = false;
                    updateStudentTab();
                    return false;
                });
        }
        
        // GitHubÏóê Îç∞Ïù¥ÌÑ∞ ÏóÖÎ°úÎìú
        function uploadToGitHub(jsonData) {
            if (!githubConfig.username || !githubConfig.repo) {
                throw new Error('GitHub ÏÑ§Ï†ïÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
            }
            
            var apiUrl = 'https://api.github.com/repos/' + githubConfig.username + '/' + githubConfig.repo + '/contents/grade2-data.json';
            
            return fetch(apiUrl)
                .then(function(response) {
                    if (response.ok) {
                        return response.json();
                    }
                    return null;
                })
                .then(function(existingFile) {
                    var requestBody = {
                        message: 'Í≥†2 ÏÑ±Ï†Å Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ - ' + new Date().toLocaleString('ko-KR'),
                        content: btoa(unescape(encodeURIComponent(JSON.stringify(jsonData, null, 2))))
                    };
                    
                    if (existingFile && existingFile.sha) {
                        requestBody.sha = existingFile.sha;
                    }
                    
                    var headers = {
                        'Content-Type': 'application/json'
                    };
                    
                    if (githubConfig.token) {
                        headers['Authorization'] = 'token ' + githubConfig.token;
                    }
                    
                    return fetch(apiUrl, {
                        method: 'PUT',
                        headers: headers,
                        body: JSON.stringify(requestBody)
                    });
                })
                .then(function(response) {
                    if (!response.ok) {
                        if (response.status === 401) {
                            throw new Error('GitHub ÌÜ†ÌÅ∞Ïù¥ Ïú†Ìö®ÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
                        } else if (response.status === 403) {
                            throw new Error('Ï†ÄÏû•ÏÜåÏóê Ïì∞Í∏∞ Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§. ÌÜ†ÌÅ∞ Í∂åÌïúÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                        } else {
                            throw new Error('ÏóÖÎ°úÎìú Ïã§Ìå® (' + response.status + ')');
                        }
                    }
                    return response.json();
                });
        }

        // ÎìúÎûòÍ∑∏Ïï§ÎìúÎ°≠ Ïù¥Î≤§Ìä∏ ÏÑ§Ï†ï
        var uploadArea = document.getElementById('uploadArea');
        var fileInput = document.getElementById('fileInput');
        var processBtn = document.getElementById('processBtn');
        
        if (uploadArea) {
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                var files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    processBtn.disabled = false;
                }
            });
        }
        
        if (fileInput) {
            fileInput.addEventListener('change', function() {
                processBtn.disabled = !fileInput.files.length;
            });
        }

        function processFileAndUpload() {
            if (!isAdminAuthenticated) {
                showStatus('‚ùå Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.', 'error');
                return;
            }
            
            var file = fileInput.files[0];
            if (!file) {
                showStatus('ÌååÏùºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }
            
            if (!githubConfig.username || !githubConfig.repo) {
                showStatus('GitHub ÏÑ§Ï†ïÏùÑ Î®ºÏ†Ä ÏôÑÎ£åÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }
            
            showProgress(true);
            updateProgress(10, 'ÌååÏùº ÏùΩÎäî Ï§ë...');
            
            var reader = new FileReader();
            reader.onload = function(e) {
                try {
                    updateProgress(30, 'Îç∞Ïù¥ÌÑ∞ ÌååÏã± Ï§ë...');
                    var data = new Uint8Array(e.target.result);
                    var workbook = XLSX.read(data, {type: 'array'});
                    
                    updateProgress(50, 'ÌïôÏÉù Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨ Ï§ë...');
                    parseExcelData(workbook);
                    
                    updateProgress(70, 'GitHubÏóê ÏóÖÎ°úÎìú Ï§ë...');
                    
                    var uploadData = {
                        students: studentByNumber,
                        maxScores: maxScores,
                        testSheets: window.discoveredTestSheets,
                        attendanceMap: window.attendanceToNameMap,
                        lastUpdated: new Date().toISOString()
                    };
                    
                    uploadToGitHub(uploadData)
                        .then(function(result) {
                            updateProgress(100, 'ÏôÑÎ£å!');
                            setTimeout(function() {
                                showProgress(false);
                                showStatus('‚úÖ Í≥†2 Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú GitHubÏóê ÏóÖÎ°úÎìúÎêòÏóàÏäµÎãàÎã§!', 'success');
                                
                                setTimeout(function() {
                                    loadDataFromGitHub();
                                }, 1000);
                                
                                updateDataSummary();
                                updateStudentTab();
                            }, 500);
                        })
                        .catch(function(error) {
                            showProgress(false);
                            showStatus('GitHub ÏóÖÎ°úÎìú Ïã§Ìå®: ' + error.message, 'error');
                            console.error('ÏóÖÎ°úÎìú Ïò§Î•ò:', error);
                        });
                    
                } catch (error) {
                    showProgress(false);
                    showStatus('ÌååÏùº Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message, 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        function parseExcelData(workbook) {
            var attendanceToNameMap = {};
            var studentsByName = {};
            var testSources = {};
            
            var firstSheetName = workbook.SheetNames[0];
            if (workbook.Sheets[firstSheetName]) {
                var firstSheet = workbook.Sheets[firstSheetName];
                var firstSheetData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
                
                console.log('Ï≤´Î≤àÏß∏ ÏãúÌä∏ÏóêÏÑú ÎßåÏ†ê Ï†ïÎ≥¥ Ï∂îÏ∂ú:', firstSheetName);
                
                var sourceStartRow = -1;
                var testNameColumn = -1;
                var sourceColumn = 15;
                
                for (var i = 0; i < firstSheetData.length; i++) {
                    var row = firstSheetData[i];
                    if (row) {
                        for (var j = 0; j < row.length; j++) {
                            if (row[j] && row[j].toString().includes('ÏãúÌóòÏ∂úÏ≤ò')) {
                                sourceStartRow = i + 1;
                                console.log('ÏãúÌóòÏ∂úÏ≤ò Ìó§Îçî Î∞úÍ≤¨, Îç∞Ïù¥ÌÑ∞ ÏãúÏûë Ìñâ:', sourceStartRow + 1);
                                break;
                            }
                        }
                        if (sourceStartRow !== -1) break;
                    }
                }
                
                if (sourceStartRow === -1) {
                    sourceStartRow = 6;
                    console.log('ÏãúÌóòÏ∂úÏ≤ò Ìó§ÎçîÎ•º Ï∞æÏßÄ Î™ªÌï®. 7ÌñâÎ∂ÄÌÑ∞ ÏãúÏûë');
                }
                
                for (var col = 0; col < 5; col++) {
                    if (firstSheetData[sourceStartRow] && firstSheetData[sourceStartRow][col] && 
                        firstSheetData[sourceStartRow][col].toString().includes('Î™®ÌÅ¥')) {
                        testNameColumn = col;
                        console.log('ÏãúÌóòÎ™Ö Ïó¥ Î∞úÍ≤¨:', col + 1, 'Ïó¥');
                        break;
                    }
                }
                
                if (testNameColumn === -1) {
                    testNameColumn = 0;
                }
                
                for (var i = sourceStartRow; i < firstSheetData.length; i++) {
                    var row = firstSheetData[i];
                    if (row && row[testNameColumn] && row[sourceColumn]) {
                        var testName = row[testNameColumn].toString().trim();
                        var source = row[sourceColumn].toString().trim();
                        
                        if (testName.includes('Î™®ÌÅ¥')) {
                            testSources[testName] = source;
                            console.log('Ï∂úÏ≤ò Îß§Ìïë:', testName, '->', source);
                        }
                    }
                }
                
                console.log('ÏàòÏßëÎêú ÏãúÌóò Ï∂úÏ≤ò:', testSources);
            }
            
            var mappingSheetName = workbook.SheetNames[1];
            window.currentWorkbook = workbook;
            if (workbook.Sheets[mappingSheetName]) {
                var mappingSheet = workbook.Sheets[mappingSheetName];
                var mappingData = XLSX.utils.sheet_to_json(mappingSheet, {header: 1});
                
                console.log('Ï∂úÍ≤∞Î≤àÌò∏-Ïù¥Î¶Ñ Îß§Ìïë ÏãúÌä∏:', mappingSheetName);
                
                for (var i = 1; i < mappingData.length; i++) {
                    var row = mappingData[i];
                    if (row && row[0] && row[1]) {
                        var name = row[0];
                        var attendanceNumber = row[1];
                        attendanceToNameMap[attendanceNumber] = name;
                        
                        if (!studentsByName[name]) {
                            studentsByName[name] = {
                                name: name,
                                attendanceNumber: attendanceNumber,
                                grades: {}
                            };
                        }
                    }
                }
                
                console.log('Ï¥ù Îß§ÌïëÎêú ÌïôÏÉù Ïàò:', Object.keys(attendanceToNameMap).length);
            }
            
            var allSheetNames = workbook.SheetNames;
            var testSheetNames = [];
            
            for (var i = 0; i < allSheetNames.length; i++) {
                var sheetName = allSheetNames[i];
                if (sheetName.includes('Î™®ÌÅ¥') && !sheetName.includes('ÏÑ±Ï†ÅÌëú')) {
                    testSheetNames.push(sheetName);
                }
            }
            
            testSheetNames.sort(function(a, b) {
                var numA = parseInt(a.match(/\d+/));
                var numB = parseInt(b.match(/\d+/));
                return numA - numB;
            });
            
            console.log('Î∞úÍ≤¨Îêú Î™®ÌÅ¥ ÏãúÌä∏Îì§:', testSheetNames);
            
            console.log('=== 1Îã®Í≥Ñ: Î™®Îì† ÏãúÌä∏Ïùò ÎßåÏ†ê Ï∂îÏ∂ú ===');
            extractMaxScoresDirectly(workbook, testSheetNames);
            console.log('Ï∂îÏ∂ú ÏôÑÎ£åÎêú maxScores:', maxScores);
            
            console.log('=== 2Îã®Í≥Ñ: ÌïôÏÉù Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨ ===');
            for (var s = 0; s < testSheetNames.length; s++) {
                var sheetName = testSheetNames[s];
                if (!workbook.Sheets[sheetName]) continue;
                
                console.log('Ï≤òÎ¶¨ Ï§ëÏù∏ ÏãúÌä∏:', sheetName);
                
                var worksheet = workbook.Sheets[sheetName];
                var jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                
                if (jsonData.length <= 1) continue;
                
                var headers = jsonData[0];
                
                var sheetMaxScores = maxScores[sheetName] || {};
                console.log(sheetName + ' ÏÇ¨Ïö©Ìï† ÎßåÏ†ê Ï†ïÎ≥¥:', sheetMaxScores);
                
                for (var i = 1; i < jsonData.length; i++) {
                    var row = jsonData[i];
                    if (!row || !row[0]) continue;
                    
                    var name = row[0];
                    
                    if (!studentsByName[name]) continue;
                    
                    var className = row[2];
                    var grade = row[3];
                    var score = row[4];
                    var needScore = row[14];
                    var gradeCut = row[15];
                    
                    var source = testSources[sheetName] || '';
                    
                    var details = {};
                    var ratios = {};
                    
                    for (var j = 5; j < Math.min(14, headers.length, row.length); j++) {
                        var subject = headers[j];
                        var subjectScore = row[j];
                        
                        if (subject && subjectScore !== null && subjectScore !== undefined && subjectScore !== '') {
                            details[subject] = subjectScore;
                            
                            var maxScore = sheetMaxScores[subject];
                            if (maxScore) {
                                ratios[subject] = Math.round((subjectScore / maxScore) * 100);
                                console.log('ÎπÑÏú® Í≥ÑÏÇ∞:', sheetName, name, subject, subjectScore + '/' + maxScore + ' = ' + ratios[subject] + '%');
                            } else {
                                console.log('‚ö†Ô∏è ÎßåÏ†ê Ï†ïÎ≥¥ ÏóÜÏùå:', sheetName, name, subject, '| Î≥¥Ïú† ÎßåÏ†ê Ï†ïÎ≥¥:', Object.keys(sheetMaxScores));
                                
                                if (subject.includes('ÌôîÎ≤ï')) {
                                    var forcedMax = 22;
                                    if (sheetName === 'Î™®ÌÅ¥5Ìöå' || sheetName === 'Î™®ÌÅ¥4Ìöå') {
                                        forcedMax = 13;
                                    }
                                    ratios[subject] = Math.round((subjectScore / forcedMax) * 100);
                                    console.log('   ‚Üí Í∞ïÏ†ú Í≥ÑÏÇ∞:', subjectScore + '/' + forcedMax + ' = ' + ratios[subject] + '%');
                                }
                            }
                        }
                    }
                    
                    studentsByName[name].grades[sheetName] = {
                        grade: grade,
                        score: score,
                        className: className,
                        details: details,
                        ratios: ratios,
                        needScore: needScore,
                        gradeCut: gradeCut,
                        source: source
                    };
                }
            }
            
            studentByNumber = {};
            for (var attendanceNumber in attendanceToNameMap) {
                var name = attendanceToNameMap[attendanceNumber];
                if (studentsByName[name]) {
                    studentByNumber[attendanceNumber] = studentsByName[name];
                }
            }
            
            window.discoveredTestSheets = testSheetNames;
            window.attendanceToNameMap = attendanceToNameMap;
            isDataLoaded = true;
            
            console.log('ÏµúÏ¢Ö Ï≤òÎ¶¨Îêú ÌïôÏÉù Ïàò:', Object.keys(studentByNumber).length);
        }

        function extractMaxScoresDirectly(workbook, testSheetNames) {
            console.log('Í∞Å ÏãúÌä∏ÏóêÏÑú ÏßÅÏ†ë ÎßåÏ†ê Ï∂îÏ∂ú ÏãúÏûë...');
            
            maxScores = {};
            
            var hwaBubHardCoded = {
                'Î™®ÌÅ¥1Ìöå': 22, 'Î™®ÌÅ¥2Ìöå': 22, 'Î™®ÌÅ¥3Ìöå': 22, 'Î™®ÌÅ¥4Ìöå': 13, 'Î™®ÌÅ¥5Ìöå': 13,
                'Î™®ÌÅ¥6Ìöå': 22, 'Î™®ÌÅ¥7Ìöå': 22, 'Î™®ÌÅ¥8Ìöå': 22, 'Î™®ÌÅ¥9Ìöå': 22, 'Î™®ÌÅ¥10Ìöå': 15,
                'Î™®ÌÅ¥11Ìöå': 22, 'Î™®ÌÅ¥12Ìöå': 22
            };
            
            for (var i = 0; i < testSheetNames.length; i++) {
                var sheetName = testSheetNames[i];
                if (!workbook.Sheets[sheetName]) continue;
                
                var worksheet = workbook.Sheets[sheetName];
                var sheetData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                
                if (sheetData.length <= 1) continue;
                
                var headers = sheetData[0];
                console.log(sheetName + ' Ìó§Îçî:', headers);
                
                maxScores[sheetName] = {};
                
                for (var colIndex = 5; colIndex < Math.min(14, headers.length); colIndex++) {
                    var subject = headers[colIndex];
                    if (!subject) continue;
                    
                    var maxScore = 0;
                    var validScores = [];
                    
                    for (var rowIndex = 1; rowIndex < sheetData.length; rowIndex++) {
                        var row = sheetData[rowIndex];
                        if (row && row[colIndex] !== null && row[colIndex] !== undefined && row[colIndex] !== '') {
                            var score = parseInt(row[colIndex]);
                            if (!isNaN(score) && score > 0) {
                                validScores.push(score);
                                maxScore = Math.max(maxScore, score);
                            }
                        }
                    }
                    
                    if (maxScore > 0) {
                        maxScores[sheetName][subject] = maxScore;
                        console.log('ÏßÅÏ†ë Ï∂îÏ∂úÎêú ÎßåÏ†ê:', sheetName, '"' + subject + '"', '=', maxScore + 'Ï†ê', '(Ïú†Ìö® Ï†êÏàò:', validScores.length + 'Í∞ú)');
                        
                        if (subject.includes('ÌôîÎ≤ï')) {
                            console.log('üéØ ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏ ÎßåÏ†ê ÌôïÏ†ï:', sheetName, '=', maxScore + 'Ï†ê');
                        }
                    } else {
                        console.log('‚ö†Ô∏è Ïú†Ìö®Ìïú Ï†êÏàò ÏóÜÏùå:', sheetName, subject);
                    }
                }
                
                var hwaBubFound = false;
                for (var subj in maxScores[sheetName]) {
                    if (subj.includes('ÌôîÎ≤ï')) {
                        hwaBubFound = true;
                        break;
                    }
                }
                
                if (!hwaBubFound && hwaBubHardCoded[sheetName]) {
                    for (var h = 0; h < headers.length; h++) {
                        if (headers[h] && headers[h].includes('ÌôîÎ≤ï')) {
                            maxScores[sheetName][headers[h]] = hwaBubHardCoded[sheetName];
                            console.log('üîß ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏ ÌïòÎìúÏΩîÎî© Ï†ÅÏö©:', sheetName, headers[h], '=', hwaBubHardCoded[sheetName] + 'Ï†ê');
                            break;
                        }
                    }
                }
                
                console.log(sheetName + ' Ï∂îÏ∂ú ÏôÑÎ£å:', maxScores[sheetName]);
            }
            
            console.log('Î™®Îì† ÏãúÌä∏ ÎßåÏ†ê Ï∂îÏ∂ú ÏôÑÎ£å:', maxScores);
        }
        
        function showProgress(show) {
            document.getElementById('progressContainer').style.display = show ? 'block' : 'none';
        }
        
        function updateProgress(percent, message) {
            var progressBar = document.getElementById('progressBar');
            progressBar.style.width = percent + '%';
            progressBar.textContent = message || (percent + '%');
        }
        
        function showStatus(message, type) {
            var statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
            statusDiv.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(function() {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }
        
        function updateDataSummary() {
            var summaryDiv = document.getElementById('dataSummary');
            var gridDiv = document.getElementById('summaryGrid');
            
            var totalStudents = Object.keys(studentByNumber).length;
            var mappingCount = window.attendanceToNameMap ? Object.keys(window.attendanceToNameMap).length : 0;
            var discoveredSheets = window.discoveredTestSheets ? window.discoveredTestSheets.length : 0;
            
            var html = '<div class="summary-item"><div class="summary-value">' + mappingCount + '</div><div class="summary-label">Îß§Ìïë ÌÖåÏù¥Î∏î ÌïôÏÉùÏàò</div></div>';
            html += '<div class="summary-item"><div class="summary-value">' + totalStudents + '</div><div class="summary-label">ÏÑ±Ï†Å Îç∞Ïù¥ÌÑ∞ ÌïôÏÉùÏàò</div></div>';
            html += '<div class="summary-item"><div class="summary-value">' + discoveredSheets + '</div><div class="summary-label">Î∞úÍ≤¨Îêú ÏãúÌä∏ Ïàò</div></div>';
            
            if (githubConfig.username && githubConfig.repo) {
                html += '<div class="summary-item"><div class="summary-value" style="font-size: 0.9em;">' + githubConfig.username + '/' + githubConfig.repo + '</div><div class="summary-label">GitHub Ï†ÄÏû•ÏÜå</div></div>';
            }
            
            gridDiv.innerHTML = html;
            summaryDiv.style.display = 'block';
        }
        
        function updateDataStatus(message, isSuccess, lastUpdated) {
            var statusMessage = document.getElementById('dataStatusMessage');
            var noDataDiv = document.getElementById('noData');
            
            if (isSuccess && lastUpdated) {
                var updateDate = new Date(lastUpdated);
                var formattedDate = updateDate.toLocaleDateString('ko-KR') + ' ' + updateDate.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
                statusMessage.innerHTML = message + '<br><small style="color: #666;">ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: ' + formattedDate + '</small>';
                noDataDiv.style.background = '#d4edda';
                noDataDiv.style.color = '#155724';
                noDataDiv.style.border = '1px solid #c3e6cb';
            } else {
                statusMessage.innerHTML = message;
                noDataDiv.style.background = '#f8f9fa';
                noDataDiv.style.color = '#666';
                noDataDiv.style.border = 'none';
            }
        }
        
        function updateStudentTab() {
            var noDataDiv = document.getElementById('noData');
            var searchBtn = document.getElementById('searchBtn');
            
            if (isDataLoaded && Object.keys(studentByNumber).length > 0) {
                searchBtn.disabled = false;
                
                if (githubConfig.username && githubConfig.repo) {
                    var shareableUrl = window.location.origin + window.location.pathname + 
                                     '?username=' + githubConfig.username + '&repo=' + githubConfig.repo;
                    document.getElementById('shareableUrl').textContent = shareableUrl;
                    document.getElementById('urlInfo').style.display = 'block';
                }
            } else {
                searchBtn.disabled = true;
                document.getElementById('urlInfo').style.display = 'none';
            }
        }

        function searchStudent() {
            if (!isDataLoaded) {
                alert('Îç∞Ïù¥ÌÑ∞Í∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }
            
            var query = document.getElementById('searchInput').value.trim();
            var resultsDiv = document.getElementById('results');
            var noResultsDiv = document.getElementById('noResults');
            var noDataDiv = document.getElementById('noData');
            
            resultsDiv.style.display = 'none';
            noResultsDiv.style.display = 'none';
            noDataDiv.style.display = 'none';
            
            if (!query) {
                alert('Ï∂úÍ≤∞Î≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            var student = studentByNumber[query];
            
            if (!student) {
                noResultsDiv.style.display = 'block';
                return;
            }
            
            displayStudentInfo(student);
            generateAIAnalysis(student); // AI Î∂ÑÏÑù Ïã§Ìñâ
            displaySummaryTable(student);
            displayGrades(student.grades);
            resultsDiv.style.display = 'block';

        
            // Î±ÉÏßÄ Ìà¥ÌåÅ Ïù¥Î≤§Ìä∏Î•º Îçî Í∏¥ ÏßÄÏó∞ ÌõÑ Ïã§Ìñâ
            setTimeout(addBadgeTooltipEvents, 500);

            // Í∑∏ÎûòÌîÑ ÏÉùÏÑ± (ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ ÌõÑ)
            setTimeout(function() {
                createChart(student);
            }, 100);
            
        }
            
        
               function displayStudentInfo(student) {
            var studentInfoDiv = document.getElementById('studentInfo');
            var gradeKeys = Object.keys(student.grades);
            var totalTests = window.discoveredTestSheets ? window.discoveredTestSheets.length : 12;
            var attendedTests = gradeKeys.length;
            
            studentInfoDiv.innerHTML = 
    '<div class="student-info">' +
    '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">' +
    '<h2>üë®‚Äçüéì ' + student.name + '</h2>' +
    '<button onclick="generatePdfReport(\'' + student.name + '\')" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;">üñ®Ô∏è PDF Î¶¨Ìè¨Ìä∏ Ï†ÄÏû•</button>' +
    '</div>' +
                '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">' +
                '<div style="display: flex; justify-content: space-between;"><span style="font-weight: 600; color: #555;">Ï∂úÍ≤∞Î≤àÌò∏:</span><span style="color: #333; font-weight: bold;">' + student.attendanceNumber + '</span></div>' +
                '<div style="display: flex; justify-content: space-between;"><span style="font-weight: 600; color: #555;">ÏùëÏãú ÌòÑÌô©:</span><span style="color: #333; font-weight: bold;">' + attendedTests + '/' + totalTests + 'Ìöå</span></div>' +
                '</div></div>' +
                displayStudyFortune(student.name) +
                displayDashboard(student);
            
                   // üÜï ÌïôÏäµ Í≥ÑÌöçÏÑú ÏÑπÏÖò ÌëúÏãú
document.getElementById('studyPlanSection').style.display = 'block';
        }

        function displaySummaryTable(student) {
            var summaryTableDiv = document.getElementById('summaryTable');
            
            var allTests = window.discoveredTestSheets || ['Î™®ÌÅ¥1Ìöå', 'Î™®ÌÅ¥2Ìöå', 'Î™®ÌÅ¥3Ìöå'];
            var totalTests = allTests.length;
            
            var tableHtml = '<div class="summary-table">';
            tableHtml += '<h3>üìä Ï†ÑÏ≤¥ ÏÑ±Ï†Å ÌòÑÌô© (' + totalTests + 'Í∞ú ÏãúÌóò)</h3>';
            tableHtml += '<table class="grade-table">';
            tableHtml += '<thead><tr>';
            tableHtml += '<th class="test-name">ÏãúÌóò</th>';
            tableHtml += '<th>Îì±Í∏â</th>';
            tableHtml += '<th>Ï†êÏàò</th>';
            tableHtml += '<th>Îì±Í∏âÏª∑</th>';
            tableHtml += '<th>Ï∂úÏ≤ò</th>';
            tableHtml += '</tr></thead><tbody>';
            
            for (var i = 0; i < allTests.length; i++) {
                var testName = allTests[i];
                var gradeData = student.grades[testName];
                
                tableHtml += '<tr>';
                tableHtml += '<td class="test-name">' + testName + '</td>';
                
                if (gradeData) {
                    tableHtml += '<td class="grade-cell grade-' + gradeData.grade + '">' + gradeData.grade + '</td>';
                    tableHtml += '<td class="score-cell">' + gradeData.score + '</td>';
                    tableHtml += '<td class="score-cell">' + (gradeData.gradeCut || '-') + '</td>';
                    tableHtml += '<td class="source-cell">' + (gradeData.source || '-') + '</td>';
                } else {
                    tableHtml += '<td class="absent-cell">ÎØ∏ÏùëÏãú</td>';
                    tableHtml += '<td class="absent-cell">-</td>';
                    tableHtml += '<td class="absent-cell">-</td>';
                    tableHtml += '<td class="absent-cell">-</td>';
                }
                
                tableHtml += '</tr>';
            }
            
            tableHtml += '</tbody></table></div>';
            
            tableHtml += '<div class="summary-table" style="margin-top: 30px;">';
            tableHtml += '<h3>üìà Í≥ºÎ™©Î≥Ñ ÏÑ±Ï∑®ÎèÑ ÎπÑÏú® ÌòÑÌô©</h3>';
            tableHtml += '<div style="overflow-x: auto;">';
            tableHtml += '<table class="grade-table" style="min-width: 1200px; font-size: 0.8em;">';
            tableHtml += '<thead><tr>';
            tableHtml += '<th style="min-width: 80px; font-size: 0.85em;">ÏãúÌóò</th>';
            tableHtml += '<th style="min-width: 50px; font-size: 0.85em;">Îì±Í∏â</th>';
            tableHtml += '<th style="min-width: 50px; font-size: 0.85em;">Ï†êÏàò</th>';
            tableHtml += '<th style="min-width: 60px; font-size: 0.85em;">Îì±Í∏âÏª∑ ÌïÑÏöîÏ†êÏàò</th>';
            tableHtml += '<th style="min-width: 80px; font-size: 0.85em;">ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏</th>';
            tableHtml += '<th style="min-width: 60px; font-size: 0.85em;">Î¨∏Î≤ï</th>';
            tableHtml += '<th style="min-width: 80px; font-size: 0.85em;">ÎèÖÏÑú(Ïù∏Î¨∏)</th>';
            tableHtml += '<th style="min-width: 80px; font-size: 0.85em;">ÎèÖÏÑú(ÏÇ¨Ìöå)</th>';
            tableHtml += '<th style="min-width: 80px; font-size: 0.85em;">ÎèÖÏÑú(Í≥ºÌïô)</th>';
            tableHtml += '<th style="min-width: 80px; font-size: 0.85em;">Î¨∏Ìïô(ÌòÑÎåÄÏãú)</th>';
            tableHtml += '<th style="min-width: 90px; font-size: 0.85em;">Î¨∏Ìïô(ÌòÑÎåÄÏÜåÏÑ§)</th>';
            tableHtml += '<th style="min-width: 90px; font-size: 0.85em;">Î¨∏Ìïô(Í≥†Ï†ÑÏãúÍ∞Ä)</th>';
            tableHtml += '<th style="min-width: 90px; font-size: 0.85em;">Î¨∏Ìïô(Í≥†Ï†ÑÏÜåÏÑ§)</th>';
            tableHtml += '<th style="min-width: 70px; font-size: 0.85em;">ÏãúÌóòÏ∂úÏ≤ò</th>';
            tableHtml += '</tr></thead><tbody>';
            
            for (var i = 0; i < allTests.length; i++) {
                var testName = allTests[i];
                var gradeData = student.grades[testName];
                
                tableHtml += '<tr>';
                tableHtml += '<td class="test-name" style="font-size: 0.85em;">' + testName + '</td>';
                
                if (gradeData) {
                    tableHtml += '<td class="grade-cell grade-' + gradeData.grade + '" style="font-size: 0.85em;">' + gradeData.grade + '</td>';
                    tableHtml += '<td class="score-cell" style="font-size: 0.85em;">' + gradeData.score + '</td>';
                    
                    var needScoreDisplay = '';
                    if (gradeData.needScore !== null && gradeData.needScore !== undefined) {
                        needScoreDisplay = gradeData.needScore > 0 ? '(' + gradeData.needScore + ')' : '(' + gradeData.needScore + ')';
                    }
                    tableHtml += '<td class="score-cell" style="font-size: 0.85em;">' + needScoreDisplay + '</td>';
                    
                    var subjectOrder = ['ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏', 'Î¨∏Î≤ï', 'ÎèÖÏÑú(Ïù∏Î¨∏)', 'ÎèÖÏÑú(ÏÇ¨Ìöå)', 'ÎèÖÏÑú(Í≥ºÌïô)', 
                                       'Î¨∏Ìïô(ÌòÑÎåÄÏãú)', 'Î¨∏Ìïô(ÌòÑÎåÄÏÜåÏÑ§)', 'Î¨∏Ìïô(Í≥†Ï†ÑÏãúÍ∞Ä)', 'Î¨∏Ìïô(Í≥†Ï†ÑÏÜåÏÑ§)'];
                    
                    for (var j = 0; j < subjectOrder.length; j++) {
                        var targetSubject = subjectOrder[j];
                        var ratio = 0;
                        
                        // Í≥ºÎ™©Î™Ö Îß§Ìïë ÌÖåÏù¥Î∏î
                        var subjectMapping = {
                            'ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏': ['ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏', 'ÌôîÎ≤ïÍ≥ºÏûëÎ¨∏', 'ÌôîÏûë'],
                            'Î¨∏Î≤ï': ['Î¨∏Î≤ï', 'Ïñ∏Ïñ¥ÏôÄ Îß§Ï≤¥', 'Ïñ∏Ïñ¥ÏôÄÎß§Ï≤¥', 'Ïñ∏Îß§'],
                            'ÎèÖÏÑú(Ïù∏Î¨∏)': ['ÎèÖÏÑú(Ïù∏Î¨∏)', 'ÎèÖÏÑúÏù∏Î¨∏', 'Ïù∏Î¨∏'],
                            'ÎèÖÏÑú(ÏÇ¨Ìöå)': ['ÎèÖÏÑú(ÏÇ¨Ìöå)', 'ÎèÖÏÑúÏÇ¨Ìöå', 'ÏÇ¨Ìöå'],
                            'ÎèÖÏÑú(Í≥ºÌïô)': ['ÎèÖÏÑú(Í≥ºÌïô)', 'ÎèÖÏÑúÍ≥ºÌïô', 'Í≥ºÌïô'],
                            'Î¨∏Ìïô(ÌòÑÎåÄÏãú)': ['Î¨∏Ìïô(ÌòÑÎåÄÏãú)', 'Î¨∏ÌïôÌòÑÎåÄÏãú', 'ÌòÑÎåÄÏãú', 'ÌòÑÏãú'],
                            'Î¨∏Ìïô(ÌòÑÎåÄÏÜåÏÑ§)': ['Î¨∏Ìïô(ÌòÑÎåÄÏÜåÏÑ§)', 'Î¨∏ÌïôÌòÑÎåÄÏÜåÏÑ§', 'ÌòÑÎåÄÏÜåÏÑ§', 'ÌòÑÏÜå'],
                            'Î¨∏Ìïô(Í≥†Ï†ÑÏãúÍ∞Ä)': ['Î¨∏Ìïô(Í≥†Ï†ÑÏãúÍ∞Ä)', 'Î¨∏ÌïôÍ≥†Ï†ÑÏãúÍ∞Ä', 'Í≥†Ï†ÑÏãúÍ∞Ä', 'Í≥†Ïãú'],
                            'Î¨∏Ìïô(Í≥†Ï†ÑÏÜåÏÑ§)': ['Î¨∏Ìïô(Í≥†Ï†ÑÏÜåÏÑ§)', 'Î¨∏ÌïôÍ≥†Ï†ÑÏÜåÏÑ§', 'Í≥†Ï†ÑÏÜåÏÑ§', 'Í≥†ÏÜå']
                        };
                        
                        // Îß§Ïπ≠ÎêòÎäî Í≥ºÎ™© Ï∞æÍ∏∞
                        var possibleNames = subjectMapping[targetSubject] || [targetSubject];
                        
                        for (var actualSubject in gradeData.ratios) {
                            var found = false;
                            
                            // Ï†ïÌôïÌïú Îß§Ïπ≠ Ïö∞ÏÑ†
                            for (var k = 0; k < possibleNames.length; k++) {
                                if (actualSubject === possibleNames[k]) {
                                    ratio = gradeData.ratios[actualSubject] || 0;
                                    found = true;
                                    break;
                                }
                            }
                            
                            // Ï†ïÌôïÌïú Îß§Ïπ≠Ïù¥ ÏóÜÏúºÎ©¥ Î∂ÄÎ∂Ñ Îß§Ïπ≠
                            if (!found) {
                                for (var k = 0; k < possibleNames.length; k++) {
                                    if (actualSubject.includes(possibleNames[k]) || possibleNames[k].includes(actualSubject)) {
                                        ratio = gradeData.ratios[actualSubject] || 0;
                                        found = true;
                                        break;
                                    }
                                }
                            }
                            
                            if (found) break;
                        }
                        
                        var ratioColor = ratio >= 90 ? '#e74c3c' : ratio >= 80 ? '#f39c12' : ratio >= 70 ? '#f1c40f' : 
                                        ratio >= 60 ? '#2ecc71' : ratio >= 50 ? '#3498db' : '#95a5a6';
                        var ratioText = ratio > 0 ? ratio + '%' : '-';
                        
                        tableHtml += '<td style="color: ' + ratioColor + '; font-weight: bold; text-align: center; font-size: 0.85em;">' + ratioText + '</td>';
                    }
                    
                    tableHtml += '<td class="source-cell" style="font-size: 0.85em;">' + (gradeData.source || '-') + '</td>';
                } else {
                    tableHtml += '<td class="absent-cell" style="font-size: 0.85em;">ÎØ∏ÏùëÏãú</td>';
                    tableHtml += '<td class="absent-cell" style="font-size: 0.85em;">-</td>';
                    tableHtml += '<td class="absent-cell" style="font-size: 0.85em;">-</td>';
                    for (var k = 0; k < 9; k++) {
                        tableHtml += '<td class="absent-cell" style="font-size: 0.85em;">-</td>';
                    }
                    tableHtml += '<td class="absent-cell" style="font-size: 0.85em;">-</td>';
                }
                
                tableHtml += '</tr>';
            }
            
            tableHtml += '</tbody></table></div></div>';
            
            summaryTableDiv.innerHTML = tableHtml;
        }

        function displayGrades(grades) {
            var gradeCardsDiv = document.getElementById('gradeCards');
            gradeCardsDiv.innerHTML = '';
            
            var testNames = Object.keys(grades);
            
            for (var i = 0; i < testNames.length; i++) {
                var testName = testNames[i];
                var gradeData = grades[testName];
                var gradeCard = document.createElement('div');
                gradeCard.className = 'grade-card';
                
                var detailsHtml = '';
                if (gradeData.details) {
                    var detailKeys = Object.keys(gradeData.details);
                    for (var j = 0; j < detailKeys.length; j++) {
                        var subject = detailKeys[j];
                        var score = gradeData.details[subject];
                        var ratio = gradeData.ratios[subject] || 0;
                        var ratioColor = ratio >= 80 ? '#e74c3c' : ratio >= 60 ? '#f39c12' : ratio >= 40 ? '#f1c40f' : '#95a5a6';
                        
                       detailsHtml += 
                            '<div class="grade-item" style="padding: 4px 8px; font-size: 0.8em;">' +
                            '<span class="grade-label" style="font-size: 0.75em;">' + subject + '</span>' +
                            '<span class="grade-value" style="font-size: 0.8em;">' + score + 'Ï†ê ' +
                            '<span style="color: ' + ratioColor + '; font-size: 0.7em;">(' + ratio + '%)</span>' +
                            '</span></div>';
                    }
                }
                
                var cutInfo = '';
                  if (gradeData.gradeCut) {
                    cutInfo += '<div class="grade-summary-item"><div class="grade-summary-value" style="font-size: 1.1em;">' + gradeData.gradeCut + 'Ï†ê</div><div class="grade-summary-label" style="font-size: 0.75em;">ÎÇ¥ Îì±Í∏âÏª∑</div></div>';
                }
                
                if (gradeData.needScore !== null && gradeData.needScore !== undefined) {
                    var needScoreDisplay = gradeData.needScore > 0 ? '+' + gradeData.needScore : gradeData.needScore;
                    var needScoreColor = gradeData.needScore <= 0 ? '#2ecc71' : '#e74c3c';
                    cutInfo += '<div class="grade-summary-item"><div class="grade-summary-value" style="color: ' + needScoreColor + '; font-size: 1.1em;">' + needScoreDisplay + 'Ï†ê</div><div class="grade-summary-label" style="font-size: 0.75em;">ÌïúÎì±Í∏â‚Üë ÌïÑÏöîÏ†êÏàò</div></div>';
                }
                
                var sourceInfo = '';
                if (gradeData.source && gradeData.source.trim() !== '') {
                    sourceInfo = '<div class="grade-summary-item"><div class="grade-summary-value" style="font-size: 0.8em; color: #666;">' + gradeData.source + '</div><div class="grade-summary-label" style="font-size: 0.75em;">Ï∂úÏ≤ò</div></div>';
                }
                
                gradeCard.innerHTML = 
                '<h3 style="font-size: 1.1em; margin-bottom: 12px;">üìù ' + testName + '</h3>' +
                '<div class="grade-summary" style="grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 8px; margin-bottom: 12px; padding: 10px;">' +
                '<div class="grade-summary-item"><div class="grade-summary-value grade-' + gradeData.grade + '" style="font-size: 1.1em;">' + gradeData.grade + 'Îì±Í∏â</div><div class="grade-summary-label" style="font-size: 0.75em;">ÎÇ¥ Îì±Í∏â</div></div>' +
                '<div class="grade-summary-item"><div class="grade-summary-value" style="font-size: 1.1em;">' + gradeData.score + 'Ï†ê</div><div class="grade-summary-label" style="font-size: 0.75em;">ÎÇ¥ Ï†êÏàò</div></div>' +
                cutInfo + sourceInfo + '</div>' +
                (detailsHtml ? '<div style="margin: 10px 0; padding: 8px; background: #f8f9fa; border-radius: 6px;"><h4 style="margin-bottom: 8px; color: #333; font-size: 0.85em;">üìä Í≥ºÎ™©Î≥Ñ ÏÑ±Ï∑®ÎèÑ (Ï†êÏàò Î∞è ÎπÑÏú®)</h4><div class="grade-details" style="grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 6px;">' + detailsHtml + '</div></div>' : '');
               
                gradeCardsDiv.appendChild(gradeCard);
            }
        }

        // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        document.getElementById('searchInput').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/[^0-9]/g, '');
            if (e.target.value.length > 4) {
                e.target.value = e.target.value.slice(0, 4);
            }
        });

        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchStudent();
            }
        });

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ïã§Ìñâ
        window.onload = function() {
            console.log('ÌéòÏù¥ÏßÄ Î°úÎìú ÏãúÏûë');
            
            // URL ÌååÎùºÎØ∏ÌÑ∞ÏóêÏÑú ÏÑ§Ï†ï ÌôïÏù∏
            var urlParams = new URLSearchParams(window.location.search);
            var urlUsername = urlParams.get('username');
            var urlRepo = urlParams.get('repo');
            
            var autoConfig = null;
            
            // URL ÌååÎùºÎØ∏ÌÑ∞ÏóêÏÑú ÏÑ§Ï†ïÏùÑ Ï∞æÏïòÏùÑ Îïå
            if (urlUsername && urlRepo) {
                console.log('URL ÌååÎùºÎØ∏ÌÑ∞ÏóêÏÑú ÏÑ§Ï†ï Î∞úÍ≤¨:', urlUsername, urlRepo);
                autoConfig = {
                    username: urlUsername,
                    repo: urlRepo,
                    token: ''
                };
            } else {
                // GitHub Pages ÏûêÎèô Í∞êÏßÄ
                var hostname = window.location.hostname;
                var pathname = window.location.pathname;
                
                if (hostname.includes('.github.io')) {
                    var username = hostname.split('.')[0];
                    var repo = pathname.split('/')[1];
                    
                    if (username && repo) {
                        console.log('GitHub PagesÏóêÏÑú ÏûêÎèô Í∞êÏßÄÎêú ÏÑ§Ï†ï:', username, repo);
                        autoConfig = {
                            username: username,
                            repo: repo,
                            token: ''
                        };
                    }
                }
            }
            
            // Ï†ÄÏû•Îêú GitHub ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞
            var savedConfig = localStorage.getItem('grade2-githubConfig');
            var savedDataUrl = localStorage.getItem('grade2-dataUrl');
            
            var finalConfig = null;
            var configSource = '';
            
            if (savedConfig && savedDataUrl) {
                try {
                    finalConfig = JSON.parse(savedConfig);
                    configSource = 'Ï†ÄÏû•Îêú ÏÑ§Ï†ï';
                } catch (error) {
                    console.error('Ï†ÄÏû•Îêú ÏÑ§Ï†ï ÌååÏã± Ïã§Ìå®:', error);
                }
            } else if (autoConfig) {
                finalConfig = autoConfig;
                configSource = 'ÏûêÎèô Í∞êÏßÄ';
            }
            
            if (finalConfig && finalConfig.username && finalConfig.repo) {
                console.log('ÏÑ§Ï†ï ÏÇ¨Ïö© (' + configSource + '):', finalConfig);
                
                githubConfig = finalConfig;
                dataUrl = 'https://raw.githubusercontent.com/' + finalConfig.username + '/' + finalConfig.repo + '/main/grade2-data.json';
                
                // localStorageÏóê Ï†ÄÏû• (Îã§ÏùåÏóê Îçî Îπ†Î•¥Í≤å Î°úÎìúÌïòÍ∏∞ ÏúÑÌï¥)
                localStorage.setItem('grade2-githubConfig', JSON.stringify(githubConfig));
                localStorage.setItem('grade2-dataUrl', dataUrl);
                
                console.log('Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏãúÏûë...');
                // ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ ÌõÑ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏãúÎèÑ
                setTimeout(function() {
                    loadDataFromGitHub();
                }, 1000);
                
            } else {
                console.log('ÏÑ§Ï†ïÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå');
                updateDataStatus('GitHub ÏÑ§Ï†ïÏù¥ ÌïÑÏöîÌï©ÎãàÎã§. Í¥ÄÎ¶¨Ïûê ÌÉ≠ÏóêÏÑú ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.');
            }
            
            updateStudentTab();
        };

        // üìä ÌÜµÍ≥Ñ Í≥ÑÏÇ∞ Ìï®Ïàò
        function calculateStatistics(student) {
            var grades = student.grades;
            var gradeKeys = Object.keys(grades);
            
            if (gradeKeys.length === 0) return null;
            
            var scores = [];
            var gradeValues = [];
            var recentScores = [];
            
            gradeKeys.forEach(function(testName) {
                var gradeData = grades[testName];
                if (gradeData.score) scores.push(parseInt(gradeData.score));
                if (gradeData.grade) gradeValues.push(parseInt(gradeData.grade));
            });
            
            // ÏµúÍ∑º 3Ìöå Ï†êÏàò
            recentScores = scores.slice(-3);
            
            var avgScore = scores.length > 0 ? Math.round(scores.reduce((a, b) => a + b) / scores.length) : 0;
            var avgGrade = gradeValues.length > 0 ? Math.round(gradeValues.reduce((a, b) => a + b) / gradeValues.length * 10) / 10 : 0;
            var bestScore = scores.length > 0 ? Math.max(...scores) : 0;
            var bestGrade = gradeValues.length > 0 ? Math.min(...gradeValues) : 0;
            var latestScore = scores.length > 0 ? scores[scores.length - 1] : 0;
            
            // ÏÑ±Ï†Å Î≥ÄÌôî Í≥ÑÏÇ∞
            var scoreChange = 0;
            if (scores.length >= 2) {
                var recent2 = scores.slice(-2);
                scoreChange = recent2[1] - recent2[0];
            }
            
            // ÏÉÅÏúÑ ÌçºÏÑºÌä∏ Í≥ÑÏÇ∞ (ÏûÑÏùò Í≥ÑÏÇ∞)
            var percentile = Math.max(1, Math.min(99, Math.round((100 - avgGrade * 10) + Math.random() * 10)));
            
            return {
                avgScore: avgScore,
                avgGrade: avgGrade,
                bestScore: bestScore,
                bestGrade: bestGrade,
                latestScore: latestScore,
                scoreChange: scoreChange,
                percentile: percentile,
                testCount: gradeKeys.length,
                totalTests: window.discoveredTestSheets ? window.discoveredTestSheets.length : 12
            };
        }
        
        // Î∂ÑÏÇ∞ Í≥ÑÏÇ∞ Ìó¨Ìçº Ìï®Ïàò
        function calculateVariance(numbers) {
            var mean = numbers.reduce((a, b) => a + b) / numbers.length;
            var variance = numbers.reduce((sum, num) => sum + Math.pow(num - mean, 2), 0) / numbers.length;
            return variance;
        }
        
                   
               // üèÜ ÌôïÏû•Îêú Î±ÉÏßÄ ÏãúÏä§ÌÖú (43Í∞ú)
        function generateAchievementBadges(student, stats) {
            var badges = [];
            var grades = student.grades;
            var gradeKeys = Object.keys(grades);
            
            if (!stats) return badges;
            
            // Ï†êÏàòÏôÄ Îì±Í∏â Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ
            var scores = [];
            var gradeValues = [];
            var subjectScores = {};
            var subjectRatios = {}; // ‚úÖ Ïó¨Í∏∞ÏÑú Ï¥àÍ∏∞Ìôî
            
            gradeKeys.forEach(function(testName) {
                var gradeData = grades[testName];
                if (gradeData.score) scores.push(parseInt(gradeData.score));
                if (gradeData.grade) gradeValues.push(parseInt(gradeData.grade));
                
                // Í≥ºÎ™©Î≥Ñ Ï†êÏàò ÏàòÏßë
                if (gradeData.details) {
                    Object.keys(gradeData.details).forEach(function(subject) {
                        if (!subjectScores[subject]) subjectScores[subject] = [];
                        subjectScores[subject].push(gradeData.details[subject]);
                    });
                }
                
                // ‚úÖ Í≥ºÎ™©Î≥Ñ ÎπÑÏú® ÏàòÏßë Ï∂îÍ∞Ä
                if (gradeData.ratios) {
                    Object.keys(gradeData.ratios).forEach(function(subject) {
                        if (!subjectRatios[subject]) subjectRatios[subject] = [];
                        subjectRatios[subject].push(gradeData.ratios[subject]);
                    });
                }
            });
            
            // Ïó∞ÏÜç ÏÉÅÏäπ/ÌïòÎùΩ Ï≤¥ÌÅ¨
            var consecutiveUp = 0;
            var consecutiveDown = 0;
            var maxConsecutiveUp = 0;
            var maxConsecutiveDown = 0;
            
            for (var i = 1; i < scores.length; i++) {
                if (scores[i] > scores[i-1]) {
                    consecutiveUp++;
                    consecutiveDown = 0;
                    maxConsecutiveUp = Math.max(maxConsecutiveUp, consecutiveUp);
                } else if (scores[i] < scores[i-1]) {
                    consecutiveDown++;
                    consecutiveUp = 0;
                    maxConsecutiveDown = Math.max(maxConsecutiveDown, consecutiveDown);
                } else {
                    consecutiveUp = 0;
                    consecutiveDown = 0;
                }
            }
            
            // Í≥ºÎ™©Î≥Ñ Í∞ïÏ†ê Ï≤¥ÌÅ¨
            var strongSubjects = 0;
            var excellentSubjects = 0;
            Object.keys(subjectScores).forEach(function(subject) {
                var avg = subjectScores[subject].reduce((a, b) => a + b) / subjectScores[subject].length;
                if (avg >= 80) strongSubjects++;
                if (avg >= 90) excellentSubjects++;
            });
            
      // üèÜ Î±ÉÏßÄ Ï°∞Í±¥ Ï≤¥ÌÅ¨ (43Í∞ú Î±ÉÏßÄ, Ï§ëÎ≥µ Í∞ÄÎä•)
        
        // 1. Îì±Í∏â Í¥ÄÎ†® Î±ÉÏßÄ (5Í∞ú)
        if (stats.bestGrade === 1) {
            badges.push({ icon: "üëë", text: "1Îì±Í∏â Îã¨ÏÑ±", type: "grade", isNew: true });
        }
        if (stats.bestGrade <= 2) {
            badges.push({ icon: "üèÜ", text: "ÏÉÅÏúÑÎì±Í∏â Îã¨ÏÑ±", type: "grade", isNew: false });
        }
        if (stats.bestGrade <= 3) {
            badges.push({ icon: "ü•â", text: "3Îì±Í∏â Ïù¥ÎÇ¥", type: "grade", isNew: false });
        }
        if (stats.avgGrade <= 2.5) {
            badges.push({ icon: "üé™", text: "Ïö∞ÏàòÌïú Îì±Í∏â", type: "grade", isNew: false });
        }
        if (stats.avgGrade <= 1.5) {
            badges.push({ icon: "üéñÔ∏è", text: "ÏµúÏÉÅÏúÑ Îì±Í∏â", type: "grade", isNew: true });
        }
        
        // 2. Ï†êÏàò Í¥ÄÎ†® Î±ÉÏßÄ (4Í∞ú)
        if (stats.bestScore >= 95) {
            badges.push({ icon: "üíé", text: "95Ï†ê Ïù¥ÏÉÅ", type: "score", isNew: true });
        }
        if (stats.avgScore >= 85) {
            badges.push({ icon: "üåü", text: "Í≥†ÎìùÏ†êÏûê", type: "score", isNew: false });
        }
        if (stats.bestScore >= 100) {
            badges.push({ icon: "üéØ", text: "ÎßåÏ†ê Îã¨ÏÑ±", type: "score", isNew: true });
        }
        if (stats.avgScore >= 90) {
            badges.push({ icon: "‚ú®", text: "Ïö∞ÏàòÌïú ÌèâÍ∑†", type: "score", isNew: false });
        }
        
        // 3. ÏÑ±Ï†Å Î≥ÄÌôî Î±ÉÏßÄ (3Í∞ú)
        if (maxConsecutiveUp >= 2) {
            badges.push({ icon: "üî•", text: "Ïó∞ÏÜç ÏÉÅÏäπ", type: "trend", isNew: true });
        }
        if (maxConsecutiveUp >= 3) {
            badges.push({ icon: "üöÄ", text: "3Ïó∞ÏÜç ÏÉÅÏäπ", type: "trend", isNew: true });
        }
        if (maxConsecutiveUp >= 4) {
            badges.push({ icon: "üå™Ô∏è", text: "4Ïó∞ÏÜç Ìè≠Ìíç ÏÉÅÏäπ", type: "trend", isNew: true });
        }
        
        // 4. Ï†êÏàò Í∞úÏÑ† Î±ÉÏßÄ (3Í∞ú) - ÏµúÍ∑º Î≥ÄÌôîÎüâ
        if (stats.scoreChange >= 15) {
            badges.push({ icon: "üìà", text: "ÎåÄÌè≠ ÏÉÅÏäπ", type: "improvement", isNew: true });
        }
        if (stats.scoreChange >= 25) {
            badges.push({ icon: "‚ö°", text: "Ìè≠Î∞úÏ†Å ÏÉÅÏäπ", type: "improvement", isNew: true });
        }
        if (stats.scoreChange >= 35) {
            badges.push({ icon: "üéÜ", text: "Í∏∞Ï†ÅÏùò ÏÉÅÏäπ", type: "improvement", isNew: true });
        }
        
        // 5. Ï∂úÏÑù Î∞è ÏÑ±Ïã§ÏÑ± Î±ÉÏßÄ (3Í∞ú)
        if (stats.testCount >= 5) {
            badges.push({ icon: "‚≠ê", text: "ÏÑ±Ïã§Ìïú ÏùëÏãú", type: "attendance", isNew: false });
        }
        if (stats.testCount >= 8) {
            badges.push({ icon: "üí™", text: "Íæ∏Ï§ÄÌïú ÎèÑÏ†Ñ", type: "attendance", isNew: false });
        }
        if (stats.testCount === stats.totalTests) {
            badges.push({ icon: "üèÖ", text: "ÏôÑÎ≤ΩÌïú Ï∂úÏÑù", type: "attendance", isNew: true });
        }
        
       
        
        // 7. ÏïàÏ†ïÏÑ± Î±ÉÏßÄ (2Í∞ú)
        if (scores.length >= 3) {
            var scoreVariance = calculateVariance(scores);
            if (scoreVariance < 50) {
                badges.push({ icon: "üõ°Ô∏è", text: "ÏïàÏ†ïÏ†Å ÏÑ±Ï∑®", type: "stability", isNew: false });
            }
            if (scoreVariance < 25) {
                badges.push({ icon: "üè∞", text: "ÏôÑÎ≤ΩÌïú ÏïàÏ†ï", type: "stability", isNew: true });
            }
        }
        
       // 1Îì±Í∏â ÎßàÏä§ÌÑ∞ Î±ÉÏßÄ (Îì±Í∏â Í¥ÄÎ†® Î±ÉÏßÄ ÏÑπÏÖòÏóê Ï∂îÍ∞Ä)
            var consecutiveGrade1 = 0;
            var maxConsecutiveGrade1 = 0;
            for (var i = 0; i < gradeValues.length; i++) {
                if (gradeValues[i] === 1) {
                    consecutiveGrade1++;
                    maxConsecutiveGrade1 = Math.max(maxConsecutiveGrade1, consecutiveGrade1);
                } else {
                    consecutiveGrade1 = 0;
                }
            }
            
            if (maxConsecutiveGrade1 >= 5) {
                badges.push({ icon: "üëë", text: "1Îì±Í∏â ÎßàÏä§ÌÑ∞", type: "grade", isNew: true });
            }
        
        // 9. ÌöåÎ≥µ/ÏÑ±Ïû• Î±ÉÏßÄ (2Í∞ú)
        if (maxConsecutiveDown >= 2 && consecutiveUp >= 2) {
            badges.push({ icon: "üîÑ", text: "Í∑πÏ†Å ÌöåÎ≥µ", type: "recovery", isNew: true });
        }
        if (scores.length >= 5 && scores[scores.length-1] > scores[0] + 20) {
            badges.push({ icon: "üìä", text: "Ïû•Í∏∞ ÏÑ±Ïû•", type: "recovery", isNew: false });
        }
        
        // ========== üÜï ÏÉàÎ°ú Ï∂îÍ∞ÄÎêú Î±ÉÏßÄÎì§ ==========
        
        // 10. Ìïú Î≤àÏùò ÌÅ∞ Ï†êÌîÑ Î±ÉÏßÄ (3Í∞ú)
        var maxSingleJump = 0;
        if (scores.length >= 2) {
            for (var i = 1; i < scores.length; i++) {
                var jump = scores[i] - scores[i-1];
                maxSingleJump = Math.max(maxSingleJump, jump);
            }
            
            // Ìïú Î≤àÏùò ÌÅ∞ Ï†êÌîÑ Î±ÉÏßÄ
            if (maxSingleJump >= 35) {
                badges.push({ icon: "üåà", text: "ÎÜÄÎùºÏö¥ Ï†êÌîÑ", type: "single-jump", isNew: true });
            }
            if (maxSingleJump >= 25) {
                badges.push({ icon: "üé¢", text: "ÌÅ∞ ÎèÑÏïΩ", type: "single-jump", isNew: false });
            }
            if (maxSingleJump >= 15) {
                badges.push({ icon: "üìç", text: "ÏÑ±Í≥µÏ†Å Ï†êÌîÑ", type: "single-jump", isNew: false });
            }
        }
        
        // 11. Ï†ÑÏ≤¥ ÏÑ±Ïû• Î±ÉÏßÄ (2Í∞ú)
        if (scores.length >= 3) {
            // Ïó≠Ï†Ñ Ïä§ÌÜ†Î¶¨ Î±ÉÏßÄ (ÌïúÎ≤à ÎßéÏù¥ Îñ®Ïñ¥Ï°åÎã§Í∞Ä Îã§Ïãú Ïò¨ÎùºÏò® Í≤ΩÏö∞)
            var minScore = Math.min(...scores);
            var maxScore = Math.max(...scores);
            var minIndex = scores.indexOf(minScore);
            var maxIndex = scores.lastIndexOf(maxScore);
            
            if (minIndex < maxIndex && (maxScore - minScore) >= 40) {
                badges.push({ icon: "üîÑ", text: "Ïó≠Ï†ÑÏùò Ïä§ÌÜ†Î¶¨", type: "total-growth", isNew: true });
            }
            
            // ÏïàÏ†ïÏ†Å ÏÉÅÏäπ (Ï†ÑÏ≤¥Ï†ÅÏúºÎ°ú Íæ∏Ï§ÄÌûà Ïò§Î¶Ñ)
            var upwardCount = 0;
            for (var i = 1; i < scores.length; i++) {
                if (scores[i] >= scores[i-1]) upwardCount++;
            }
            var upwardRatio = upwardCount / (scores.length - 1);
            
            var firstScore = scores[0];
            var lastScore = scores[scores.length - 1];
            var totalChange = lastScore - firstScore;
            
            if (upwardRatio >= 0.8 && totalChange >= 15) {
                badges.push({ icon: "üöÄ", text: "Íæ∏Ï§ÄÌïú ÏÉÅÏäπÏÑ∏", type: "total-growth", isNew: false });
            }
        }

           // 12. Í≥ºÎ™©Î≥Ñ ÎßàÏä§ÌÑ∞ Î±ÉÏßÄ (9Í∞ú + 3Í∞ú Ï¢ÖÌï©)
            var subjectMasters = [];
            
            var koreanSubjects = [
                'ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏', 'Î¨∏Î≤ï', 'ÎèÖÏÑú(Ïù∏Î¨∏)', 'ÎèÖÏÑú(ÏÇ¨Ìöå)', 'ÎèÖÏÑú(Í≥ºÌïô)',
                'Î¨∏Ìïô(ÌòÑÎåÄÏãú)', 'Î¨∏Ìïô(ÌòÑÎåÄÏÜåÏÑ§)', 'Î¨∏Ìïô(Í≥†Ï†ÑÏãúÍ∞Ä)', 'Î¨∏Ìïô(Í≥†Ï†ÑÏÜåÏÑ§)'
            ];
            
            koreanSubjects.forEach(function(targetSubject) {
                var subjectMapping = {
                    'ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏': ['ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏', 'ÌôîÎ≤ïÍ≥ºÏûëÎ¨∏', 'ÌôîÏûë'],
                    'Î¨∏Î≤ï': ['Î¨∏Î≤ï', 'Ïñ∏Ïñ¥ÏôÄ Îß§Ï≤¥', 'Ïñ∏Ïñ¥ÏôÄÎß§Ï≤¥', 'Ïñ∏Îß§'],
                    'ÎèÖÏÑú(Ïù∏Î¨∏)': ['ÎèÖÏÑú(Ïù∏Î¨∏)', 'ÎèÖÏÑúÏù∏Î¨∏', 'Ïù∏Î¨∏'],
                    'ÎèÖÏÑú(ÏÇ¨Ìöå)': ['ÎèÖÏÑú(ÏÇ¨Ìöå)', 'ÎèÖÏÑúÏÇ¨Ìöå', 'ÏÇ¨Ìöå'],
                    'ÎèÖÏÑú(Í≥ºÌïô)': ['ÎèÖÏÑú(Í≥ºÌïô)', 'ÎèÖÏÑúÍ≥ºÌïô', 'Í≥ºÌïô'],
                    'Î¨∏Ìïô(ÌòÑÎåÄÏãú)': ['Î¨∏Ìïô(ÌòÑÎåÄÏãú)', 'Î¨∏ÌïôÌòÑÎåÄÏãú', 'ÌòÑÎåÄÏãú', 'ÌòÑÏãú'],
                    'Î¨∏Ìïô(ÌòÑÎåÄÏÜåÏÑ§)': ['Î¨∏Ìïô(ÌòÑÎåÄÏÜåÏÑ§)', 'Î¨∏ÌïôÌòÑÎåÄÏÜåÏÑ§', 'ÌòÑÎåÄÏÜåÏÑ§', 'ÌòÑÏÜå'],
                    'Î¨∏Ìïô(Í≥†Ï†ÑÏãúÍ∞Ä)': ['Î¨∏Ìïô(Í≥†Ï†ÑÏãúÍ∞Ä)', 'Î¨∏ÌïôÍ≥†Ï†ÑÏãúÍ∞Ä', 'Í≥†Ï†ÑÏãúÍ∞Ä', 'Í≥†Ïãú'],
                    'Î¨∏Ìïô(Í≥†Ï†ÑÏÜåÏÑ§)': ['Î¨∏Ìïô(Í≥†Ï†ÑÏÜåÏÑ§)', 'Î¨∏ÌïôÍ≥†Ï†ÑÏÜåÏÑ§', 'Í≥†Ï†ÑÏÜåÏÑ§', 'Í≥†ÏÜå']
                };
                
                var possibleNames = subjectMapping[targetSubject] || [targetSubject];
                var matchedSubject = null;
                
                for (var actualSubject in subjectRatios) {
                    for (var i = 0; i < possibleNames.length; i++) {
                        if (actualSubject === possibleNames[i] || 
                            actualSubject.includes(possibleNames[i]) || 
                            possibleNames[i].includes(actualSubject)) {
                            matchedSubject = actualSubject;
                            break;
                        }
                    }
                    if (matchedSubject) break;
                }
                
                if (matchedSubject && subjectRatios[matchedSubject]) {
                var ratios = subjectRatios[matchedSubject];
                
                // Ï†ÑÏ≤¥ ÏãúÌóò Ï§ë Ïó∞ÏÜçÎêú 4Ìöå 100% Îã¨ÏÑ± Ïó¨Î∂Ä Ï≤¥ÌÅ¨
                var hasConsecutive4Perfect = false;
                
                if (ratios.length >= 4) {
                    for (var i = 0; i <= ratios.length - 4; i++) {
                        var consecutive4 = ratios.slice(i, i + 4);
                        if (consecutive4.every(ratio => ratio >= 100)) {
                            hasConsecutive4Perfect = true;
                            break;
                        }
                    }
                }
                
                if (hasConsecutive4Perfect) {
                    badges.push({ 
                        icon: "üèÜ", 
                        text: targetSubject + " ÎßàÏä§ÌÑ∞", 
                        type: "subject-master", 
                        isNew: true 
                    });
                    subjectMasters.push(targetSubject);
                }
            }
            });
            
            // 13. Ï¢ÖÌï© Î±ÉÏßÄ (3Í∞ú)
            if (subjectMasters.length >= 3) {
                badges.push({ icon: "üéì", text: "Íµ≠Ïñ¥ Ïò¨ÎùºÏö¥Îçî", type: "subject-master", isNew: true });
            }
            if (subjectMasters.length >= 5) {
                badges.push({ icon: "üìö", text: "Íµ≠Ïñ¥ ÎßàÏóêÏä§Ìä∏Î°ú", type: "subject-master", isNew: true });
            }
            if (subjectMasters.length >= 9) {
                badges.push({ icon: "üëë", text: "Íµ≠Ïñ¥ Î†àÏ†ÑÎçîÎ¶¨", type: "subject-master", isNew: true });
            }
            
            // 
            return badges;
        }

        // Î±ÉÏßÄ ÏÑ§Î™Ö Îç∞Ïù¥ÌÑ∞
        var badgeDescriptions = {
            // Îì±Í∏â Í¥ÄÎ†® Î±ÉÏßÄ
            "1Îì±Í∏â Îã¨ÏÑ±": "Íµ≠Ïñ¥ Î™®ÏùòÍ≥†ÏÇ¨ÏóêÏÑú ÏµúÍ≥† Îì±Í∏âÏù∏ 1Îì±Í∏âÏùÑ Îã¨ÏÑ±ÌñàÏäµÎãàÎã§! ÏÉÅÏúÑ 4% ÏïàÏóê ÎìúÎäî Îõ∞Ïñ¥ÎÇú ÏÑ±Ï∑®ÏûÖÎãàÎã§.",
            "ÏÉÅÏúÑÎì±Í∏â Îã¨ÏÑ±": "2Îì±Í∏â Ïù¥ÏÉÅÏùò ÏÉÅÏúÑ Îì±Í∏âÏùÑ Îã¨ÏÑ±ÌñàÏäµÎãàÎã§. Íæ∏Ï§ÄÌïú ÎÖ∏Î†•Ïùò Í≤∞Í≥ºÏûÖÎãàÎã§!",
            "3Îì±Í∏â Ïù¥ÎÇ¥": "3Îì±Í∏â Ïù¥ÎÇ¥Ïùò Ï§ÄÏàòÌïú ÏÑ±Ï†ÅÏùÑ Í∏∞Î°ùÌñàÏäµÎãàÎã§. ÏÉÅÏúÑÍ∂å ÏßÑÏûÖÏùò Î∞úÌåêÏù¥ ÎêòÏóàÎÑ§Ïöî!",
            "Ïö∞ÏàòÌïú Îì±Í∏â": "ÌèâÍ∑† 2.5Îì±Í∏â Ïù¥ÏÉÅÏùò Ïö∞ÏàòÌïú ÏÑ±Ï†ÅÏùÑ Ïú†ÏßÄÌïòÍ≥† ÏûàÏäµÎãàÎã§.",
            "ÏµúÏÉÅÏúÑ Îì±Í∏â": "ÌèâÍ∑† 1.5Îì±Í∏â Ïù¥ÏÉÅ! ÏµúÏÉÅÏúÑÍ∂å ÌïôÏÉùÏùò Ï¶ùÍ±∞ÏûÖÎãàÎã§.",
            
            // Ï†êÏàò Í¥ÄÎ†® Î±ÉÏßÄ
            "95Ï†ê Ïù¥ÏÉÅ": "95Ï†ê Ïù¥ÏÉÅÏùò Í≥†ÎìùÏ†êÏùÑ Îã¨ÏÑ±ÌñàÏäµÎãàÎã§! Í±∞Ïùò ÎßåÏ†êÏóê Í∞ÄÍπåÏö¥ Ïã§Î†•Ïù¥ÎÑ§Ïöî.",
            "Í≥†ÎìùÏ†êÏûê": "ÌèâÍ∑† 85Ï†ê Ïù¥ÏÉÅÏùò ÏïàÏ†ïÏ†ÅÏù∏ Í≥†ÎìùÏ†êÏùÑ Ïú†ÏßÄÌïòÍ≥† ÏûàÏäµÎãàÎã§.",
            "ÎßåÏ†ê Îã¨ÏÑ±": "100Ï†ê ÎßåÏ†êÏùÑ Îã¨ÏÑ±ÌñàÏäµÎãàÎã§! ÏôÑÎ≤ΩÌïú Ïã§Î†•ÏùÑ Î≥¥Ïó¨Ï£ºÏóàÎÑ§Ïöî.",
            "Ïö∞ÏàòÌïú ÌèâÍ∑†": "ÌèâÍ∑† 90Ï†ê Ïù¥ÏÉÅÏùò Îõ∞Ïñ¥ÎÇú Ïã§Î†•ÏùÑ Î≥¥Ïó¨Ï£ºÍ≥† ÏûàÏäµÎãàÎã§.",
            
            // ÏÑ±Ï†Å Î≥ÄÌôî Î±ÉÏßÄ
            "Ïó∞ÏÜç ÏÉÅÏäπ": "2Ìöå Ïó∞ÏÜçÏúºÎ°ú ÏÑ±Ï†ÅÏù¥ ÏÉÅÏäπÌñàÏäµÎãàÎã§. Íæ∏Ï§ÄÌïú Î∞úÏ†ÑÏù¥ ÎèãÎ≥¥ÏûÖÎãàÎã§!",
            "3Ïó∞ÏÜç ÏÉÅÏäπ": "3Ìöå Ïó∞ÏÜç ÏÉÅÏäπ! ÏßÄÏÜçÏ†ÅÏù∏ ÏÑ±Ïû• Í≥°ÏÑ†ÏùÑ Í∑∏Î¶¨Í≥† ÏûàÏäµÎãàÎã§.",
            "4Ïó∞ÏÜç Ìè≠Ìíç ÏÉÅÏäπ": "4Ìöå Ïó∞ÏÜç ÏÉÅÏäπÏùò ÎÜÄÎùºÏö¥ Í∏∞Î°ù! Î©àÏ∂ú Ïàò ÏóÜÎäî ÏÉÅÏäπÏÑ∏ÏûÖÎãàÎã§.",
            
            // Ï†êÏàò Í∞úÏÑ† Î±ÉÏßÄ
            "ÎåÄÌè≠ ÏÉÅÏäπ": "Ïù¥Ï†Ñ ÏãúÌóò ÎåÄÎπÑ 15Ï†ê Ïù¥ÏÉÅ ÏÉÅÏäπÌñàÏäµÎãàÎã§. ÌÅ∞ Î∞úÏ†ÑÏù¥ÎÑ§Ïöî!",
            "Ìè≠Î∞úÏ†Å ÏÉÅÏäπ": "25Ï†ê Ïù¥ÏÉÅÏùò Ìè≠Î∞úÏ†ÅÏù∏ ÏÉÅÏäπÏùÑ Í∏∞Î°ùÌñàÏäµÎãàÎã§!",
            "Í∏∞Ï†ÅÏùò ÏÉÅÏäπ": "35Ï†ê Ïù¥ÏÉÅÏùò Í∏∞Ï†Å Í∞ôÏùÄ ÏÉÅÏäπ! ÎÜÄÎùºÏö¥ Î∞úÏ†ÑÏûÖÎãàÎã§.",
            
            // Ï∂úÏÑù Î∞è ÏÑ±Ïã§ÏÑ± Î±ÉÏßÄ
            "ÏÑ±Ïã§Ìïú ÏùëÏãú": "5Ìöå Ïù¥ÏÉÅÏùò Î™®ÏùòÍ≥†ÏÇ¨Ïóê ÏÑ±Ïã§ÌïòÍ≤å Ï∞∏Ïó¨ÌñàÏäµÎãàÎã§.",
            "Íæ∏Ï§ÄÌïú ÎèÑÏ†Ñ": "8Ìöå Ïù¥ÏÉÅ Íæ∏Ï§ÄÌûà Î™®ÏùòÍ≥†ÏÇ¨Ïóê ÎèÑÏ†ÑÌïòÎäî ÏÑ±Ïã§Ìï®ÏùÑ Î≥¥ÏòÄÏäµÎãàÎã§.",
            "ÏôÑÎ≤ΩÌïú Ï∂úÏÑù": "Î™®Îì† Î™®ÏùòÍ≥†ÏÇ¨Ïóê Îπ†ÏßêÏóÜÏù¥ Ï∞∏Ïó¨ÌñàÏäµÎãàÎã§. ÏÑ±Ïã§ÏÑ±Ïùò ÏÉÅÏßï!",
            
                       
            // ÏïàÏ†ïÏÑ± Î±ÉÏßÄ
            "ÏïàÏ†ïÏ†Å ÏÑ±Ï∑®": "ÏÑ±Ï†ÅÏùò Ìé∏Ï∞®Í∞Ä Ï†ÅÏñ¥ ÏïàÏ†ïÏ†ÅÏù∏ Ïã§Î†•ÏùÑ Î≥¥Ïó¨Ï£ºÍ≥† ÏûàÏäµÎãàÎã§.",
            "ÏôÑÎ≤ΩÌïú ÏïàÏ†ï": "Îß§Ïö∞ ÏïàÏ†ïÏ†ÅÏù∏ ÏÑ±Ï†Å Ïú†ÏßÄ! Ïã§Î†•Ïù¥ ÌôïÍ≥†Ìûà ÏûêÎ¶¨Ïû°ÏïòÏäµÎãàÎã§.",
            
           // Îì±Í∏â Í¥ÄÎ†® Î±ÉÏßÄ ÏÑπÏÖòÏóê Ï∂îÍ∞Ä
            "1Îì±Í∏â ÎßàÏä§ÌÑ∞": "1Îì±Í∏âÏùÑ 5Ìöå Ïó∞ÏÜçÏúºÎ°ú Îã¨ÏÑ±Ìïú ÏßÑÏ†ïÌïú ÏµúÏÉÅÏúÑÍ∂å ÌïôÏÉùÏûÖÎãàÎã§! Íæ∏Ï§ÄÌï®Í≥º Ïã§Î†•ÏùÑ Î™®Îëê Í∞ñÏ∂ò ÎßàÏä§ÌÑ∞ÏûÖÎãàÎã§.",
            
            // ÌöåÎ≥µ/ÏÑ±Ïû• Î±ÉÏßÄ
            "Í∑πÏ†Å ÌöåÎ≥µ": "Ïó∞ÏÜç ÌïòÎùΩ ÌõÑ Í∑πÏ†ÅÏúºÎ°ú ÌöåÎ≥µÌïú ÎìúÎùºÎßàÌã±Ìïú Ïä§ÌÜ†Î¶¨Î•º ÎßåÎì§ÏóàÏäµÎãàÎã§!",
            "Ïû•Í∏∞ ÏÑ±Ïû•": "Ïû•Í∏∞Í∞ÑÏóê Í±∏Ï≥ê 20Ï†ê Ïù¥ÏÉÅÏùò Íæ∏Ï§ÄÌïú ÏÑ±Ïû•ÏùÑ Î≥¥ÏòÄÏäµÎãàÎã§.",
            
            // ÌïúÎ≤àÏùò ÌÅ∞ Ï†êÌîÑ Î±ÉÏßÄ
            "ÎÜÄÎùºÏö¥ Ï†êÌîÑ": "Ìïú Î≤àÏóê 35Ï†ê Ïù¥ÏÉÅÏùò ÎÜÄÎùºÏö¥ Ï†êÏàò Ìñ•ÏÉÅÏùÑ Ïù¥Î§òÏäµÎãàÎã§!",
            "ÌÅ∞ ÎèÑÏïΩ": "25Ï†ê Ïù¥ÏÉÅÏùò ÌÅ∞ ÎèÑÏïΩÏùÑ Ìï¥ÎÉàÏäµÎãàÎã§!",
            "ÏÑ±Í≥µÏ†Å Ï†êÌîÑ": "15Ï†ê Ïù¥ÏÉÅÏùò ÏÑ±Í≥µÏ†ÅÏù∏ Ï†êÏàò Ìñ•ÏÉÅÏùÑ Í∏∞Î°ùÌñàÏäµÎãàÎã§.",
            
            // Ï†ÑÏ≤¥ ÏÑ±Ïû• Î±ÉÏßÄ
            "Ïó≠Ï†ÑÏùò Ïä§ÌÜ†Î¶¨": "ÏµúÏ†ÄÏ†êÏóêÏÑú ÏµúÍ≥†Ï†êÍπåÏßÄ, Í∞êÎèôÏ†ÅÏù∏ Ïó≠Ï†Ñ ÎìúÎùºÎßàÎ•º Ïç®ÎÉàÏäµÎãàÎã§!",
            "Íæ∏Ï§ÄÌïú ÏÉÅÏäπÏÑ∏": "Ï†ÑÏ≤¥Ï†ÅÏúºÎ°ú Íæ∏Ï§ÄÌïú ÏÉÅÏäπÏÑ∏Î•º Î≥¥Ïù¥Î©∞ ÏÑ±Ïû•ÌïòÍ≥† ÏûàÏäµÎãàÎã§.",
            
            // Í≥ºÎ™©Î≥Ñ ÎßàÏä§ÌÑ∞ Î±ÉÏßÄ
            "ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏ ÎßàÏä§ÌÑ∞": "ÌôîÎ≤ïÍ≥º ÏûëÎ¨∏ ÏòÅÏó≠ÏóêÏÑú ÏµúÍ∑º 4Ìöå Ïó∞ÏÜç ÎßåÏ†ê! ÏôÑÎ≤ΩÌïú ÎßàÏä§ÌÑ∞ÏûÖÎãàÎã§.",
            "Î¨∏Î≤ï ÎßàÏä§ÌÑ∞": "Î¨∏Î≤ï ÏòÅÏó≠ ÏµúÍ∑º 4Ìöå Ïó∞ÏÜç ÎßåÏ†ê! Ïñ∏Ïñ¥ Í∑úÏπôÏùÑ ÏôÑÎ≤ΩÌûà ÏäµÎìùÌñàÏäµÎãàÎã§.",
            "ÎèÖÏÑú(Ïù∏Î¨∏) ÎßàÏä§ÌÑ∞": "Ïù∏Î¨∏ ÎèÖÏÑú ÏòÅÏó≠ ÏµúÍ∑º 4Ìöå Ïó∞ÏÜç ÎßåÏ†ê! Ïù∏Î¨∏ÌïôÏ†Å ÏÇ¨Í≥†Î†•Ïù¥ Îõ∞Ïñ¥ÎÇ©ÎãàÎã§.",
            "ÎèÖÏÑú(ÏÇ¨Ìöå) ÎßàÏä§ÌÑ∞": "ÏÇ¨Ìöå ÎèÖÏÑú ÏòÅÏó≠ ÏµúÍ∑º 4Ìöå Ïó∞ÏÜç ÎßåÏ†ê! ÏÇ¨Ìöå ÌòÑÏÉÅ Ïù¥Ìï¥Î†•Ïù¥ Ïö∞ÏàòÌï©ÎãàÎã§.",
            "ÎèÖÏÑú(Í≥ºÌïô) ÎßàÏä§ÌÑ∞": "Í≥ºÌïô ÎèÖÏÑú ÏòÅÏó≠ ÏµúÍ∑º 4Ìöå Ïó∞ÏÜç ÎßåÏ†ê! Í≥ºÌïôÏ†Å ÏÇ¨Í≥†Î†•Ïù¥ ÌÉÅÏõîÌï©ÎãàÎã§.",
            "Î¨∏Ìïô(ÌòÑÎåÄÏãú) ÎßàÏä§ÌÑ∞": "ÌòÑÎåÄÏãú ÏòÅÏó≠ ÏµúÍ∑º 4Ìöå Ïó∞ÏÜç ÎßåÏ†ê! ÏãúÏ†Å Í∞êÏàòÏÑ±Ïù¥ Îõ∞Ïñ¥ÎÇ©ÎãàÎã§.",
            "Î¨∏Ìïô(ÌòÑÎåÄÏÜåÏÑ§) ÎßàÏä§ÌÑ∞": "ÌòÑÎåÄÏÜåÏÑ§ ÏòÅÏó≠ ÏµúÍ∑º 4Ìöå Ïó∞ÏÜç ÎßåÏ†ê! ÏÑúÏÇ¨ Ïù¥Ìï¥Î†•Ïù¥ ÏôÑÎ≤ΩÌï©ÎãàÎã§.",
            "Î¨∏Ìïô(Í≥†Ï†ÑÏãúÍ∞Ä) ÎßàÏä§ÌÑ∞": "Í≥†Ï†ÑÏãúÍ∞Ä ÏòÅÏó≠ ÏµúÍ∑º 4Ìöå Ïó∞ÏÜç ÎßåÏ†ê! Í≥†Ï†Ñ Î¨∏ÌïôÏùò ÏßÑÏàòÎ•º Ïù¥Ìï¥ÌñàÏäµÎãàÎã§.",
            "Î¨∏Ìïô(Í≥†Ï†ÑÏÜåÏÑ§) ÎßàÏä§ÌÑ∞": "Í≥†Ï†ÑÏÜåÏÑ§ ÏòÅÏó≠ ÏµúÍ∑º 4Ìöå Ïó∞ÏÜç ÎßåÏ†ê! Í≥†Ï†Ñ ÏÑúÏÇ¨Ïùò ÎåÄÍ∞ÄÏûÖÎãàÎã§.",
            
            // Ï¢ÖÌï© Î±ÉÏßÄ
            "Íµ≠Ïñ¥ Ïò¨ÎùºÏö¥Îçî": "3Í∞ú Ïù¥ÏÉÅÏùò Í≥ºÎ™©ÏóêÏÑú ÎßàÏä§ÌÑ∞ Îã¨ÏÑ±! Íµ≠Ïñ¥Ïùò Îã§ÏñëÌïú ÏòÅÏó≠Ïóê Îä•ÌÜµÌï©ÎãàÎã§.",
            "Íµ≠Ïñ¥ ÎßàÏóêÏä§Ìä∏Î°ú": "5Í∞ú Ïù¥ÏÉÅÏùò Í≥ºÎ™©ÏóêÏÑú ÎßàÏä§ÌÑ∞ Îã¨ÏÑ±! Íµ≠Ïñ¥ Ïã§Î†•Ïù¥ ÎåÄÍ∞Ä ÏàòÏ§ÄÏûÖÎãàÎã§.",
            "Íµ≠Ïñ¥ Î†àÏ†ÑÎçîÎ¶¨": "Î™®Îì† 9Í∞ú Í≥ºÎ™©ÏóêÏÑú ÎßàÏä§ÌÑ∞ Îã¨ÏÑ±! Íµ≠Ïñ¥Í≥ÑÏùò Ï†ÑÏÑ§Ïù¥ ÎêòÏóàÏäµÎãàÎã§!"
        };
        
        // Ìà¥ÌåÅ Í¥ÄÎ¶¨ Î≥ÄÏàò
        var currentTooltip = null;
        var tooltipTimeout = null;
        
        // Î±ÉÏßÄ Ìà¥ÌåÅ ÌëúÏãú Ìï®Ïàò
        function showBadgeTooltip(event, badgeText) {
            console.log('Ìà¥ÌåÅ ÌëúÏãú ÏãúÎèÑ:', badgeText);
            
            // Í∏∞Ï°¥ Ìà¥ÌåÅ Ï†úÍ±∞
            hideBadgeTooltip();
            
            var description = badgeDescriptions[badgeText];
            if (!description) {
                console.log('ÏÑ§Î™ÖÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå:', badgeText);
                return;
            }
            
            console.log('Ìà¥ÌåÅ ÏÉùÏÑ± Ï§ë:', description);
            
            // Ìà¥ÌåÅ ÏÉùÏÑ±
            var tooltip = document.createElement('div');
            tooltip.className = 'badge-tooltip';
            tooltip.innerHTML = '<strong>' + badgeText + '</strong><br>' + description;
            document.body.appendChild(tooltip);
            
            // Î™®Î∞îÏùº Ï≤¥ÌÅ¨
            var isMobile = window.innerWidth <= 768;
            console.log('isMobile:', isMobile);
            

            // Í∞ÑÎã®Ìïú ÏúÑÏπò ÏÑ§Ï†ï
            var rect = event.target.getBoundingClientRect();
            tooltip.style.left = (rect.left + rect.width / 2) + 'px';
            tooltip.style.top = (rect.top - 10) + 'px';
            tooltip.style.transform = 'translateX(-50%) translateY(-100%)';
            
            // Ïï†ÎãàÎ©îÏù¥ÏÖòÏúºÎ°ú ÌëúÏãú
            requestAnimationFrame(function() {
                tooltip.classList.add('visible');
            });
            
            currentTooltip = tooltip;
            
            // Î™®Î∞îÏùºÏóêÏÑúÎäî 3Ï¥à ÌõÑ ÏûêÎèô Ïà®ÍπÄ
            if (isMobile) {
                tooltipTimeout = setTimeout(hideBadgeTooltip, 3000);
            }
            
            console.log('Ìà¥ÌåÅ ÌëúÏãú ÏôÑÎ£å');
        }
        
        // Î±ÉÏßÄ Ìà¥ÌåÅ Ïà®ÍπÄ Ìï®Ïàò
        function hideBadgeTooltip() {
            if (currentTooltip) {
                currentTooltip.classList.remove('visible');
                setTimeout(function() {
                    if (currentTooltip && currentTooltip.parentNode) {
                        currentTooltip.parentNode.removeChild(currentTooltip);
                    }
                    currentTooltip = null;
                }, 300);
            }
            
            if (tooltipTimeout) {
                clearTimeout(tooltipTimeout);
                tooltipTimeout = null;
            }
        }
        
        // Î±ÉÏßÄÏóê Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞ÄÌïòÎäî Ìï®Ïàò
        function addBadgeTooltipEvents() {
            var badges = document.querySelectorAll('.achievement-badge');
            console.log('Î±ÉÏßÄ Ìà¥ÌåÅ Ïù¥Î≤§Ìä∏ ÏÑ§Ï†ï Ï§ë... Î∞úÍ≤¨Îêú Î±ÉÏßÄ Ïàò:', badges.length);
            
            badges.forEach(function(badge, index) {
                // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†úÍ±∞
                badge.removeEventListener('mouseenter', badge._mouseenterHandler);
                badge.removeEventListener('mouseleave', badge._mouseleaveHandler);
                badge.removeEventListener('click', badge._clickHandler);
                
                var badgeText = badge.textContent
                .replace('NEW!', '')
                .replace(/[\n\r\t]/g, ' ')  // Ï§ÑÎ∞îÍøà, ÌÉ≠ Î¨∏ÏûêÎ•º Í≥µÎ∞±ÏúºÎ°ú Î≥ÄÍ≤Ω
                .replace(/\s+/g, ' ')       // Ïó∞ÏÜçÎêú Í≥µÎ∞±ÏùÑ ÌïòÎÇòÎ°ú ÌÜµÌï©
                .replace(/[\u{1F000}-\u{1F9FF}]/gu, '') // Î™®Îì† Ïù¥Î™®ÏßÄ Ï†úÍ±∞ (Ïú†ÎãàÏΩîÎìú Î≤îÏúÑ)
                .replace(/[\u{2600}-\u{26FF}]/gu, '') // Í∏∞ÌÉÄ Ïã¨Î≥º Ï†úÍ±∞
                .replace(/[\u{2700}-\u{27BF}]/gu, '') // Dingbats Ï†úÍ±∞
                .trim();                    // ÏïûÎí§ Í≥µÎ∞± Ï†úÍ±∞
                console.log('Î±ÉÏßÄ ÏÑ§Ï†ï:', index, badgeText);
                
                                
                // Î™®Î∞îÏùº: ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
                badge._clickHandler = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Î±ÉÏßÄ ÌÅ¥Î¶≠:', badgeText);
                
                if (currentTooltip) {
                    hideBadgeTooltip();
                } else {
                    showBadgeTooltip(e, badgeText);
                }
            };
                
               badge.addEventListener('click', badge._clickHandler);
            });
        }
        
        // Ï†ÑÏó≠ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏Î°ú Ìà¥ÌåÅ Ïà®ÍπÄ (Î™®Î∞îÏùº)
        document.addEventListener('click', function(e) {
            // Î±ÉÏßÄÎÇò Ìà¥ÌåÅÏùÑ ÌÅ¥Î¶≠Ìïú Í≤ΩÏö∞Í∞Ä ÏïÑÎãàÎùºÎ©¥ Ìà¥ÌåÅ Ïà®ÍπÄ
            if (currentTooltip && 
                !e.target.classList.contains('achievement-badge') && 
                !e.target.closest('.achievement-badge') &&
                !e.target.closest('.badge-tooltip')) {
                hideBadgeTooltip();
            }
        });
        
        // üìÖ D-day Í≥ÑÏÇ∞
        function calculateDday() {
            var today = new Date();
            
            // Í≥†2/Í≥†3 Íµ¨Î∂Ñ (ÌéòÏù¥ÏßÄ Ï†úÎ™©ÏúºÎ°ú ÌåêÎã®)
            var isGrade3 = document.title.includes('Í≥†3');
            
            var examDate;
            if (isGrade3) {
                examDate = new Date('2025-11-13'); // Í≥†3: 25ÎÖÑ 11.13.(Î™©)
            } else {
                examDate = new Date('2026-11-19'); // Í≥†2: 26ÎÖÑ 11.19.(Î™©)
            }
            
            var diffTime = examDate - today;
            var diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            return {
                days: diffDays,
                examDate: examDate,
                isGrade3: isGrade3
            };
        }
        
        // üìà ÏÑ±Ï†Å Í∑∏ÎûòÌîÑ ÏÉùÏÑ±
        function createGradeChart(student) {
            var grades = student.grades;
            var gradeKeys = Object.keys(grades);
            
            if (gradeKeys.length < 2) return null;
            
            var labels = [];
            var scoreData = [];
            var gradeData = [];
            
            gradeKeys.forEach(function(testName) {
                var gradeInfo = grades[testName];
                labels.push(testName);
                scoreData.push(gradeInfo.score || 0);
                gradeData.push(gradeInfo.grade || 9);
            });
            
            return {
                labels: labels,
                datasets: [
                    {
                        label: 'Ï†êÏàò',
                        data: scoreData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y'
                    },
                    {
                        label: 'Îì±Í∏â',
                        data: gradeData,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y1'
                    }
                ]
            };
        }
        // ÌÜµÌï© ÎåÄÏãúÎ≥¥Îìú ÌëúÏãú Ìï®Ïàò
function displayDashboard(student) {
    var stats = calculateStatistics(student);
    var badges = generateAchievementBadges(student, stats);
    var dday = calculateDday();
    
    if (!stats) return '';
    
    var changeIcon = stats.scoreChange > 0 ? 'üìà' : stats.scoreChange < 0 ? 'üìâ' : '‚û°Ô∏è';
    var changeClass = stats.scoreChange > 0 ? 'stat-positive' : stats.scoreChange < 0 ? 'stat-negative' : 'stat-neutral';
    var changeText = stats.scoreChange > 0 ? '+' + stats.scoreChange : stats.scoreChange;
    
    return `
        <!-- D-day Ïπ¥Ïö¥ÌÑ∞ -->
        <div class="dday-counter">
            <div class="dday-text">${dday.isGrade3 ? 'üéØ ÏàòÎä•' : 'üìö ÏàòÎä•'}ÍπåÏßÄ</div>
            <div class="dday-number">D-${dday.days}</div>
            <div style="font-size: 1em; opacity: 0.9;">
                ${dday.examDate.toLocaleDateString('ko-KR', {year: 'numeric', month: 'long', day: 'numeric', weekday: 'long'})}
            </div>
        </div>
        
        <div class="dashboard-grid">
            <!-- üìä ÌÜµÍ≥Ñ ÎåÄÏãúÎ≥¥Îìú -->
            <div class="dashboard-card">
                <h3>üìä ÏÑ±Ï†Å ÌÜµÍ≥Ñ</h3>
                <div class="stat-item">
                    <span class="stat-label">ÌèâÍ∑† Ï†êÏàò</span>
                    <span class="stat-value">${stats.avgScore}Ï†ê</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ÌèâÍ∑† Îì±Í∏â</span>
                    <span class="stat-value">${stats.avgGrade}Îì±Í∏â</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ÏµúÍ≥† ÏÑ±Ï†Å</span>
                    <span class="stat-value">${stats.bestGrade}Îì±Í∏â ${stats.bestScore}Ï†ê</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ÏµúÍ∑º Î≥ÄÌôî</span>
                    <span class="stat-value ${changeClass}">${changeIcon} ${changeText}Ï†ê</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ÏòàÏÉÅ ÏàúÏúÑ</span>
                    <span class="stat-value">ÏÉÅÏúÑ ${stats.percentile}%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ÏùëÏãúÏú®</span>
                    <span class="stat-value">${Math.round(stats.testCount/stats.totalTests*100)}% (${stats.testCount}/${stats.totalTests}Ìöå)</span>
                </div>
            </div>
            
            <!-- üèÜ ÏÑ±Ï∑® Î±ÉÏßÄ -->
            <div class="dashboard-card">
                <h3>üèÜ ÏÑ±Ï∑® Î±ÉÏßÄ <span style="font-size: 0.8em; color: #667eea;">(${badges.length}/40Í∞ú ÌöçÎìù)</span></h3>
                
                ${badges.length >= 25 ? 
                `<div style="
                    background: linear-gradient(135deg, #ffd700, #ff8c00); 
                    color: white; 
                    border-radius: 15px; 
                    padding: 20px; 
                    margin: 15px 0; 
                    text-align: center; 
                    box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
                    animation: grand-master-glow 2s infinite alternate;
                ">
                    <div style="font-size: 2em; margin-bottom: 10px;">üéäüëëüéä</div>
                    <div style="font-size: 1.3em; font-weight: bold; margin-bottom: 10px;">
                        Ï∂ïÌïòÌï©ÎãàÎã§! 25Í∞ú Ïù¥ÏÉÅÏùò Î±ÉÏßÄÎ•º Î™®ÏïÑ<br>
                        Íµ≠Ïñ¥ Í∑∏ÎûúÎìú ÎßàÏä§ÌÑ∞Í∞Ä ÎêòÏóàÏäµÎãàÎã§! üèÜ
                    </div>
                    <div style="font-size: 1.1em; opacity: 0.95;">
                        Ïù¥ÎåÄÍ±¥TÏóêÍ≤å Í∞ÄÏÑú ÏÑ†Î¨ºÏùÑ ÏàòÎ†πÌïòÏÑ∏Ïöî! üéÅ
                    </div>
                </div>` : 
                ''
                }
                
                ${badges.length > 0 ? 
                    '<div class="badge-summary">Ï¥ù ' + badges.length + '/40Í∞úÏùò Î±ÉÏßÄÎ•º ÌöçÎìùÌñàÏäµÎãàÎã§!' + 
                    (badges.length >= 35 ? ' üî• ÏÇ¨ÎûëÌïúÎã§ Ï†úÏûêÏïº. Í≥†ÏÉùÎßéÏïòÏñ¥.!' : 
                     badges.length >= 30 ? ' üåü Í±∞Ïùò Îã§ Î™®ÏïòÏñ¥Ïöî!' : 
                     badges.length >= 25 ? ' üéâ Íµ≠Ïñ¥ Í∑∏ÎûúÎìú ÎßàÏä§ÌÑ∞ Îã¨ÏÑ±!' : 
                     badges.length >= 15 ? ' üí™ ÎßéÏù¥ Î™®ÏïòÎÑ§Ïöî!' : '') + '</div>' +
                        '<div class="badge-container">' +
                        badges.map(badge => 
                           `<div class="achievement-badge ${badge.type} ${badge.isNew ? 'badge-new' : ''}">
                                <span>${badge.icon}</span>
                                <span>${badge.text}</span>
                                ${badge.isNew ? '<span style="font-size: 0.7em;">NEW!</span>' : ''}
                            </div>`
                        ).join('') +
                        '</div>' :
                    '<p style="color: #666; text-align: center; padding: 20px;">Îçî ÎßéÏùÄ ÏãúÌóòÏùÑ ÏπòÎ•¥Î©¥ Î±ÉÏßÄÎ•º ÌöçÎìùÌï† Ïàò ÏûàÏñ¥Ïöî!</p>'
                    }
                    
                    <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px; font-size: 0.85em; text-align: center;">
                        üí° <strong>PC:</strong> Î±ÉÏßÄÎ•º ÌÅ¥Î¶≠ÌïòÎ©¥ ÏÑ§Î™ÖÏùÑ Î≥º Ïàò ÏûàÏñ¥Ïöî!<br>
                        üì± <strong>Î™®Î∞îÏùº:</strong> Î±ÉÏßÄÎ•º ÌÑ∞ÏπòÌïòÎ©¥ ÏÑ§Î™ÖÏù¥ ÎÇòÌÉÄÎÇ©ÎãàÎã§!
                    </div>
            </div>
            
            <!-- üìà ÏÑ±Ï†Å Î≥ÄÌôî Í∑∏ÎûòÌîÑ -->
            <div class="dashboard-card">
                <h3>üìà ÏÑ±Ï†Å Î≥ÄÌôî Ï∂îÏù¥</h3>
                <div class="chart-container">
                    <canvas id="gradeChart_${student.attendanceNumber}"></canvas>
                </div>
            </div>
        </div>
    `;
}
        
        // Chart.js Í∑∏ÎûòÌîÑ ÏÉùÏÑ±
        function createChart(student) {
            var chartData = createGradeChart(student);
            if (!chartData) return;
            
            var ctx = document.getElementById('gradeChart_' + student.attendanceNumber);
            if (!ctx) return;
            
            new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Ï†êÏàò'
                            },
                            min: 0,
                            max: 100
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Îì±Í∏â'
                            },
                            min: 1,
                            max: 9,
                            reverse: true,
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }
        
       // üñ®Ô∏è PDF Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± Í∏∞Îä• (Ïä§ÌÅ¨Î°§ ÌÖåÏù¥Î∏î Ìè¨Ìï® Î≤ÑÏ†Ñ)
        async function generatePdfReport(studentName) {
            const reportElement = document.getElementById('results');
            
            if (!reportElement) {
                alert('Î¶¨Ìè¨Ìä∏ ÏòÅÏó≠ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            // ÏÉÅÌÉú Î©îÏãúÏßÄ ÌëúÏãú
            if (typeof showStatus === 'function') {
                showStatus('üìÑ PDF Î¶¨Ìè¨Ìä∏Î•º ÏÉùÏÑ± Ï§ë... ÌÖåÏù¥Î∏î Ï†ÑÏ≤¥Î•º Ìè¨Ìï®ÏãúÌÇ§Îäî Ï§ëÏûÖÎãàÎã§.', 'warning');
            } else {
                alert('PDF ÏÉùÏÑ± Ï§ë...');
            }
            
            try {
                // PDF ÏÉùÏÑ± Ï†Ñ Ï§ÄÎπÑ ÏûëÏóÖ
                const originalDisplay = reportElement.style.display;
                reportElement.style.display = 'block';
                
                // üîß Ïä§ÌÅ¨Î°§ ÌÖåÏù¥Î∏îÏùÑ ÏúÑÌïú ÌäπÎ≥Ñ Ï≤òÎ¶¨
                const scrollTables = reportElement.querySelectorAll('[style*="overflow-x: auto"]');
                const originalScrollStyles = [];
                
                // Î™®Îì† Ïä§ÌÅ¨Î°§ ÌÖåÏù¥Î∏îÏùò Ïä§ÌÅ¨Î°§ÏùÑ ÏûÑÏãúÎ°ú Ï†úÍ±∞
                scrollTables.forEach((table, index) => {
                    originalScrollStyles[index] = {
                        element: table,
                        originalStyle: table.style.overflowX,
                        originalWidth: table.style.width,
                        originalMinWidth: table.style.minWidth
                    };
                    
                    // Ïä§ÌÅ¨Î°§ Ï†úÍ±∞ÌïòÍ≥† Ï†ÑÏ≤¥ ÎÑàÎπÑ ÌëúÏãú
                    table.style.overflowX = 'visible';
                    table.style.width = 'auto';
                    table.style.minWidth = 'none';
                });
                
                // ÌÖåÏù¥Î∏î ÎÇ¥Î∂ÄÏùò min-width Ïä§ÌÉÄÏùºÎèÑ ÏûÑÏãú Ï†úÍ±∞
                const tablesWithMinWidth = reportElement.querySelectorAll('table[style*="min-width"]');
                const originalTableStyles = [];
                
                tablesWithMinWidth.forEach((table, index) => {
                    originalTableStyles[index] = {
                        element: table,
                        originalStyle: table.style.minWidth
                    };
                    table.style.minWidth = 'none';
                });
                
                // 2Ï¥à ÎåÄÍ∏∞ (Î†àÏù¥ÏïÑÏõÉ Ïû¨Ï°∞Ï†ï ÏãúÍ∞Ñ)
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // html2canvasÎ°ú Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± (Îçî ÌÅ∞ Ïä§ÏºÄÏùºÍ≥º ÎÑàÎπÑÎ°ú)
                const canvas = await html2canvas(reportElement, {
                    scale: 2,  // Ìï¥ÏÉÅÎèÑ ÎÜíÏûÑ
                    useCORS: true,
                    allowTaint: true,
                    logging: false,
                    height: reportElement.scrollHeight,
                    width: Math.max(reportElement.scrollWidth, 1400), // ÏµúÏÜå ÎÑàÎπÑ Î≥¥Ïû•
                    backgroundColor: '#ffffff',
                    scrollX: 0,
                    scrollY: 0
                });
                
                // ÏõêÎûò Ïä§ÌÉÄÏùº Î≥µÏõê
                originalScrollStyles.forEach(styleInfo => {
                    styleInfo.element.style.overflowX = styleInfo.originalStyle;
                    styleInfo.element.style.width = styleInfo.originalWidth;
                    styleInfo.element.style.minWidth = styleInfo.originalMinWidth;
                });
                
                originalTableStyles.forEach(styleInfo => {
                    styleInfo.element.style.minWidth = styleInfo.originalStyle;
                });
                
                // jsPDFÎ°ú PDF ÏÉùÏÑ± (A4 Í∞ÄÎ°ú Î™®ÎìúÎ°ú Î≥ÄÍ≤Ω)
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('l', 'mm', 'a4');  // 'l' = landscape (Í∞ÄÎ°ú)
                
                const imgData = canvas.toDataURL('image/png');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                const canvasWidth = canvas.width;
                const canvasHeight = canvas.height;
                const ratio = canvasWidth / canvasHeight;
                const imgHeight = pdfWidth / ratio;
                let heightLeft = imgHeight;
                let position = 0;
                
                // Ï≤´ ÌéòÏù¥ÏßÄ Ï∂îÍ∞Ä
                pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, imgHeight);
                heightLeft -= pdfHeight;
                
                // Ï∂îÍ∞Ä ÌéòÏù¥ÏßÄÍ∞Ä ÌïÑÏöîÌïú Í≤ΩÏö∞
                while (heightLeft > 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, imgHeight);
                    heightLeft -= pdfHeight;
                }
                
                // ÌååÏùºÎ™ÖÏóê ÎÇ†Ïßú Ï∂îÍ∞Ä
                const today = new Date();
                const dateStr = today.getFullYear() + '-' + 
                               String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                               String(today.getDate()).padStart(2, '0');
                
                // PDF Ï†ÄÏû•
                pdf.save(studentName + '_ÏÑ±Ï†ÅÎ∂ÑÏÑùÎ¶¨Ìè¨Ìä∏_' + dateStr + '.pdf');
                
                // ÏÑ±Í≥µ Î©îÏãúÏßÄ
                if (typeof showStatus === 'function') {
                    showStatus('‚úÖ Ï†ÑÏ≤¥ ÌÖåÏù¥Î∏îÏù¥ Ìè¨Ìï®Îêú PDF Î¶¨Ìè¨Ìä∏Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!', 'success');
                } else {
                    alert('PDF Î¶¨Ìè¨Ìä∏Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
                }
                
                // ÏõêÎûò ÏÉÅÌÉúÎ°ú Î≥µÏõê
                reportElement.style.display = originalDisplay;
                
            } catch (error) {
                console.error('PDF ÏÉùÏÑ± Ïò§Î•ò:', error);
                if (typeof showStatus === 'function') {
                    showStatus('‚ùå PDF ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
                } else {
                    alert('PDF ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                }
            }
        }
        
        
    </script>
</body>
</html>
